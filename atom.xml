<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Bohumír Zámečník]]></title>
  <link href="http://bohumirzamecnik.cz/atom.xml" rel="self"/>
  <link href="http://bohumirzamecnik.cz/"/>
  <updated>2016-09-13T18:04:07+02:00</updated>
  <id>http://bohumirzamecnik.cz/</id>
  <author>
    <name><![CDATA[Bohumír Zámečník]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Travel.log #1 - Wrocław]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2016/travel-log-1-wroclaw/"/>
    <updated>2016-09-13T18:05:00+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2016/travel-log-1-wroclaw</id>
    <content type="html"><![CDATA[<p>My nomad travels started in Wrocław, Poland. Open-air office, sleeping in the wild and other stories.</p>

<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/elgriton/29288968090/in/album-72157673569277236/" title="Wroclav Ratusz"><img src="https://c3.staticflickr.com/9/8425/29288968090_71730ac883_z.jpg" width="640" height="361" alt="Wroclav Ratusz" /></a><script async="" src="http://bohumirzamecnik.cz//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>

<!-- more -->

<h2 id="september-2016-thursday">8 September 2016 (Thursday)</h2>

<p>After all the preparations I finally set off to my <a href="http://bohumirzamecnik.cz/blog/2016/my-digital-nomad-story/">digital nomad journey</a> I was looking forward so long!</p>

<p>Yesterday my brother flew back to New Zealand, today it’s my turn.</p>

<p>In the morning I weighed by backpack again with several configurations. In total with all the comfortable stuff it has 10.9 kg. Without my extra things (like an audio recorder) it has 1.0.25 kg. Without the comfortable stuff (blazer, disks, tablet) it has 6.85 kg. Without the work stuff (MacBook, phone, cables) it has only 4.25 kg!</p>

<p>Before noon I went to my insurance company which offers a bit of money back for travel vaccinations.</p>

<p>Farewell with my parents, grandparents and our dog Růženka and I headed by train to Poland. Today’s destination is Wrocław. A train ticket from Letohrad to Wrocław (a network ticket for Pardubický kraj &amp; Poland) cost me 289 CZK. With a transfer in Klodzko it took about 3 hours and at the afternoon I was in Wrocław. In the train it was nice to look to the countryside and relax. Also I started writing the first article in the ADS-B series: <a href="http://bohumirzamecnik.cz/blog/2016/ads-b-flight-tracking/">Flight Tracking for the Curious</a>.</p>

<p>At the railway station there was a wifi so I could immediately choose and reserve a hostel in the center. A 4-bed room in the Friends hostel was for 36 PLN. Not bad.</p>

<p>It was nice weather, hot, sunny and so I made a walk around the old town moat (a watter channel in front of the former town walls). There were even some fish.</p>

<p>I came around 6 PM. The room was quite nice, storey beds (a bit squeaky) and locking drawers at the bottom.</p>

<p>I had to relax a bit and in the evening I went to visit the own town just with a tiny backpack and my MacBook. I like the atmosphere of the city. It’s not so crowded with tourists and full of souvenir shops as in Prague. More like a student city. On the main square (rynek) there’s a beautifully decorated town hall (ratusz). Since the city is built upon branches of the Odra river there’s a lot of bridges. Very nice after sunset.</p>

<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/elgriton/29288965230/in/album-72157673569277236/" title="Wroclav University"><img src="https://c7.staticflickr.com/9/8234/29288965230_0e141802da_z.jpg" width="640" height="361" alt="Wroclav University" /></a><script async="" src="http://bohumirzamecnik.cz//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>

<p>On one smaller rynk there are wooden beds instead of benches. I settled down on one and continued writing. It was very warm evening.</p>

<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/elgriton/28955626263/in/album-72157673569277236/" title="Digital nomad at work"><img src="https://c8.staticflickr.com/9/8424/28955626263_b3d2453a90_z.jpg" width="640" height="361" alt="Digital nomad at work" /></a><script async="" src="http://bohumirzamecnik.cz//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>

<p>Near the hostel they have yummy wraps in the Yummy Wrap bistro.</p>

<p>In the hostel it was not easy to fall asleep even though I had earplugs since it is located very close to many discos. They played till 3:45 AM :(.</p>

<h2 id="september-2016-friday">9 September 2016 (Friday)</h2>

<p>The hostel stay included a breakfast in a nearby cinema bistro. They had a delicious salmon sandwich and quite a good coffee. Good start of the day.</p>

<p>In one park near the river I continued writing. Since I forgot to charge my computer I found a nice coffee near the rynk. They had a delicious vegetable ciabatta with hummus.</p>

<p>I decided to create a Slack channel for talking about <a href="https://adsb.slack.com/">ADS-B Flight Tracking</a>.</p>

<p>It was also possible to charge my equipment in a bigger shopping center. Thanks to the noise-cancelling headphones it’s possible to do some work even in a loud buzz from the people.</p>

<p>I reserved a hostel (Cinnamon) nearby and relaxed after a day of walking. Then I could continue writing. Altough there was no disco till the night, still a loud fan on the outside wall was humming so the sleeping was not perfect.</p>

<h2 id="september-saturday">10 September (Saturday)</h2>

<p>I slept better than yesterday but it could be better. In the morning I was correcting my brother Pango’s text for his crowfunding campaign (<a href="http://pianomad.com">PIANOmad.com</a>) - live video broadcast of his piano improvisations from New Zealand’s nature.</p>

<p>Then I came to a park to write the ADS-B series. It’s nice that a public city wifi works even in a park.</p>

<p>I noticed some armored transporters and hummers drive by. The city center was crowded. I thought it’s some marathon for 9/11 but there a lot of soldiers were standing in lines. It was a promotion of new soldiers. The day was hot and I didn’t envy them standing there maybe hour or two.</p>

<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/elgriton/29361311950/in/album-72157673569277236/" title="Military parade in Wroclaw"><img src="https://c7.staticflickr.com/9/8773/29361311950_45a817ea09_z.jpg" width="640" height="361" alt="Military parade in Wroclaw" /></a><script async="" src="http://bohumirzamecnik.cz//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>

<p>In a coffee house I found out that all the hostels and AirBnb rooms are already full :(. Only some quite expensive were available. So I tried to contact some people via Couchsurfing.</p>

<p>In the afternoon I moved to a small island and made an open-air office under a tree. It was quite pleasant.</p>

<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/elgriton/29570642521/in/album-72157673569277236/" title="Open-air office under a tree on an island"><img src="https://c2.staticflickr.com/9/8568/29570642521_f181386303_z.jpg" width="640" height="361" alt="Open-air office under a tree on an island" /></a><script async="" src="http://bohumirzamecnik.cz//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>

<p>On Couchsurfing Hangout I met two guys, Andrzej and Dominykas (from Ukraine and Lithuania), at a boat pub near a park island on the other side of the river. Both were IT guys and we spend a nice evening at a beer.</p>

<p>During the day no host accepted my couch requests. Since it was a tropical day and the weather forecast for the night was 16 ˚C I decided to try camping in the wild somewhere near the river a bit outside of the city :) On the map I found Las Rakowiecki near the Oława river around 4 km from the center. I took me about an hour to get there.</p>

<p>In the forest I had to take my headlamp and soon some eyes were staring at me from the dark. I went on the forest path and instead of a dry sparse woods there were juicy hedges. Near a bridge over Oława I saw some campfire and people around. Either students drinking or some homeless guys. They had a LED light, so I called to them and joined the group. Indeed, some young people making a barbecue and drinking on a campfire spot. We chatted with Emil, an IT student. Then we sung a bit and another guy played some harmonica tunes. Interesting encounter.</p>

<h2 id="september-2016-sunday">11 September 2016 (Sunday)</h2>

<p>After the midnight they went home and I went to sleep. I didn’t have any sleeping bag, pad or tent. I just put my green heavy cotton blazer underneath and put all the clothes on. Fortunately, the fire was still burning and a few large branches were left.</p>

<p>The night was quite tough. But I chose it voluntarily. In fact as a kind of a bit harder comfort zone challenge. Just to make sure I can withstand it.</p>

<p>The whole night I could not close my eyes. It was not so warm, I was a bit afraid of an animal or human attacking me or robbing me. For any case I had my pepper spray witha LED light prepared in my hand.</p>

<p>Altough I was on a meadow in a forest and I thought it would be a calm place a disco nearby was playing until 4 AM. Not much better than the Friends Hostel. I paid attention to the various forest sounds like falling branches or crowing ducks. And I had to keep the fire on every half and hour or so. Still I could not sleep.</p>

<p>Sometimes after 5 AM some faints came upon me and I fall asleep for a few minutes. Nevertheless at that moment I heard a person coming from the path. So I jumped up with the LED light and called upon him what’s up. He just mumbled something about the fire and turned around. His jacket was shining with some reflective stripes. So most probably it was a hunter or forest keeper. At least he didn’t fine me for the fire.</p>

<p>At 5:30 the sun started to rise and sometimes a cyclist rode across the bridge - it was a bike path. After that I could not sleep more.</p>

<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/elgriton/29570649051/in/album-72157673569277236/" title="I was sleeping wild"><img src="https://c4.staticflickr.com/9/8276/29570649051_8a6b68a8c4_z.jpg" width="640" height="358" alt="I was sleeping wild" /></a><script async="" src="http://bohumirzamecnik.cz//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>

<p>At about 7 AM I packed my things, shut down the fire with some green water and went towards the city. At least both me and my blazer have survived it. But then I said to myself. Well, I managed it, but that’s enough for a while. There’s some work waiting for me, so let’s get some comfortable AirBnb room for several days and focus on the work.</p>

<p>During the morning I was not so tired and went for a walk around the Oława park. It was an amazing sunday misty morning. Then I headed for the bus to Kraków, the next destination.</p>

<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/elgriton/29651905445/in/album-72157673569277236/" title="Near Olawa"><img src="https://c6.staticflickr.com/9/8226/29651905445_3d7ed7f57b_z.jpg" width="640" height="361" alt="Near Olawa" /></a><script async="" src="http://bohumirzamecnik.cz//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>

<h2 id="the-whole-gallery-of-photos">The whole gallery of photos</h2>

<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/elgriton/albums/72157673569277236" title="2016/09 Poland"><img src="https://c3.staticflickr.com/9/8425/29288968090_71730ac883_z.jpg" width="640" height="361" alt="2016/09 Poland" /></a><script async="" src="http://bohumirzamecnik.cz//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ADS-B Part 1 - Flight Tracking for the Curious]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2016/ads-b-flight-tracking/"/>
    <updated>2016-09-09T17:34:00+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2016/ads-b-flight-tracking</id>
    <content type="html"><![CDATA[<p>Every moment tens of thousands airplanes are in the air and many are flying around. We can analyze their flights. In this series we will explore how to capture flight information using a DIY ADS-B receiver based on Raspberry Pi.</p>

<p><img src="http://i.bohumirzamecnik.cz/adsb/vrs_2016-07-08_12-53-51_t.png" /></p>

<!--more-->

<p>Altough there’s plenty of focused tutorials on the web on particular topics, the reality is never straighforward. Here I’d like to provide a comprehensive guide based on my own experience with building an ADS-B receiver, cover the questions and decisions and when needed point to the existing tutorials for more details.</p>

<h2 id="why-flight-tracking">Why flight tracking?</h2>

<p>We can see airplane tracks on the sky virtually in every civilized area. Sometimes you can hear a loud hum of a plane or helicopter flying by. When you live near an airport like I was living you can ocassionally see planes going to land every two minutes. They fly so low you can read their logos at the bottom.</p>

<p><a href="http://i.bohumirzamecnik.cz/adsb/fr24_2016-09-08_00-02-18.png"><img src="http://i.bohumirzamecnik.cz/adsb/fr24_2016-09-08_00-02-18_t.png" title="FlightRadar24" /></a></p>

<p>One day you may ask where the planes are coming from or going to. Then you find services like <a href="https://flightradar24.com">FlightRadar24</a>, <a href="https://planefinder.net">PlaneFinder</a>, <a href="https://flightaware.com/">Flightaware</a> and many others that show a near real-time map of almost all planes in the air. A tremendous amount of information is available beyond the source and destination airports and current position, such as the whole path, model and manufacturing info, photos, previous flight info, etc. There are communities of people hunting for best plane photos or providing accurate plane information.</p>

<h3 id="more-questions">More questions</h3>

<p>If you’re crazy into data and visualization, one day you may realize the data provided by such services for free are not enough to answer your curious questions.</p>

<ul>
  <li>How the plane paths look in mass? Ie. what’s the distribution of plane paths on the map?</li>
  <li>Are there any “corridors” used as highways or do planes fly just randomly?</li>
  <li>If so, how does this distribution change in time? Are there any periodicities?</li>
  <li>How does the distribution of altitude vs. distance on the path look like when projected into a 2D plane?</li>
  <li>What about distance to the source airport? Can we distinguish round-trip flights?</li>
  <li>Can we play back interesting flights quickly afterwards?</li>
  <li>Can we learn a machine learning model of some normal mode of traffic and detect anomalies, eg. emergency situations?</li>
  <li>How does the normal traffic evolve over time?</li>
</ul>

<h2 id="how-are-the-data-gathered">How are the data gathered?</h2>

<p>Where the data come from? There are several sources of flight data, including classical radar, ADS-B and MLAT.</p>

<p>Traditionally airplane positions were detected by airport radars. The flight tracking services use an aggregated source of radar data as one of their sources. The problem is that data from official agencies are sometimes artificially delayed.</p>

<h3 id="ads-b">ADS-B</h3>

<p>However, there’s another more abundant source of data, ADS-B (<a href="https://en.wikipedia.org/wiki/Automatic_dependent_surveillance_%E2%80%93_broadcast">Automatic dependent surveillance – broadcast</a>). In short in order to prevent plane collisions planes broadcast messages with their identification, location and velocity over microwave radio. The nice thing is with today’s technology and software we can receive such signal with just a very cheap hardware and open-source software. My receiver cost around $150 in total, and of course some work.</p>

<p>Although ADS-B receivers are standard part of airport equipment, there’s a whole community of people building and operating their own ADS-B receivers. So the other source of flight tracking data is ADS-B from the community.</p>

<p>The flight tracking services offer professional data for quite a high subscription price. But when you provide them with your raw data you can get in exchange the premium services for free.</p>

<p>Besides that there exist community data exchanges, such as <a href="http://adsbexchange.com/">ADSB Exchange</a> or <a href="http://czadsb.cz/">CZADSB</a> where the people share raw unfiltered data. Altough setting this up might be sometimes more rough around the edges the data might be worth the extra effort.</p>

<p>It should be noted that ADSB Exchange offers the merged data for free and you’re not required to provide data in exchange. On the other hand providing own data is a way to support the site, so that it doesn’t die, and it can give you more accurate data near your location and… well, it’s just plain fun to build something yourself. After you did it you can be proud of youself and have learnt a lot.</p>

<h3 id="mlat">MLAT</h3>

<p>Another source is called <a href="http://www.multilateration.com/surveillance/multilateration.html">MLAT</a> (abbreviation of Multi-LATeration). It’s an almost magical way of locating a plane even if it does not publish it’s position in its ADS-B stream! Simply said we can compute the position of a transmitter (it in case a plane) just by observing variously delayed signal from multiple receivers. For 3D position 4 receivers are enough.</p>

<p>The only requirement is that the receivers must communicate with each other. For that purpose there’s a set of open-source client-server programs to acomplish this task: <code>mlat-server</code> and <code>mlat-client</code>. An instance of <code>mlat-server</code> typically runs on the exchange and we only install and set up the <code>mlat-client</code>. Eg. the FlightAware receiver pack already contains a <code>mlat-client</code>.</p>

<p>Are you sold for building your own infrastructure for receiving ADS-B data?</p>

<h2 id="the-architecture-of-an-ads-b-receiver">The architecture of an ADS-B receiver</h2>

<p>We want to fulfil the following primary features:</p>

<ul>
  <li>receive the ADS-B microwave signal in the 1090 Mhz band</li>
  <li>decode the signal into a stream of messages</li>
  <li>forward the ADS-B stream into services we want to support:
    <ul>
      <li>commercial:
        <ul>
          <li>FlightRadar24.com</li>
          <li>FlightAware.com</li>
          <li>PlaneFinder.net</li>
        </ul>
      </li>
      <li>community:
        <ul>
          <li>ADSBexchange.com</li>
          <li>CZADSB.cz</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>cooperate with MLAT servers where available</li>
  <li>prepare a stream for our own capturing and archiving</li>
</ul>

<p>Other features such as capturing the our data or merged exchange data, archiving them and processing them is out of scope of this tutorial and hopefully will be covered afterwards.</p>

<p><img src="http://i.bohumirzamecnik.cz/adsb/adsb-receiver-architecture-overview.png" /></p>

<p>Here we’ll try to briefly go through the steps outlined above. Each step will be then covered in detail in a separate article within the series.</p>

<h3 id="receiving-signal">Receiving signal</h3>

<p>First we need to recieve the microwave ADS-B signal from the planes in the 1090 MHz. Altough using some special hardware is possible it is not required. Some clever hardware hackers found out that this can be done using plain DVB-T tuners for terrestrical digital TV! Such deviced are based on the concept of Software Defined Radio (SDR), where the modulation and demodulation is not performed by custom electronic circuits but just in software! Such DVT-T sticks
can be easily found in electro stores or in e-shops. The only catch is to find one with suitable firmware. We will explore which sticks to buy in the detailed article.</p>

<p>In order to feed the signal into the receiver we have to use an antenna and conect both with cables and possibly some adaptors. Typically we will need an omnidirectional antenna to catch plane info all around. An optional part is an additional amplifier and or band-pass filter which can improve the receiving capabilities (specifically we could capture planes at much futher distance).</p>

<p>A crucial requirement is a place where the antenna is mounted. It can only catch planes with direct visibility. So a roof with good 360-degree view of the sky is ideal. Also the place needs electricity and internet connection.</p>

<h3 id="hardware-for-processing-the-signal">Hardware for processing the signal</h3>

<p>We need a computer to process the signal from the DVB-T stick. Any computer with Linux, OS X or Windows will suffice, however Linux is probably most widely used and supported for this task. The computer doesn’t need a lot of computing or electrical power, but needs to be always on. A very popular platform choice is Raspberry Pi.</p>

<p>Despite its credit-card size and low power consumption it’s a fully featured computer capable of running Linux.</p>

<h3 id="decoding-a-stream-of-messages">Decoding a stream of messages</h3>

<p>Once we have the radio signal ready in the receiver we need to demodulate and decode the messages into some standard text or binary stream format. We need to install drivers for the stick and the decoding software. The most popular choices are the following. A DVB-T driver is called <code>rtlsdr</code> (“SDR for Realtek chipset”) and a decoder is <code>dump1090</code>.</p>

<p>The basic function of the <code>dump1090</code> program is to decode the raw signal into a stream of ADS-B messags and provide it via a network socket. The stream can be in several formats (plain text CSV, binary Beast or raw hexadecimal).</p>

<p>We can then forward these streams into exchanges we want to support or just read it from our own service.</p>

<p>Beyond that, <code>dump1090</code> can be used to merge streams from other receivers and publish it as a single stream - it acts as a simple exchange.</p>

<p>Since dump1090 is a popular open-source software there exist many forks, each with some different enhancements. We will evaluate them a choose some fork that’s suitable for our needs.</p>

<h3 id="sending-message-streams-to-exchanges">Sending message streams to exchanges</h3>

<p>The flight tracking services or community exchanges typically provide their own software for feeding them. Most often they can read from <code>dump1090</code> or even bundle it inside. We will learn how to set up feeding multiple exchanges on one machine. Sometimes we can follow their very nice and polished tutorials, sometimes we will have to set it up in some custom way.</p>

<h3 id="viewing-planes-on-the-map">Viewing planes on the map</h3>

<p>It would be boring just to look at the text data when debugging our set up or we can just be curious to see what our receiver sees. For that purpose there are multiple programs to visualize the planes from our own stream on a map - a simple and rough version of FlightRadar24 interface. We will explore <a href="http://www.virtualradarserver.co.uk">VirtualRadarServer</a>, <code>dump1090</code> web UI.</p>

<h3 id="storing-the-data-for-archiving">Storing the data for archiving</h3>

<p>We can explore a prototype way of storing the data using the tools already available. This is by no means meant for production usage, just to as a proof that we are indeed able to storing our own data.</p>

<h2 id="whats-next">What’s next?</h2>

<p>In the next post of this series we’ll present the architecture of our system in more detail.</p>

<h3 id="slack-channel">Slack channel</h3>

<p>If you have any questions or just would like to chat about flight tracking, feel free to check the <a href="https://adsb.slack.com">ADS-B Flight Tracking</a> Slack channel. Automatic invitation is on <a href="https://adsb.signup.team">adsb.signup.team</a>.</p>

<p><a href="https://adsb.signup.team"><img src="http://i.bohumirzamecnik.cz/adsb/adsb-slack.png" /></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ADS-B Part 2 - Hardware]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2016/adsb-part-2-hardware/"/>
    <updated>2016-09-02T20:55:41+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2016/adsb-part-2-hardware</id>
    <content type="html"><![CDATA[<p>We’ll explore how to choose and set up hardware for our ADS-B receiver.</p>

<p>TODO: photo</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#ads-b-flight-tracking-for-the-curious-series">ADS-B Flight Tracking for the Curious series</a></li>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#tldr---my-hardware-list">TL;DR - my hardware list</a></li>
  <li><a href="#going-backwards-along-the-requirements">Going backwards along the requirements</a>    <ul>
      <li><a href="#sdr-receiver">SDR receiver</a>        <ul>
          <li><a href="#choosing-a-compatible-dvb-t-stick">Choosing a compatible DVB-T stick</a></li>
        </ul>
      </li>
      <li><a href="#computer">Computer</a>        <ul>
          <li><a href="#raspberry-pi">Raspberry Pi</a></li>
          <li><a href="#power-supply">Power supply</a></li>
          <li><a href="#case">Case</a></li>
        </ul>
      </li>
      <li><a href="#antenna">Antenna</a>        <ul>
          <li><a href="#small-bundled-tv-antenna">Small bundled TV antenna</a></li>
          <li><a href="#professional-1090-mhz-antenna">Professional 1090 MHz antenna</a></li>
          <li><a href="#diy-1090-mhz-antenna">DIY 1090 MHz antenna</a></li>
          <li><a href="#my-choice---cantenna">My choice - cantenna</a></li>
          <li><a href="#connectors">Connectors</a></li>
        </ul>
      </li>
      <li><a href="#rf-cables-and-adapters">RF cables and adapters</a></li>
      <li><a href="#power-source">Power source</a></li>
      <li><a href="#internet-connection">Internet connection</a></li>
    </ul>
  </li>
  <li><a href="#putting-it-together">Putting it together</a></li>
  <li><a href="#where-to-place-and-how-to-mount-the-components">Where to place and how to mount the components?</a>    <ul>
      <li><a href="#options-for-mounting-the-parts">Options for mounting the parts</a></li>
      <li><a href="#antenna-mount">Antenna mount</a></li>
      <li><a href="#a-concrete-scheme">A concrete scheme</a></li>
    </ul>
  </li>
</ul>

<h2 id="ads-b-flight-tracking-for-the-curious-series">ADS-B Flight Tracking for the Curious series</h2>

<ul>
  <li><a href="../ads-b-flight-tracking/">Part 1: Why should be build our own ADS-B receiver and roughly how it works?</a></li>
  <li><strong>Part 2: Hardware - architecture an installation</strong></li>
  <li>Part 3: Software for feeding data</li>
  <li>Part 4: Software for viewing data</li>
  <li>…</li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>So our goal is to send data to the services and exchanges we talked about in the introduction. The hardware should not be expensive and should be realatively easy to install for a normal programmer with basic Linux skills. As always this is just description of my experience and your milage may vary.</p>

<p>In my installation I wanted to support the following sites: FlightRadar24.com, FlightAware.com, PlaneFinder.net, ADSBexchange.com and CZADSB.cz and also be able to archive my data. So which hardware to choose?</p>

<h2 id="tldr---my-hardware-list">TL;DR - my hardware list</h2>

<p>This is the hardware I bought for my project. Below we’ll look at the details.</p>

<table>
  <thead>
    <tr>
      <th>part</th>
      <th>description</th>
      <th>price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="http://www.ges.cz/cz/dvb-t-usb-tuner-s-sdr-dab-a-fm-GES08804665.html">DVB-T tuner</a></td>
      <td>Realtec RTL2832 chipset, Rafaelo Micro R820T tuner, frequency ange 25 - 1750 MHz, IEC female connector</td>
      <td>559 CZK</td>
    </tr>
    <tr>
      <td> </td>
      <td><strong>parts for DIY antenna (quarter-wave whip):</strong></td>
      <td> </td>
    </tr>
    <tr>
      <td>soldering N panel connector</td>
      <td>N-512</td>
      <td>86 CZK</td>
    </tr>
    <tr>
      <td>N male - F female adapter</td>
      <td>CVP-107</td>
      <td>70 CZK</td>
    </tr>
    <tr>
      <td>small old can</td>
      <td>to serve as a ground plane</td>
      <td>free</td>
    </tr>
    <tr>
      <td> </td>
      <td><strong>cables &amp; adapters:</strong></td>
      <td> </td>
    </tr>
    <tr>
      <td>RG6 cable</td>
      <td>11m</td>
      <td>165 CZK</td>
    </tr>
    <tr>
      <td>2 male F connectors</td>
      <td> </td>
      <td>2x 20 CZK</td>
    </tr>
    <tr>
      <td>Alcad PL-310 amplifier</td>
      <td>wide-band, not used at the end</td>
      <td>245 CZK</td>
    </tr>
    <tr>
      <td>power inserter for the amp P1-101</td>
      <td>not used at the end)</td>
      <td>130 CZK</td>
    </tr>
    <tr>
      <td>connector for the power inserter DCK 21 HQ</td>
      <td> </td>
      <td>22 CZK</td>
    </tr>
    <tr>
      <td>power source for the amp power inserter</td>
      <td> </td>
      <td>269 CZK</td>
    </tr>
    <tr>
      <td>2x adapters F female-female</td>
      <td> </td>
      <td>2 x 40 CZK</td>
    </tr>
    <tr>
      <td>IEC male - F female adapter CVP-308</td>
      <td> </td>
      <td>?</td>
    </tr>
    <tr>
      <td> </td>
      <td><strong>computer:</strong></td>
      <td> </td>
    </tr>
    <tr>
      <td>Raspberry Pi 3</td>
      <td> </td>
      <td>1399 CZK</td>
    </tr>
    <tr>
      <td>RPi case</td>
      <td> </td>
      <td>213 CZK</td>
    </tr>
    <tr>
      <td>RPi power source</td>
      <td> </td>
      <td>399 CZK</td>
    </tr>
    <tr>
      <td>microSD card</td>
      <td>16 GB</td>
      <td>199 CZK</td>
    </tr>
  </tbody>
</table>

<p>Total cost: 3897 CZK (~162 USD).</p>

<p>If I didn’t hurry I could buy the DVB-T for half the price. Also there was a problem with the amp/injector, I should have chosen another one.</p>

<p>Now let’s dig deeper how to choose your own the hardware and learn how to decide.</p>

<h2 id="going-backwards-along-the-requirements">Going backwards along the requirements</h2>

<p>Abstract scheme of the hardware architecture:</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/adsb-part-2-hardware/adsb-hardware-abstract-schema.svg" type="image/svg+xml" />&lt;/img&gt;</p>

<h3 id="sdr-receiver">SDR receiver</h3>

<p>The commercial sites usually provide you with a convenient software package to feed their service that you can install with minimal fuss. But what is common for all the sites is that they support feeding data in format offered by a program called <code>dump1090</code>. And that is good for us, we can use one program to feed them all.</p>

<p><code>dump1090</code> uses the <code>RTLSDR</code> driver for Software Defined Radio which works with a family of DVB-T tuners. For us it means we can choose a cheap DVB-T stick compatible with RTLSDR and watch planes instead of TV.</p>

<h4 id="choosing-a-compatible-dvb-t-stick">Choosing a compatible DVB-T stick</h4>

<p>The RTLSDR driver project exploits some tricks in one particular chipset <strong>Realtec RTL2832</strong>. There exist DVB-T sticks on the market with different chipsets but this driver cannot utilize them. It may not always be apparent which chipset a particular tuner contains but fortunately there are some tables which map the tuner models and chipsets:</p>

<ul>
  <li>http://sdr.osmocom.org/trac/wiki/rtl-sdr - official list of supported hardware</li>
  <li>http://rtlsdr.org/</li>
  <li>http://elinux.org/RPi_VerifiedPeripherals#USB_TV_Tuners_and_DVB_devices</li>
  <li>https://www.linuxtv.org/wiki/index.php/DVB-T_USB_Devices/Full</li>
  <li>http://www.rtl-sdr.com/about-rtl-sdr/</li>
</ul>

<p>Note there are two relevant parts of a DVB-T stick - chipset and tuner.</p>

<p>The supported chipset is <strong><a href="http://www.realtek.com.tw/products/productsView.aspx?Langid=1&amp;PNid=22&amp;PFid=35&amp;Level=4&amp;Conn=3&amp;ProdID=257">Realtec RTL2832U</a></strong>. It comes with various tuners: <strong>Rafaelo Micro R820T</strong>, <strong>R820T2</strong>, <strong>R828D</strong>, <strong><a href="http://www.superkuh.com/gnuradio/Elonics-E4000-Low-Power-CMOS-Multi-Band-Tunner-Datasheet.pdf">Elonics E4000</a></strong> (discontinued), Fitipower FC0013. All are fine.</p>

<p>Chipsets unsupported by the driver are <strong>IT9135</strong>, <strong>IT9130</strong>, <strong>AF9135</strong>. The Fitipower FC0012 and FCI FC2580 tuners may not suitable due to not covering the 1090 Mhz band in their range.</p>

<p>The DVB-T stick I bought contains the Realtec RTL2832U chipset and Rafaelo Micro R820T tuner.</p>

<p>Since I was a bit in a hurry I bought it a local store for about $20. Otherwise I’d buy this one: <a href="http://www.dx.com/en/p/rtl2832u-r820t-mini-dvb-t-dab-fm-usb-digital-tv-dongle-black-170541">RTL2832U + R820T Mini DVB-T + DAB+ + FM USB Digital TV Dongle - Black</a> for only 10.5 USD.</p>

<h3 id="computer">Computer</h3>

<p>For decoding the ADB-B message stream via the said DVB-T tuner we need a computer. Basically any computer capable of running Linux, with a USB connector and connected to the internet is fine. Some ADS-B software also runs on OS X or Windows but it is out of scope of this series (I don’t use Windows and OS X will be covered briefly just for testing the DVB-T stick).</p>

<p>We need it to run 24/7, so that if it’s power consumption is low, we save on electricity bills. Also a micro-computer is easier to install near to the antenna, eg. to an attic or into a waterproof box on the roof, if that’s our wish.</p>

<h4 id="raspberry-pi">Raspberry Pi</h4>

<p>A very nice choice is <strong><a href="https://www.raspberrypi.org/">Raspberry Pi</a></strong>. It’s a fully-features credit-card sized device with only a few watts consumption. I think any version should be sufficient. Note that RPi Zero does not have an ethernet port integrated and requires and external USB-ethernet adapter.</p>

<p>I chose Raspberry Pi 3 for it’s higher performance and both ethernet and integrated WiFi. The ADS-B programs are not very resource hungry, still I wanted more headroom for additional software. If you want to save money take an older version (eg. RPi 2 B). The system is stored on a small microSD card and the device is powered via USB.</p>

<h4 id="power-supply">Power supply</h4>

<p>The RPi is powered by a small 5V power supply via a mini USB cable (the same as on Android phones). The power supply <a href="https://www.raspberrypi.org/help/faqs/#powerReqs">capacity depends on the RPi model</a>. Generally any phone PSU with 2.5A capacity on 5V is fine.</p>

<h4 id="case">Case</h4>

<p>Also you may want to put the RPi into a case so it does not get hurt. For outside mount you can put all the stuff into a bigger waterproof case, then a dedicated RPi case is not needed.</p>

<h3 id="antenna">Antenna</h3>

<p>DVB-T sticks usually come with a small indoor antenna. You can catch some planes on it but it is optimized for TV, not ADS-B, and has a short cable (eg. 0.5 m). A better option is a dedicated antenna tuned for the 1090 MHz band. Typically we need an omnidirectional antenna, ie. catching signals equally from all direction. In case we wish eg. to focus only on an airport nearby, we may use a directional antenna.</p>

<p>Also in order to provide good condition for signal reception the antenna should be placed on a place with good view to the whole sky, typically a roof or a stand, not indoors. It means the antena and the cables to the receiver need to be weather-proof.</p>

<h4 id="small-bundled-tv-antenna">Small bundled TV antenna</h4>

<p>A small antenna usually bundled with the DVB-T tuner can useful to test the set up before we prepare any better antenna. It is typically equipped with the IEC connector.</p>

<h4 id="professional-1090-mhz-antenna">Professional 1090 MHz antenna</h4>

<p>In case we have enough money and want to invest in a good antenna we can buy a ready-made collinear antenna (eg. the <a href="http://shop.jetvision.de/epages/64807909.sf/en_GB/?ObjectPath=/Shops/64807909/Products/67120">“SCO-1090-MCX” Antenna (1090 MHz), 3m cable, MCX</a> for about $78). A benefit is such antenna will almost for sure work properly (given a good view of sky) compared to DIY solutions.</p>

<h4 id="diy-1090-mhz-antenna">DIY 1090 MHz antenna</h4>

<p>If we don’t have enough money, if we’re radio amateurs with experience in building microwave antennas or if we just want some fun, we can build an antenna ourselves.</p>

<p>A simple fool-proof design that even a programmer with no experience in electro can build is called “quarter-wave <a href="https://en.wikipedia.org/wiki/Whip_antenna">whip</a> with <a href="https://en.wikipedia.org/wiki/Ground_plane">ground plane</a>”.</p>

<p>Eg. the user abcd567 at the FlightAware forum wrote a nice tutorial <a href="http://discussions.flightaware.com/post157718.html#p157718">3 easy antennas for beginners</a>.</p>

<p><img src="https://farm9.staticflickr.com/8743/16550012467_1dbb68602f.jpg" /></p>

<p>Roughly we:
- take a soldering panel N connector
- attach a pice of wire with a pre-computed length
- attach a few other wires, metal plate, or a can
- we seal everything to be waterproof</p>

<p>And we have an antenna.</p>

<p>The whip should be of quarter-wave (<code>lambda / 4</code>) length, in our case roughly <strong>69 mm</strong>. How to we compute that? Just take the freqeuency and speed of light:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">lambda = c / f
</span><span class="line">lambda / 4 = 299792458 / 1.09^9 * 1^3 / 4 ~= 68.76 mm</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Also the ground plane should be at least <code>lambda / 4</code> from the center to the edge. According to <a href="https://en.wikipedia.org/wiki/Ground_plane">Wikipedia</a>. Ie. a larger ground plane is not a problem.</p>

<blockquote>
  <p>A ground plane is a flat or nearly flat horizontal conducting surface that serves as part of an antenna, to reflect the radio waves from the other antenna elements. […] To function as a ground plane, the conducting surface must be at least a quarter of the wavelength (λ/4) of the radio waves in size.</p>
</blockquote>

<p>You can be a bit creative with the ground-plane:</p>

<ul>
  <li>4-legged spider from wires</li>
  <li>8-legged spider</li>
  <li>can</li>
  <li>cone</li>
</ul>

<p>In case we’re experienced we can build our own version of the commercially available collinear antennas.</p>

<h4 id="my-choice---cantenna">My choice - cantenna</h4>

<p>I’ve used the bundled antenna for testing and then that my brother Vojtěch helped me to build a whip with a ground plane made of a can. It’s based on an soldering panel N connector and there’s a adapter to the F connector on the cable. We took a piece of a wire of thickess so it fits the N connector hole, soldered it there, cut a small can to the quarter-wave height, made a hole in the middle, fitted it with the N connector and atteched a N-F adapter. For the outside we sealed the wire with a gaffa tape and the connector with a hot-glue. It’s not perfect, but it works.</p>

<p>I’d rather recommend another ground-plane type. The reason is a can has sharp edges and the space inside is tight so it’s hard to do anything there without cutting the fingers. Also the can was from steel and soon it started to rust. Better would be alluminium, or just the copper spider legs.</p>

<p>TODO: photo of my antenna</p>

<h4 id="connectors">Connectors</h4>

<p>You may notice there is a wide variety of RF (radio-frequency) cable connectors. Let’s describe the most common ones:</p>

<ul>
  <li>IEC (<a href="https://en.wikipedia.org/wiki/TV_aerial_plug">IEC 61169-2</a>)
    <ul>
      <li>medium-sized round TV connector without a screw</li>
      <li>usually on a DVB-T tuner as an input</li>
      <li>useful indoors</li>
    </ul>
    <p><a href="https://commons.wikimedia.org/wiki/File:IEC_169-2_male_and_female_connector.JPG#/media/File:IEC_169-2_male_and_female_connector.JPG"><img src="https://upload.wikimedia.org/wikipedia/commons/2/23/IEC_169-2_male_and_female_connector.JPG" alt="IEC 169-2 male and female connector.JPG" height="214" width="320" /></a><br />By <a href="http://bohumirzamecnik.cz//commons.wikimedia.org/wiki/User:Josutus" title="User:Josutus">Josutus</a> - <span class="int-own-work" lang="en">Own work</span>, <a href="http://creativecommons.org/licenses/by-sa/3.0" title="Creative Commons Attribution-Share Alike 3.0">CC BY-SA 3.0</a></p>
  </li>
  <li><a href="https://en.wikipedia.org/wiki/F_connector">F</a>
    <ul>
      <li>medium-sized connector with a screw</li>
      <li>diameter: 11 mm (male), 9.5 mm (female)</li>
      <li>for general radio applications</li>
      <li>usage mostly indoors, but weatherproof variants exist</li>
      <li>usually used with the RG-6/U cable</li>
    </ul>
    <p><a href="https://commons.wikimedia.org/wiki/File:F_Connector_Side.jpg#/media/File:F_Connector_Side.jpg"><img src="https://upload.wikimedia.org/wikipedia/commons/5/5b/F_Connector_Side.jpg" alt="F Connector Side.jpg" height="214" width="320" /></a><br />By © <a href="http://bohumirzamecnik.cz//commons.wikimedia.org/wiki/User:Colin" title="User:Colin">User:Colin</a>&nbsp;/&nbsp;<a href="http://bohumirzamecnik.cz//commons.wikimedia.org/wiki/Main_Page" title="Main Page">Wikimedia Commons</a>, <a href="http://creativecommons.org/licenses/by-sa/3.0" title="Creative Commons Attribution-Share Alike 3.0">CC BY-SA 3.0</a></p>
  </li>
  <li><a href="https://en.wikipedia.org/wiki/N_connector">N</a>
    <ul>
      <li>bigger connector with a screw</li>
      <li>can be used to make a DIY antenna</li>
      <li>can be used outdoors</li>
      <li>diameter: 20.3 mm (male), 15.7 mm (female)</li>
    </ul>
    <p><a href="https://commons.wikimedia.org/wiki/File:Male_type_N_connector.jpg#/media/File:Male_type_N_connector.jpg"><img src="https://upload.wikimedia.org/wikipedia/commons/1/11/Male_type_N_connector.jpg" alt="Male type N connector.jpg" height="214" width="320" /></a><br />By <a href="http://bohumirzamecnik.cz//commons.wikimedia.org/w/index.php?title=User:Swift.Hg&amp;action=edit&amp;redlink=1" class="new" title="User:Swift.Hg (page does not exist)">Swift.Hg</a> - <span class="int-own-work" lang="en">Own work</span>, <a href="http://creativecommons.org/licenses/by-sa/3.0" title="Creative Commons Attribution-Share Alike 3.0">CC BY-SA 3.0</a></p>
  </li>
  <li><a href="https://en.wikipedia.org/wiki/SMA_connector">SMA</a>
    <ul>
      <li>smaller connector with a screw</li>
      <li>50 Ω impedance</li>
      <li>diameter: 7.9 mm (male)</li>
    </ul>
    <p><a href="https://commons.wikimedia.org/wiki/File:Male_50_ohm_SMA_connector.jpg#/media/File:Male_50_ohm_SMA_connector.jpg"><img src="https://upload.wikimedia.org/wikipedia/commons/d/d5/Male_50_ohm_SMA_connector.jpg" alt="Male 50 ohm SMA connector.jpg" height="235" width="320" /></a><br />By <a href="http://bohumirzamecnik.cz//commons.wikimedia.org/w/index.php?title=User:Swift.Hg&amp;action=edit&amp;redlink=1" class="new" title="User:Swift.Hg (page does not exist)">Swift.Hg</a> - <span class="int-own-work" lang="en">Own work</span>, <a href="http://creativecommons.org/licenses/by-sa/3.0" title="Creative Commons Attribution-Share Alike 3.0">CC BY-SA 3.0</a></p>
  </li>
  <li><a href="https://en.wikipedia.org/wiki/SMC_connector">SMC</a>
    <ul>
      <li>small connector with a screw</li>
      <li>diameter: 4.8 mm</li>
    </ul>
    <p><a href="https://commons.wikimedia.org/wiki/File:SMC-Steckverbinder.jpg#/media/File:SMC-Steckverbinder.jpg"><img src="https://upload.wikimedia.org/wikipedia/commons/e/e0/SMC-Steckverbinder.jpg" alt="SMC-Steckverbinder.jpg" height="240" width="320" /></a><br />By <a href="https://de.wikipedia.org/wiki/User:DH4YM" class="extiw" title="de:User:DH4YM">DH4YM</a> at the <a href="https://de.wikipedia.org/wiki/" class="extiw" title="de:">German language Wikipedia</a>, <a href="http://creativecommons.org/licenses/by-sa/3.0/" title="Creative Commons Attribution-Share Alike 3.0">CC BY-SA 3.0</a></p>
  </li>
  <li><a href="https://en.wikipedia.org/wiki/MCX_connector">MCX</a>
    <ul>
      <li>small golden connector, no screw</li>
      <li>used on some DVB-T tuners as an alternative input</li>
      <li>outer plug diameter: 3.6 mm</li>
    </ul>
    <p><a href="https://en.wikipedia.org/wiki/File:MCX_Male%26Female.jpg#/media/File:MCX_Male%26Female.jpg"><img src="https://upload.wikimedia.org/wikipedia/en/b/bb/MCX_Male%26Female.jpg" alt="MCX Male&amp;Female.jpg" height="127" width="630" /></a><br />By <a href="http://bohumirzamecnik.cz//en.wikipedia.org/w/index.php?title=User:ChucklesNuts&amp;action=edit&amp;redlink=1" class="new" title="User:ChucklesNuts (page does not exist)">ChucklesNuts</a> (<a href="http://bohumirzamecnik.cz//en.wikipedia.org/wiki/User_talk:ChucklesNuts" title="User talk:ChucklesNuts">talk</a>) (<a href="http://bohumirzamecnik.cz//en.wikipedia.org/wiki/Special:ListFiles/ChucklesNuts" title="Special:ListFiles/ChucklesNuts">Uploads</a>) - Own work, <a href="http://bohumirzamecnik.cz//en.wikipedia.org/wiki/Wikipedia:Text_of_the_GNU_Free_Documentation_License" title="GNU Free Documentation License">GFDL</a></p>
  </li>
</ul>

<h3 id="rf-cables-and-adapters">RF cables and adapters</h3>

<p>We need to feed the microware signal from the antenna to the tuner. The choice of a cable depends on the distance.</p>

<p>In my case I used a 11 m coaxial RG-6 cable to connect antenna on an old chimney to the receiver in the attic. The cable could be shorter.</p>

<p>What impedance: typically 75 ohm.</p>

<ul>
  <li>my setup:
    <ul>
      <li>RG-6 cable</li>
      <li>F connector</li>
    </ul>
  </li>
</ul>

<h3 id="power-source">Power source</h3>

<p>Possibilities:</p>

<ul>
  <li>USB cable, power source, 230 V extension cord</li>
  <li>USB extension cord, power source</li>
  <li>power over ethernet
    <ul>
      <li>injector, extractor</li>
      <li>expensive</li>
      <li>OK for outdoor mounting</li>
    </ul>
  </li>
</ul>

<h3 id="internet-connection">Internet connection</h3>

<p>Possibilities:</p>

<ul>
  <li>ethernet</li>
  <li>WiFi</li>
</ul>

<h2 id="putting-it-together">Putting it together</h2>

<h2 id="where-to-place-and-how-to-mount-the-components">Where to place and how to mount the components?</h2>

<h3 id="options-for-mounting-the-parts">Options for mounting the parts</h3>

<ul>
  <li>antenna, receiver &amp; computer inside
    <ul>
      <li>this is easiest, eg. to test the set up</li>
      <li>(-) but the antenna doesn’t have enough sky view</li>
      <li>thus it’s not recommended at all</li>
    </ul>
  </li>
  <li><strong>antenna outside / receiver &amp; computer inside</strong>
    <ul>
      <li>(+) this is recommended since the electronic parts doesn’t have to be weatherproof sealed</li>
      <li>(+) easy to access the device</li>
      <li>needs a long-enough RF cable</li>
      <li>(-) a very long cable may attenuate the signal
        <ul>
          <li>Check the cable specification. Eg. RG-6 cable attenuation at 1000 MHz is 0.21 dB / m. You may need an amplifier. Still, an amplifier may improve signal reception even with a short cable.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>antenna &amp; receiver outside / computer inside
    <ul>
      <li>(+) only small RF attenuation due to short cable</li>
      <li>(+) easy to access the device</li>
      <li>(-) needs a long USB cable (up to 5 meters)</li>
      <li>(-) may need a <a href="http://www.yourcablestore.com/USB-Cable-Length-Limitations-And-How-To-Break-Them_ep_42-1.html">USB repeater</a> (active cable) - up to 20-30 meters</li>
    </ul>
  </li>
  <li><a href="http://imgur.com/a/Y8s2X">antenna, receiver &amp; computer outside</a>
    <ul>
      <li>(+) no need for long RF or USB cables</li>
      <li>(+) looks cool</li>
      <li>(-) more complicated network/power supply cabling
        <ul>
          <li>power-over-ethernet might be practical, but it’s expensive</li>
          <li>taking 230 V to the roof might be bad due to possible humidity</li>
          <li>power over USB - also limits on the length</li>
        </ul>
      </li>
      <li>(-) needs weatherproof case, may overheat in summer</li>
      <li>(-) harder to access the device</li>
    </ul>
  </li>
</ul>

<h3 id="antenna-mount">Antenna mount</h3>

<h3 id="a-concrete-scheme">A concrete scheme</h3>

<p>Concrete scheme of the hardware architecture of my installation:</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My Digital Nomad Story]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2016/my-digital-nomad-story/"/>
    <updated>2016-07-22T00:00:00+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2016/my-digital-nomad-story</id>
    <content type="html"><![CDATA[<p>I’ve decided to work while traveling and I’ve already made the first necessary steps. Here’s my motivation and how I’m proceeding. Since a lot of people wanted to hear from me I’d like to share the thoughts and stories from the journey.</p>

<!-- more -->

<p>Digital nomads can be defined as people who are not dependent on a particular location for making their income using digital technologies. Although it’s becoming quite a hype I don’t want to blindly follow the crowd, but rather try to solve problems with my lifestyle after well-thought decisions.</p>

<p>In short I imagine doing the work I can do well on various places of my choice, exchanging material possesions for experience, people and freedom.</p>

<h2 id="why">Why?</h2>

<h3 id="whats-wrong-with-my-present-lifestyle">What’s wrong with my present lifestyle?</h3>

<p>Basically I see a lot of problems with the way I’ve been living.</p>

<p>After 10 years in Prague (5.5 years at the university, 4.5 at work) I’ve been feeling burnt out and stuck at one place. I feel I can’t move further without making some bigger changes.</p>

<p>I’ve been putting too much energy into work, in contrast to other aspects of life, such as relationships with girls. I didn’t have much energy to go out and look for some girls. Even when I met some nice girl it was very hard for me to become more romantic. This left me heart-broke so many times. Such a long-term imbalance in a life is really not healthy, both psychically and physically.</p>

<p>After almost every workday I was feeling so tired. I’ve been having problems with bad sleep for a long time, usually not being able to fall asleep. This was even intensified by the fact I was working on my hobby projects till night. Then at the work I was drinking too much coffee which in turn made me tired at the work and not being able to sleep at the night. A feedback loop.</p>

<h3 id="life-experience-through-travel">Life experience through travel</h3>

<p>Whenever I was on a travel it was such a difference to the boring day-to-day routine. Each day was unique, full of stories one could not imagine beforehand. I made me feel happy. Only it was always very limited.</p>

<p>A lot of my travels in the past were in an organized group (with family as a child or with a choir). It was comfortable because I didn’t have to organize anything, but there was not much freedom - to choose where I want to go and what to do. Two years ago I made a solo month-long road trip to Scandinavia and it was a huge difference, more freedom and more happiness.</p>

<p>I believe going out of the comfort zone, taking care of oneself and meeting a lot of people and places is beneficial. It opens up your mind, widens your sight and makes you a less stressed, more humble and a better person overall.</p>

<p>In addition you have a lot of stories to tell the people, so that you have an inexhaustible topic for conversation. It makes you interesting for other people, including those you’d like to date.</p>

<h3 id="more-freedom-in-income">More freedom in income</h3>

<p>The classical model of making money is to be either employed or run your own local business. Both usually tie you down to a single place. Being employed also ties you in time and in what you are working on.</p>

<p>The digital world of the last years opens up a whole new set of possibilities for income. Doing something useful for other people or capturing attention is far easier and thanks to internet not limited locally. I’ll talk about this in more detail below. The goal is to make the traveling sustainable in the long term.</p>

<h3 id="unique-opportunity">Unique opportunity</h3>

<p>This is an awesome opportunity that may not be there in a few years. The reasons might be various: disease, injury, family with small children, bad security situation (civil war, natural disaster, closed borders), etc.</p>

<p>In my software engineering profession it is quite easy to work remotely these days. Also there’s a huge demand for good programmers (greater than the supply).</p>

<p>There are ten of thousands of digital nomads out there. It’s quite easy to meet some and share the experience. There’s also a lot of services for nomads by nomads, so the journey might be even quite comfortable.</p>

<h3 id="minimalism">Minimalism</h3>

<p>We naturally try to collect things. We think they make our lives more comfortable, they will become useful someday or we just don’t have the mental power to get rid of old things for which we paid so much money.</p>

<p>When I have many things they distract me and make me sad that I don’t have time/energy to utilize them. An example is an electric guitar, my dream at the high school. So let’s just travel with a single carry-on backpack that can fit into the plane cabin! This can naturally lead to a minimalist life-style. I will be forced to think carefully before buying anything physical, because it is a tangible burden on my back and the backpack is not as inflatable as a house.</p>

<h3 id="location-independent-family">Location independent family</h3>

<p>Being able not to be tied to a big city for making decent living with a family is one of the longer-term benefits of digital nomading. After establishing a family with a wife and children nothing forces me to travel perpetually. It is an option. But nothing would force me to stay in a city. The idea is to settle down on the countryside in a natural house near a forest, do the same digital nomad work, have less stress and the time for raising the children. IMHO this is the most valuable gift I can prepare now and give to my future family.</p>

<h2 id="how">How?</h2>

<h3 id="goals">Goals</h3>

<p>When a goal is clarified it is possible to achieve it by a conscious effort, not by pure chance. Still one has to do a lot of things, many of them not quite comfortable.</p>

<p>So to be clear the goals in short are:</p>

<ul>
  <li>get life experience through traveling</li>
  <li>make income independent on location</li>
  <li>be able to control the time for work</li>
  <li>have less stress, better sleep and more free time</li>
  <li>make good relationships with girls</li>
  <li>dedicate time to work that really matters to me</li>
  <li>dedicate time to create passive income products</li>
  <li>get around with owning less physical things</li>
</ul>

<h3 id="my-previous-attempts">My previous attempts</h3>

<p>Probably the first impulse that opened my eyes and showed me this kind of life-style was in 2013. Back in Etnetera one of the founders recommended me to read the 4-Hour Work Week book. Not only it described it, also it’s kind of concrete tutorial how to achieve it. From thinking about where to be employed I started thinking about my own products.</p>

<p>In winter 2013 I decided to try turning a hobby project of mine into a business. I was fascinated by music theory and was developing an application called HarmonEye, which listens to music via microphone and shows visually the tones or chords being played. I thought if I had more free time I could write it as a mobile app and make money from it.</p>

<p>So I left the job and started working. It was only partially successful and you can read the experience in a separate article <a href="http://bohumirzamecnik.cz/blog/2015/harmoneye-hard-won-experience/">HarmonEye: Hard-won Experience After Three Years of My Life</a>. In short, although I made some money I was not able to make the income sustainable since I took a big goal (like a PhD project) and was focusing too much on the technical details than on the business side. Also I didn’t travel at all, rather stayed at home in a not very good atmosphere.</p>

<p>In April 2014 I learnt more practically about Machine Learning at Coursera. It just came out of blue and I realized this is the tool I need for HarmonEye and which could solve many hard problems I’ve been thinking about since high school.</p>

<p>After burning myself out on this app (working day and night) I decided to make a month-long solo <a href="http://bohumirzamecnik.cz/blog/categories/scandinavia-2014/">road trip around Baltic sea and Scandinavia</a> (6500 km). It was an awesome experience, but I could not continue, since I ran out of money. Also I was limited by going to another job.</p>

<p>I realized machine learning is a big wave of revolution and it is useful way beyond music processing. So I was lucky enough to find a job in ML and Python very soon. After returning from the road trip I started in July 2014 in Wikidi. It was quite interesting and I learnt a lot about deep learning. Still, soon I found out the projects are a bit like Don Quijote and windmills.</p>

<p>So in February 2015 I was hired to Jumpshot (a spin-off of AVAST) to work as a big data engineer and scale ML models from data scientists. This was the best job I can remember. The people were awesome and very smart, the projects challenging, but still one could excel in its field. At home I was doing some machine learning projects, mostly related to music, since at work there was too much engineering work and too little ML work for me to do. Some bright exceptions were a week-long deep learning workshop on a supercomputer cluster in Ostrava, Machine Learning Prague conference and Apache Big Data Budapest conference. During that time I was attending the Machine Learning Meetups quite regularly and got into contact with interesting people from the local community.</p>

<p>In August 2015 I attended the DNX Global Digital Nomad conference in Berlin. Around 500 digital nomads gathered at one place, many of them had talks, and one could meet and talk with a lot of awesome people. It was one more impetus to go nomad one day. Back then when talking with the people and telling them my story I realized what kind of digital products I can create. More on that soon.</p>

<p>While at Jumpshot There were flashbacks of past travels that filled me with passion for next travel. I was trying to think about how to switch to the digital nomad mode a bit smarter than a few years ago. Also I tried to save some money.</p>

<p>I had a vast amount of ideas what to do, that came to me usually at the night when I could not sleep, but very low energy to actually do something. When I could work at hours of my choice I could sleep better and don’t have to drink coffee.</p>

<p>An insane number of HRs and headhunters have been trying to capture me to do some other job (including for the top players). On one hand I really appreciate it, on the other hand I didn’t want to be trapped just at some other place. Although I’d like to have maintain good relationship with HRs, most of the time it’s very hard to respond to all the offers. After some years in practice as a software engineer I can imagine how a very nice girl might feel when crowds of men are approaching her.</p>

<h3 id="the-decision">The decision</h3>

<p>In 2016 I planned to go somewhere in the summer. At one all-hands meeting regarding bonuses I asked myself and my boss: How can any bonus keep me if I’m not happy at the work? We then discussed this in private and that was the moment I really decided to go. So at the end of May 2016 I quit Jumpshot to start the nomad journey. I have to say the farewell was very friendly and I’m looking forward to stay in contact with the Jumpshot folks.</p>

<p>The plan was to take at least of month free, just relax after years of tension and prepare the travel. I didn’t want to repeat the mistake burning down with HarmonEye.</p>

<p>I started to tell people about my decision which was hardening it. I could better clarify the reasons and plans and it would seem lame to change the mind. A lot of friends wished me the best and “envy” that I can travel. They would like to travel but cannot for various reasons. At least I can share my stories with them on the blog.</p>

<h3 id="where-to-go">Where to go?</h3>

<p>The path itself is the goal.</p>

<p>In fact it does not matter that crucially where one should go. The act of going of the comfortable home is what matters. Still I was thinking where to go.</p>

<p>Since in mid July 2016 there was a planned trip with our high school choir Corale to sing in Hungary and Serbia so it looked quite nice to continue from Serbia around the Eastern Europe (Bulgaria, Romania, Hungary, etc.).</p>

<p>When I’m writing this in July 2016 after the trip I’m still in Czech republic at a lake beach. I just underestimated moving my things from Prague so there was only a little time to prepare for the journey. So right now I leave it a bit open for a short time. Maybe I’ll go to Eastern Europe, maybe I’ll visit other places from the wishlist - Scotland, Madeira, Spain, etc. Let’s roll the Kiwi (Skypicker) dice!</p>

<p>In the winter, however, it would be nice to go to some warmer country in Southeast Asia, such as Thailand or Vietnam.</p>

<p>Overall, I’d like countries that are rather secure and warm, relatively cheap, and hosting other nomads. A nice site that helped me to choose places according to experience of other people is <a href="http://nomadlist.com">NomadList</a>.</p>

<h3 id="what-to-do">What to do?</h3>

<p>Now the “digital” part of digital nomad. In order to sustain long-term traveling I need to make a reasonable income. As I thought about it there are at least three groups of work for a software engineer.</p>

<h4 id="remote-job">Remote job</h4>

<p>It is the least risky, but least free option. You just work as a full-time or part-time employee for somebody, usually from a rather stable place (eg. a month somewhere). The amount of work is rather unlimited, the money is predictable, yet you can’t choose much what to do or when. A good place to watch is <a href="http://remoteok.io">remoteok.io</a>.</p>

<h4 id="remote-consulting-work">Remote consulting work</h4>

<p>You do similar work as in a regular job, except that you do it on your own for clients. In addition you have to take care of other stuff such as accounting and finding the clients in the first place. The amount of work might be variable and it might take some work to find the clients. At best create such a profile and portfolio so that people in your network offer you consulting work themselves!</p>

<p>An alternative is to offer your services on various freelancing sites. Some of them (E-Lance) are very competitive, full of people from Asia that compete for the lowest prices. Some of them (Toptal) are more high-end and require you to pass a test, then the work is almost certain.</p>

<p>The benefit is that you agree on shorter limited projects, so that you’re not limited to do full-time work for the whole year. It depends how you arrange it. It is possible to do a week for one client, then a week for another and then take a week off for your projects or for relaxing. More freedom for more responsibility. It’s a nice trade-off.</p>

<h4 id="own-digital-products">Own digital products</h4>

<p>The previous two options are active income - you rent your time. That is, however, limited and cannot scale. There’s another ultimate option - passive income. You once dedicate time to create a product and set up its automated sales pipeline, then you just let it perform and sometimes update it. The thing is that once it’s set up it doesn’t require your continuous attention and you can work on other products. A benefit of digital products is very cheap distrubution via internet.</p>

<p>An archetypical example of a digital product is an e-book tutorial or course. You dedicate a lot of time (years, months) to some activity you do for fun or work and become an expert. Then you can teach it to other people. Ideally it’s a time-consuming activity and it’s useful for making money. So that you can save someone years of work by providing a guidance and that person can in turn make money by learning that activity, not just learning it for fun. That way you can put a high price tag on the product and still let it appear well worth that cost, which is true.</p>

<p>Another examples might be a mobile application or an affiliate marketing website.</p>

<p>This option provides the most freedom, since you can dedicate time to activities you really love. It is scalable, ie. not dependent on a limited amount of time you can rent. The success only depends on your skills and luck. If you do it well you can in the long run make more money than in a regular job. It allows you to make free time which you can utilize to learn new skills and create other such digital products. On the other hand, the downside is the high effort in creating an audience, finding a good product-market fit and creating the product itself, something useful that people really want to buy to solve their problem. Fortunately there’s a lot of help from people who did it the hard way, succeeded and described why.</p>

<p>Personally, I have several ideas for digital products and I’m going to explore the market fit soon. Still the safest start point now is consulting work since I’m happy that a few opportunities already came before I even departed.</p>

<h3 id="the-preparation">The preparation</h3>

<p>Since this is a rather long-term project I needs some preparation.</p>

<h4 id="organization-stuff">Organization stuff</h4>

<p>A quick overview from my particular case:</p>

<ul>
  <li>save some money</li>
  <li>backup data, eg. to DropBox</li>
  <li>leave the job</li>
  <li>leave the rented flat and move the things away</li>
  <li>arrange travel insurance</li>
  <li>register a self-employment license
    <ul>
      <li>I have it done a few years ago</li>
    </ul>
  </li>
  <li>figure out mandatory social and medical insurance for self-employment</li>
  <li>buy needed travel stuff</li>
  <li>sell/give unnecessary stuff</li>
  <li>take necessary vaccinations</li>
  <li>have the teeth checked</li>
  <li>prepare credit card(s)</li>
  <li>decide where to go</li>
  <li>figure out options for accomodation at the destinations
    <ul>
      <li>Couchsurfing, hostels, AirBnb, hotels, etc.</li>
    </ul>
  </li>
  <li>setup a computer with a GPU for training machine learning models</li>
</ul>

<h4 id="gear">Gear</h4>

<p>My goal is to travel with a single backpack of carry-on size so that I can take a flight without having to check-in some big luggage. It means going with at most around 10 kg / 40 litres. Thus all the gear must be optimized with respect to weight.</p>

<p>I’m going to write more on my gear after getting some more practical experience with it.</p>

<h4 id="my-preparation-period">My preparation period</h4>

<p>I decided to set apart some time after leaving the job before starting the preparation for travel. The goal was to prepare the abovementioned stuff and to relax. Originally I though about going for a month into the woods, just be offline, walk over forests, sleep there, do bushcraft stuff, etc. Just to make some kind of hard reset.</p>

<p>Although this was the best-case idea I had to crop it a bit in order to do other useful preparation activites. Still, I have to say I was able to relax and be really happy.</p>

<p>The first week in June I was just walking around Prague and searching for good travel gear. I managed to buy a lot of useful thing at reasonable prices. The next week I helped my parents at home. After sprinting at work I could not help and still had to code something for the sake of itself. Then my brother returned from New Zealand after 2.5 years. So we made some party together. We decided to make a trip to sandstone rocks and to visit our relatives near Prague and in the nearby countries. This offline week without computer was very relaxing.</p>

<p>The next two weeks I decided to spend with girls in Prague. The goal was to overcome the fear of telling girls: “Hi, you’re pretty. I like you.” The first day I just roamed the streets without much success, but the second day something changed. Indeed, I was able to make a small date with one girl. A shower of adrenaline and happiness. Yet, the next days were much better. I met a lot of girls, some of them wanted to chat, some of them even to go for a date. At the end I met a nice girl on a guitar picknick which was genuinely interested and me too. Unfortunately then I had to move from Prague. Still, there were days where I felt really happy, much happier than in the past many years. This is the beginning of something big.</p>

<p>I left moving my things from Prague to the last moment and underrated any preparation. Thanks to my brother, experienced with packing trailers full of audio equipment, we were able to fit the piles of stuff into the car and trailer. There was absolutely no place left. This morning moving sprint was very stressful for me and at that moment I realized how in fact he things piss me off. So I decided I really have to get rid of as much as possible.</p>

<p>To make things complicated I got recently fascinated by plane spotting on FlightRadar24 and on the sky. My garden was on a crossroads of two landing corridors for the PRG airport and also a lot of helicopters with nice sounds were flying by. During the two last weeks in Prague I decided to build my own receiver of ADS-B signals (plane identification, position, direction, velocity, etc.) which planes transmit to prevent collisions. Surprisingly it is possible to catch them with a cheap DVB-T USB stick and some Raspberry Pi. It might be interesting data for an analysis, visualization and machine learning. More on that in some other upcoming article.</p>

<p>So instead of packing the things I was installing the hardware and software and was staring at the map. Fortunately the moving was done. Only a few hours were left to pack for the trip to Hungary and Serbia. The evening before departure I decided that it not wise to stick with the original plan at all costs. Thus after returning back from the tour I’ll dedicate some time to taming the moved pile of stuff, try to actually sell what’s unnecessary and pack for the journey without a time stress. Otherwise the untamed stuff would subconsciously piss me off and I still could not be happy.</p>

<p>The next day we headed with the Corale choir to sing in Veszprém, Hungary and Kruščice, Serbia. At the latter place there’s a community of Czech people who came there about two hundered years ago. They organize a festival of Czech culture with choirs and folklore dancers. The events turned out very well and the people were very kind and genuinely hospitable. Some people said our concert in Kruščice was the best they ever remember in Corale so far.</p>

<p>However, on the way back I had to say people in Corale good bye after almost 15 years there, since I won’t be able to attend the choir while on travel. Singing in Corale for so long was a unique experience but I feel sometimes it’s good to stop at the best moment.</p>

<p>Indeed, sometimes you have to forego a lot to make room for new people and experience.</p>

<h2 id="how-to-i-imagine-myself-in-a-year">How to I imagine myself in a year?</h2>

<ul>
  <li>be less stressed and more relaxed</li>
  <li>have more free time and energy to spend on useful activities</li>
  <li>be able to make money while on travel</li>
  <li>be more comfortable with girls</li>
  <li>have made a nice machine learning portfolio</li>
  <li>have written a lot of articles and some e-books</li>
  <li>met a lot of great people</li>
  <li>seen a lot of nice places</li>
  <li>just be happy more often</li>
</ul>

<p>Stay tuned for next blog posts!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Make STL With SVG Logo and Text in OpenSCAD]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2016/how-to-make-stl-with-svg-logo-and-text-in-openscad/"/>
    <updated>2016-05-01T18:02:51+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2016/how-to-make-stl-with-svg-logo-and-text-in-openscad</id>
    <content type="html"><![CDATA[<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/example_reel.png" width="300" align="right" />
We’ll see how to create an STL model of a stylized filament reel with a logo from SVG and some text without clicking the mouse. Yes we’ll write it procedurally in OpenSCAD, use templating and automate the whole thing. We’ll see how OpenSCAD is a really natural tool for programmer and it very easy to start playing with and get impressive results.
&lt;div style=&#8221;clear:both&#8221;&gt;&lt;/div&gt;</p>

<!--more-->

<p>Our today’s goal is to prepare around 20 3D-printed things representing filament reels, each with a inset logo and a short name of the material. This little weekend project was done for <a href="http://www.svet-3d-tisku.cz/">Svět 3D Tisku</a> (3D Print World), a local 3D print company ran by my parents, for <a href="http://3dexpo.cz/">3D Expo Prague 2016</a>. Imagine a big poster to present a collection of filament materials and for each there’s a nice small tangible artifact made of that material.</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/example_reel.png" /></p>

<h2 id="openscad---constructive-solid-geometry">OpenSCAD - Constructive Solid Geometry</h2>

<p>Since I like programming more than GUI modeling tools and mouse clicking, I decided to try <a href="http://www.openscad.org/">OpenSCAD</a>. It allows to make 3D models using the <a href="https://en.wikipedia.org/wiki/Constructive_solid_geometry">Constructive Solid Geometry</a> (CSG) and <a href="https://en.wikipedia.org/wiki/Procedural_modeling">procedural modeling</a> paradigms. Ie. we the model from primitive parts (cube, 2D polygon, linear extrusion), by applying transformations (traslate, scale, rotate) and set operations (union, intersection, difference). The model is described by a custom programming language. This is a different to the triangle mesh representation where only the border, not the solid itself is described.</p>

<p>For programmers the whole concept is much more intuitive and natural, eg. when compared to Blender with its overly complex UI with hard learning curve.</p>

<p>After I finished this project it felt vary natual and familiar. Then I realized I’ve already done something similar a few years ago in open-source <a href="https://renderman.pixar.com/">RenderMan</a> implementation <a href="http://www.renderpixie.com/gallery.html">Pixie</a> for the university projected on the <a href="http://cgg.mff.cuni.cz/~wilkie/Website/NPGR027.html">Shading Languages</a> course.</p>

<p>Please refer to the <a href="https://en.wikibooks.org/wiki/OpenSCAD_User_Manual">OpenSCAD User Manual</a> and the example models for the basics of OpenSCAD. Basically you write your code in one pane and see the model in the other. Useful keyboard shortcuts and commands.</p>

<ul>
  <li><code>F5</code> - refresh the preview</li>
  <li><code>F6</code> - render the model (do this before saving to STL)</li>
  <li><code>File</code> -&gt; <code>Export</code> -&gt; <code>Export to STL</code></li>
  <li><code>CMD-D</code> - comment</li>
  <li><code>CMD-SHIFT-D</code> - uncomment</li>
</ul>

<p>Comments are C-like, ie. <code>// ...</code> and <code>/* ... */</code></p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/openscad.png" /></p>

<h2 id="creating-a-model---step-by-step">Creating a model - step by step</h2>

<p>We would like to get a shape that roughly looks like a <a href="https://www.google.com/search?q=filament+reel">filament reel</a> but is not too complex. On top of it we would like to put a logo and some abbreviation of the material name. We can model it in the dimensions of a real reel and than scale it to the final model size.</p>

<p>Real world example (colorFabb COPPERFILL Ø 2,85 m / 4m):</p>

<p><a href="http://eshop.svet-3d-tisku.cz/3d-tiskovy-material/tiskova-struna-medena-3d-filament-copperfill--2-85-mm-10m/"><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/copperfill_reel.jpg" /></a></p>

<p>There are example snippets of code throughout the article. The complete source code is available in a git repo linked at the end of the article. You can clone it and play with it yourself. It’s fully working.</p>

<h2 id="basic-reel-shape">Basic reel shape</h2>

<p>The basic shape is a cylinder, ie. an extruded circle. The <code>$fn</code> argument makes the circle smoother - the circle is represented as a regular polygon and <code>$fn</code> specifies the number of its edges. Eg. cylinder of 190mm diameter, 20 mm high to represent the inner reel:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">linear_extrude(height=20) {
</span><span class="line">    circle(d=190, $fn=200);
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In the final model it is shown in red.</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/inner_cylinder.png" /></p>

<h3 id="functions-set-operations">Functions, set operations</h3>

<p>Let’s add two outer reels and a hole. As I said the model is really stylized and so the proportions do not match excatly a real-world reel. We can transform the primitives and operate on them with set operations. We can also extract constants to variables and refactor parts into functions (modules) which also can be parameterized.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
</pre></td><td class="code"><pre><code class=""><span class="line">outer_diameter = 200;
</span><span class="line">reel_diameter = 190;
</span><span class="line">hole_diameter = 55;
</span><span class="line">width = 20;
</span><span class="line">outer_reel_width = 5;
</span><span class="line">rim_height = 2;
</span><span class="line">
</span><span class="line">module inner_reel() {
</span><span class="line">    # without a semicolon this transformations affects the next statement
</span><span class="line">    translate([0, 0, -width/2])
</span><span class="line">    linear_extrude(height=width-rim_height*2) {
</span><span class="line">        circle(d=reel_diameter, $fn=200);
</span><span class="line">    }
</span><span class="line">}
</span><span class="line">module plain_outer_reel() {
</span><span class="line">    linear_extrude(height=outer_reel_width) {
</span><span class="line">        circle(d=outer_diameter, $fn=400);
</span><span class="line">    }
</span><span class="line">}
</span><span class="line">
</span><span class="line">module hole() {
</span><span class="line">    translate([0, 0, -width])
</span><span class="line">    linear_extrude(height=2*width) {
</span><span class="line">        circle(d=hole_diameter, $fn=200);
</span><span class="line">    }
</span><span class="line">}
</span><span class="line">
</span><span class="line"># CSG set operations
</span><span class="line">difference() {
</span><span class="line">  union() {
</span><span class="line">    inner_reel();
</span><span class="line">    plain_outer_reel();
</span><span class="line">  }
</span><span class="line">  hole();
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/outer_cylinders.png" /></p>

<h3 id="tip---visual-debugging">Tip - visual debugging</h3>

<p>A very useful way to ensure you are making the correct operations is visual debugging. Just add a <code>#</code> character before any part and it is displayed in transparent red. This way you can be sure what you are intersecting and diffing.</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/hole.png" /></p>

<h3 id="beveled-side--ribs">Beveled side + ribs</h3>

<p>Let’s add some rim by beveling the side and add some ribs just to make it look a bit more like a real reel.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
</pre></td><td class="code"><pre><code class=""><span class="line">module rib() {
</span><span class="line">    translate([hole_diameter/2 + rib_margin, -rim_height/2, outer_reel_width - rim_height])
</span><span class="line">    cube([outer_diameter/2 - (hole_diameter/2 + 2*rib_margin), rim_height, rim_height]);
</span><span class="line">}
</span><span class="line">
</span><span class="line">module ribs() {
</span><span class="line">    # this is the power of procedural models vs. clicking!
</span><span class="line">    for (angle=[0, 60, 120, 180, 240, 300]) {
</span><span class="line">        rotate(angle) rib();
</span><span class="line">    }
</span><span class="line">}
</span><span class="line">
</span><span class="line">module outer_reel() {
</span><span class="line">    union() {
</span><span class="line">        ribs();
</span><span class="line">        difference() {
</span><span class="line">            plain_outer_reel();
</span><span class="line">            color("gray")
</span><span class="line">            translate([0, 0, outer_reel_width - 2])
</span><span class="line">            linear_extrude(height=2+1) {
</span><span class="line">                circle(d=outer_diameter - 5, $fn=400);
</span><span class="line">            }
</span><span class="line">        }
</span><span class="line">    }
</span><span class="line">}
</span><span class="line">
</span><span class="line">module plain_reel() {
</span><span class="line">    inner_reel();
</span><span class="line">    translate([0, 0, width / 2 - outer_reel_width])
</span><span class="line">    // upper reel
</span><span class="line">    outer_reel();
</span><span class="line">    // lower reel
</span><span class="line">    translate([0, 0, -width / 2])
</span><span class="line">    rotate([180, 0, 0])
</span><span class="line">    plain_outer_reel();
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/bevel_and_ribs.png" /></p>

<h3 id="conic-supports">Conic supports</h3>

<p>Originally I though it would be nice to make some thin flat outer circular parts of the reel (that holds the filament from sides). When we printed it I realized it needs supports, otherwise the printer just extrudes into air. To avoid using supports and save some priting time we modified the models to make some small supports directly in the model. Just add some conic sections that smoothly interpolate betweeen the inner and outer diameter.</p>

<p>Fortunately OpenSCAD provides this functionality right in the <code>linear_extrude</code> primitive, just and the <code>scale</code> parameter:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
</pre></td><td class="code"><pre><code class=""><span class="line">module conic_support() {
</span><span class="line">    linear_extrude(height=4, scale=1.05) {
</span><span class="line">        circle(d=reel_diameter, $fn=200);
</span><span class="line">    }
</span><span class="line">}
</span><span class="line">
</span><span class="line">module inner_reel() {
</span><span class="line">    // inner cylinder
</span><span class="line">    translate([0, 0, -width/2])
</span><span class="line">    linear_extrude(height=width-rim_height*2) {
</span><span class="line">        circle(d=reel_diameter, $fn=200);
</span><span class="line">    }
</span><span class="line">
</span><span class="line">    // upper conic support
</span><span class="line">    translate([0, 0, 1.1])
</span><span class="line">    conic_support();
</span><span class="line">
</span><span class="line">    // lower conic support    
</span><span class="line">    translate([0, 0, -6.1])
</span><span class="line">    rotate([180, 0, 0])
</span><span class="line">    conic_support();
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>It worked like charm and the models was printed well.</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/conic_supports.png" /></p>

<h2 id="logo---from-svg">Logo - from SVG</h2>

<p>Now when we have a nice reel let’s enhance it by adding our logo. Our logo is some vector graphics, so a <a href="https://en.wikibooks.org/wiki/OpenSCAD_User_Manual/DXF_Extrusion">DXF extrusion</a> is an option.</p>

<p>I’ve extracted just a part of the logo from an AI (Illustrator) file and saved it as SVG. OpenSCAD can only open 2D vector files from DXF (Autocad), not SVG, so we have to first convert the SVG to DXF.</p>

<p>I’ve tried a few options and only this Inkscape plugin for export the DXF worked well: <a href="https://github.com/brad/Inkscape-OpenSCAD-DXF-Export">Inkscape-OpenSCAD-DXF-Export</a>. Just download the repo and copy the dir and <code>*.inx</code> to <code>~/.config/inkscape/extensions</code> (on Mac) and than start Inkscape. Then just open the SVG and <code>File -&gt; Save copy -&gt; OpenSCAD DXF Output</code>.</p>

<p>Then in OpenSCAD we import it into a 2D object:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">import('logo.dxf');</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In order to use it in CSG operations we have to extrude it:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class=""><span class="line">module logo(height) {
</span><span class="line">    linear_extrude(height = height) {
</span><span class="line">        scale(0.15)
</span><span class="line">        import(logo_file);
</span><span class="line">    }
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In case nothing appears, make sure you select the default layer or the proper one. Look for <code>AcDbLayerTableRecord</code> in the DXF file. I once copied an example from the docs and it selected some other layer and I though the DXF file is not compatible. Also the model from DXF might have to be translated to the original of coordinates.</p>

<p>Let’s inscribe the logo in the upper reel part:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class=""><span class="line">module logo_inscription() {
</span><span class="line">    translate([0, -0.7 * outer_diameter/2, width/2 - rim_height - inscription_depth])
</span><span class="line">    translate([-32.5,-22,0])
</span><span class="line">    logo(1.1 * inscription_depth); // + epsilon
</span><span class="line">}
</span><span class="line">
</span><span class="line">difference() {
</span><span class="line">    plain_reel();
</span><span class="line">    logo_inscription();
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/logo.png" /></p>

<p>The logo itself is a bit thicker and if we make it as thick as is lowered we may get into numerical problems. The solution is easy, just make it overlap a bit (by a small epsilon). If you’ve ever came across computational geometry or numerical programming this should have been deeply rooted in your blood :). Otherwide, you’ve just learned. Tip for reading: <a href="http://gamedevs.org/uploads/numerical-robustness-geometric-calculations.pdf">Numerical Robustness
(for Geometric Calculations)</a>.</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/epsilon.png" /></p>

<h2 id="text">Text</h2>

<p>Then we’d like to add some short description text inscriped in the the upper side similarly as the logo. OpenSCAD directly supports 2D text primitives which can be then extruded. That’s exactly what we need.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">linear_extrude(height=1) {
</span><span class="line">  text("ABS");
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>We can set the text size, alignment and font to customize the text for aesthetics and legibility:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">font = "Liberation Sans:style=Bold";
</span><span class="line">text("ABS", 20, halign="center", font=font);</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>We have texts of various length like “ABS”, “BRASS”, “PETG ESD” so we need to customize the font size and and Y position individually for a good git.</p>

<h3 id="multiline-text">Multiline text</h3>

<p>In order to use the space well without compromizing legibility we can split the text into multiple lines (in this case usually two). Since OpenSCAD’s <code>text()</code> only supports a single line, we need to make more translated <code>text()</code> objects and union them. We’re not the first to come across this problem and fortunately <a href="https://www.reddit.com/r/openscad/comments/3jwobs/line_feed_in_openscad_text/">other people managed to get a working solution</a>. So we’ll use a snippet by user <em>iggy_koopa</em>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class=""><span class="line">module multiline_text(lines, size){
</span><span class="line">  // https://www.reddit.com/r/openscad/comments/3jwobs/line_feed_in_openscad_text/
</span><span class="line">    union(){
</span><span class="line">        for (i = [0 : len(lines)-1]) {
</span><span class="line">            translate([0 , -i * (size + 2), 0])
</span><span class="line">            text(lines[i], size, halign="center", font=font);
</span><span class="line">        }
</span><span class="line">    }
</span><span class="line">}
</span><span class="line">
</span><span class="line">module description(desc, size, y_pos) {
</span><span class="line">    translate([0, y_pos * outer_diameter/2, width/2 - rim_height - inscription_depth])
</span><span class="line">    // epsilon trick
</span><span class="line">    linear_extrude(height=1.1 * inscription_depth) {
</span><span class="line">        multiline_text(desc, size);
</span><span class="line">    }
</span><span class="line">}
</span><span class="line">
</span><span class="line">description(["ABS", "ESD"], 17, 0.7);</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The same epsilon trick as with the logo still holds.</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/text.png" /></p>

<h2 id="scaling-the-whole-model">Scaling the whole model</h2>

<p>The basic units in OpenSCAD are millimeters. Since we used dimensions of a real reel (with 20 cm diameter) but want our models smaller (eg. 8 cm), we can just scale the shole model.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class=""><span class="line">module reel(desc, desc_size, desc_y_pos) {
</span><span class="line">    scale(8 / 20)
</span><span class="line">    difference() {
</span><span class="line">        difference() {
</span><span class="line">            plain_reel();
</span><span class="line">            union() {
</span><span class="line">                logo_inscription();
</span><span class="line">                description(desc, desc_size, desc_y_pos);
</span><span class="line">            }
</span><span class="line">        }
</span><span class="line">        hole();
</span><span class="line">    }
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="exporting-to-stl">Exporting to STL</h2>

<p>Now we have single reel model and it’s time to export an STL. In the UI it is quite simple:</p>

<ul>
  <li><code>F6</code> - render the model</li>
  <li><em>File</em> -&gt; <em>Export</em> -&gt; <em>Export to STL</em></li>
</ul>

<p>In order to automate the things it would be nice to call <a href="https://en.wikibooks.org/wiki/OpenSCAD_User_Manual/Using_OpenSCAD_in_a_command_line_environment">OpenSCAD via command line</a>. Fortunately, it supports it!</p>

<p>On Mac the binary is buried in <code>/Applications</code>, so to use it a little bit more comfortable we can link it to our <code>~/bin</code>. This is optional.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line"># make sure you have ~/bin in your PATH
</span><span class="line">$ mkdir -p ~/bin
</span><span class="line">$ export PATH=PATH:~/bin
</span><span class="line">$ ln -s /Applications/OpenSCAD.app/Contents/MacOS/OpenSCAD ~/bin/openscad</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Then we can produce STL from an SCAD file this way:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">$ openscad -o foo.stl -D 'quality="production"' foo.scad</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>It is quite slow. This model took about 1:15 min.</p>

<h2 id="exporting-to-png">Exporting to PNG</h2>

<p>Similarly we can export a thumbnail to PNG:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">$ openscad -o foo.png foo.scad</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Also we can set the camera position and orientation:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">$ openscad -o foo.png foo.scad --camera=0,0,220,0,0,0</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Refer to the docs for details.</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/reel_00_ABS_ESD.png" /></p>

<h2 id="parametric-models">Parametric models</h2>

<p>It is nice that we were able to create one model but we want a models for each of ~ 20 materials. Well, we could copy a model, change something and save as another file. But such approach get too cumbersome when we want to change something and propagate the change into all the instnaces. Better, we can try to automate the whole process.</p>

<p>So we can make a parameterized model with variable text, font size and text position and then use it to make multiple instances. We want a separate STL for each model, so we have to create mulitple separate SCAD files.</p>

<p>An easy approach is to use eg. Python as the templating engine, store the parameters in a table (a CSV file) and generate multiple SCAD files. Then for each SCAD file we’ll generate the STL and PNG thumbnail.</p>

<p>We store the parameterized model in the <code>reel.scad</code> file and provide a function:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">module reel(desc, desc_size, desc_y_pos) {
</span><span class="line">  // ...
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Then we can include this file and call the <code>reel()</code> function to instantiate the model with given parameters and store it to other file:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">use &lt;reel.scad&gt;;
</span><span class="line">reel(["ABS", "ESD"], 18, 0.7);</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="automating-the-whole-thing">Automating the whole thing</h2>

<h3 id="python-template-generator">Python template generator</h3>

<p>We store the definitions into a CSV file <code>reel_texts.csv</code>. The text column is split on whitespace into multiple lines. The size is text size in mm, the y_pos is the relative Y position.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">text,size,y_pos
</span><span class="line">ABS ESD,18,0.7
</span><span class="line">PETG ESD,18,0.7
</span><span class="line">ABS,20,0.6
</span><span class="line">[...]</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>To read the CSV we use <code>pandas</code>. Then we transform each row into a SCAD source code and store it into a file.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class=""><span class="line">import os
</span><span class="line">import pandas as pd
</span><span class="line">
</span><span class="line">df = pd.read_csv('reel_texts.csv', dtype=str)
</span><span class="line">
</span><span class="line">template = """use &lt;../reel.scad&gt;;
</span><span class="line">reel([%s], %s, %s);
</span><span class="line">"""
</span><span class="line">
</span><span class="line">dir_name = 'reels_scad'
</span><span class="line">os.makedirs(dir_name, exist_ok=True)
</span><span class="line">for index, row in df.iterrows():
</span><span class="line">    normalized_text = row['text'].replace(' ', '_').replace('/', '')
</span><span class="line">    file_name = '%s/reel_%02d_%s.scad' % (dir_name, index, normalized_text)
</span><span class="line">    with open(file_name, 'w') as f:
</span><span class="line">        text = ', '.join(['"%s"' % t for t in row['text'].split(' ')])
</span><span class="line">        f.write(template % (text, row['size'], row['y_pos']))</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="converting-to-stl-in-batch">Converting to STL in batch</h3>

<p>Let’s convert all the generated SCAD files to STL files and store them to another directory. For ~ 20 files it took about half an hour. Right now I haven’t tried to optimize it.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class=""><span class="line">#!/bin/bash
</span><span class="line"># Convert all reels from SCAD to STL
</span><span class="line">STL_DIR=stl
</span><span class="line">mkdir -p $STL_DIR
</span><span class="line">for SCAD_FILE in reels_scad/*.scad; do
</span><span class="line">  STL_FILE=$STL_DIR/$(basename $SCAD_FILE .scad).stl
</span><span class="line">  time openscad -o $STL_FILE -D 'quality="production"' $SCAD_FILE
</span><span class="line">done</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="converting-to-png-in-batch">Converting to PNG in batch</h3>

<p>We can do similar thing to obtain PNG thumbnails:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class=""><span class="line">PNG_DIR=png
</span><span class="line">mkdir -p $PNG_DIR
</span><span class="line">for SCAD_FILE in reels_scad/*.scad; do
</span><span class="line">  PNG_FILE=$PNG_DIR/$(basename $SCAD_FILE .scad).png
</span><span class="line">  openscad -o $PNG_FILE $SCAD_FILE --camera=0,0,220,0,0,0
</span><span class="line">done</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="bonus---array-of-thumbnails">Bonus - array of thumbnails</h3>

<p>It might be nice to see all the thumbnails in a single image. Python, numpy and matplotlib can save us and to the job in a few lines of code.</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/how-to-make-stl-with-svg-logo-and-text-in-openscad/thumbnails.png" /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
</pre></td><td class="code"><pre><code class=""><span class="line">"""
</span><span class="line">Makes a single thumbnail image from a set of individual PNGs.
</span><span class="line">Order the images into a 2D matrix, so that it's nicely viewable.
</span><span class="line">"""
</span><span class="line">
</span><span class="line">import matplotlib.pyplot as plt
</span><span class="line">import numpy as np
</span><span class="line">import glob
</span><span class="line">
</span><span class="line">image_files = glob.glob('png/*.png')
</span><span class="line">
</span><span class="line">w, h, channels = 512, 512, 3
</span><span class="line">rows, cols = 4, 5
</span><span class="line">
</span><span class="line"># let's make a matrix 4x5, ie. select a nicely divisible subset
</span><span class="line">image_files = image_files[:rows * cols]
</span><span class="line">images = [read_image(f) for f in image_files]
</span><span class="line">
</span><span class="line"># make a single big matrix of images
</span><span class="line"># (20, 512, 512, 3) -&gt;
</span><span class="line">images = np.vstack(images).reshape(rows, cols, w, h, channels)
</span><span class="line"># (4, 5, 512, 512, 3) -&gt; (4, 512, 5, 512, 3) -&gt; (4 * 512, 5 * 512, 3)
</span><span class="line">big_image = images.swapaxes(1, 2).reshape(rows * w, cols * h, channels)
</span><span class="line">
</span><span class="line">plt.imsave('thumbnails.png', big_image)</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="the-code---git-repository">The code - git repository</h2>

<p>That’s it!</p>

<p>The complete code, including the scripts and graphics is available in a git repository. The license code the code (except for the logo) it MIT open-source, so feel free to use it.</p>

<ul>
  <li>https://github.com/bzamecnik/s3dt-models/</li>
</ul>

<h2 id="about-the-company">About the company</h2>

<p><img src="http://www.svet-3d-tisku.cz/img/svet-3d-tisku-logo.png" alt="" /></p>

<p><a href="http://www.svet-3d-tisku.cz/">Svět 3D tisku</a> (3D Print World) is a Czech boutique e-shop and store providing broad range of fillaments, 3D printers and custom 3D print services for Central European customers (local companies, schools, hobbyists). The company is ran by by mum and dad and I’m trying to help them if time permits.</p>

<p>If you are in Prage around 10.-13. May 2016 feel free to visit our stand at <a href="http://3dexpo.cz/">3D Expo Prague 2016</a> (<a href="http://3dexpo.cz/exhibitors/svet-3d-tisku/">details</a>) and see the printed “reels” live :).</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this small weekend project we’ve learned the basics of OpenSCAD and were able to create some nice small but not completely trivial model. We’ve seem how to use a hierarchy of parameterized models, how to use text, import vector graphics logo from SVG and use it as an inscription. In order to avoid repetitive work we tried to automate all the steps from generating SCAD code, STL and PNG file up to making a summary table of thumbnails.</p>

<p>I hope this article has shown you that it is very easy to start with OpenSCAD (at least for programmers) and inspired you to make your own projects. If you have any questions, you can search the docs or drop some comment here. Thanks and enjoy!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HarmonEye: Hard-won Experience After Three Years of My Life]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2015/harmoneye-hard-won-experience/"/>
    <updated>2015-11-16T15:15:15+01:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2015/harmoneye-hard-won-experience</id>
    <content type="html"><![CDATA[<p><img src="http://bohumirzamecnik.cz/assets/posts/harmoneye-hard-won-experience/sunpilots.png" width="400" align="right" /></p>

<p>In this article I’d like to summarize lessons learned during three years of development of software for music analysis, visualization and machine learning and of my life. You can find a lot of experience and advice not to repeat the mistakes I did.</p>

<p>The goal: see what you hear in music. When you think you’re genius and can do all features at once, stop… It’s a trap! Go by small steps and get much further.</p>

<!--more-->

<p>Almost two years ago in December 2013 I quit my regular job at <a href="http://www.etnetera.cz/">Etnetera</a>. Working on e-commerce backend I was missing applied mathematics badly and wanted to build my own products. Martin Holečko, one of the founders of Etnetera gave me a nice book tip: <a href="http://fourhourworkweek.com/">4-Hour Work Week</a> by Tim Ferris. I decided <a href="http://bohumirzamecnik.cz/blog/2013/refactoring-the-path-to-freedom/">I want more freedom</a> and do what I was dreaming of and working on before.</p>

<p>The idea is simple. I love music and want to understand better how it works. But my eyes are much more efficient and trained in finding patterns than my hearing.</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/mStudajyJvo "></iframe></div>

<h2 id="a-bit-of-history">A bit of history</h2>

<p>Since being a child I was fascinated by some beautifully strange moments in songs. But classical music theory was a complete mess for me. My brother Vojta “Pango” has been a <a href="http://www.stuff.co.nz/the-press/news/mid-canterbury-selwyn/72751381/nature-inspires-pangos-tunes">piano</a>  <a href="http://www.stuff.co.nz/timaru-herald/news/72121876/Piano-man-fills-Stafford-St-with-music">genius</a> and I was more interested in computers. However, at the high school I started <a href="http://corale.cz/">singing in a choir</a> and to play guitar at jam sessions. And I’ve been wondering if it possible to automatically recognize chords from audio recording, how to measure similarity between songs and things like that. Also Honza Hovorka, one of my friends from the choir and a very talented clarinet player, inspired me with this master’s thesis on recognizing voice and music in audio.</p>

<p>This ideas of audio processing and pattern recognition lead me to study Computer Science at the Charles University. There were indeed some lectures on DSP and machine learning, however only theoretical, without any practice. In the master’s years I was more interested in computer graphics and computational photography, however.</p>

<p>Then after graduating I came to Etnetera to do something practical. I did backend for e-commerce and <a href="http://soyka.etnetera.cz/en/">personalization</a>. Still, there was some internal urge to deal with music processing and visualization. Web development was not that satisfying.</p>

<p>In the meantime years I became more and more interested in music theory - how it works. I realized that there are some deep connections between physics, algebra, number theory and calculus in music theory and that the underlying models are far simpler that what is taught in schools as “classical music theory”. Imagine 400-years old open-source code with backwards compatible API and no chance to be refactored. When I googled what I found out I realized there’s about 30 years of <a href="https://en.wikipedia.org/wiki/Set_theory_%28music%29">research</a> in this area, so it is not a complete nonsense.</p>

<h2 id="birth-of-harmoneye">Birth of HarmonEye</h2>

<p>I set the goal to build a tool that automatically recognizes what tones (or more precisely <a href="https://en.wikipedia.org/wiki/Pitch_class">pitch classes</a>) are being played in audio and visualize them. Ideally in real-time from microphone on a mobile phone. The visualization was quite simple, just a <a href="http://www.visualmusictheory.com/tone-circle.html">circle like a clock</a> with each of 12 segments representing intensity of each pitch class.</p>

<p><img src="http://i.visualmusictheory.com/tone-circle/pen_and_paper_examples.jpg" alt="" /></p>

<p>As I learned music theory by myself I have drawn a vast number of such circle diagrams with pen and paper. It was a beautiful tool to understand a lot of concepts. But my idea was to put this into a mobile phone app and leave the work to machines. The name HarmonEye popped in my mind as a portmanteau of “harmony” and “eye” denoting the connection between musical chords and visual perception.</p>

<p><img src="http://harmoneye.com/img/harmoneye-logo-512-512.png" alt="" /></p>

<p>I researched tons of papers on audio processing and made model of the computational pipeline in my head. In December 2012 I started coding. The work was quite irregular, just when I had some free time. In one year I had a working prototype running on Mac desktop.</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/harmoneye-hard-won-experience/harmoneye-github-timeline.png" /></p>

<p><img src="http://harmoneye.com/img/harmoneye-mac-c-maj7.png" alt="" /></p>

<p>On 6th June 2013 the HarmonEye for Mac was released as a paid app.</p>

<p>Also I shared the progress on Twitter <a href="https://twitter.com/HarmonEye">@harmoneye</a>.</p>

<h2 id="features">Features</h2>

<p>The basic features of HarmonEye is to show what pitch classes are being played at the moment. Imagine a piano keyboard with sound intensity on each key. Then you roll the piano into a circle where tones are aligned by octaves. That’s the <a href="http://www.visualmusictheory.com/tone-circle.html">mental model</a>.</p>

<p>I wanted to analyze audio from the microphone in real-time so that I can experiment with it interactively. For the prototype I just wanted it to run on my computer.</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/eIoJYKPXecM "></iframe></div>

<p>In the first step I wanted to show just the raw intensities so that one can see what’s there. In the second step I wanted to move the classification of the pitch classes from human brain to some machine learning algorithm.</p>

<p>Key detection for coloring.</p>

<h2 id="the-architecture">The architecture</h2>

<p>I will describe the architecture of HarmonEye and how it evolved over time in more detail in separate article. This is just a quick high-level overview.</p>

<p>So we have microphone input on one side and a animated plot on the other side. We can go backwards to find out what computation is required.</p>

<p>A smooth animation requires something about 25 frames per second. In each frame we need the data for backing the plot (either raw intensity features or ideally the recognized pitch classes). To obtain this we need to do some kind of spectral decomposition that detects amount of energy in each pitch bin. In other words we need to quantize the frequency domain of time-frequency plane into bins that correspond to musical semitones, ie. are uniform in the log-frequency domain. There are various methods, for the initial implementation I chose CQT (Constant-Q Transform), afterwards I found TF-reassignment is much more suitable. The input to this is a plain spectrogram, ie. STFT (Short-Time Fourier Transform). Each frame in STFT needs a frame of the original audio. Thus we get to the audio source, that is in this case a microphone.</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/9YkXvjwQNlE "></iframe></div>

<p>Things get a bit complicated in this part. Audio samples are read from the sound interface in batches in a blocking manner. However, we want to process blocks of samples that are of different size than audio buffer size, are overlapping and the processing is done at an rate independent on the input rate. This is described in Computer Science as the producer-consumer problem. One way to solve this problem is a read data in one thread, process it and another one and hold the data in a shared resource. Such a efficient resource that allows writing blocks of samples of one size and reading blocks of other size is ring buffer.</p>

<p>When we look at the results of such system, we quickly realize that showing the spectrogram with log-frequency quantization is not enough. There are multiple problems. First, typical instruments produce not a single sinusoid but multiple sinusoids, typically integer multiples (these are called harmonic tones). But we need to show only energy corresponding to the fundamental frequency. Second, typical music is not composed only of harmonic tones but also from a lot of percussive or noisy sounds. Third, with STFT windowing spectrum of each sinusoid is not a single peak but has side-lobes. So we need to filter all of this noise out. Fourth, for visualization we need to normalize the results so that the important information is not hidden in the remaining background noise.</p>

<p>The other rather technical challenges were in obtaining the audio via Java API, drawing OpenGL in a Swing UI, getting it work with Mac OS. Back then I wanted a paid Mac application, so I put inside some licensing (LimeLM, now gone), payment processing (FastSpring, deprecated) and code obfuscation (ProGuard). At least ProGuard turned out to be useful for code minimization on Android.</p>

<h2 id="half-a-year-sprint">Half-a-year sprint</h2>

<p>After reading the 4HWW book I realized I could make some money from such an app and I also wanted to work while traveling like a digital nomad. So on 1st December 2013 I started on my own. From my savings with a runway of a few months.</p>

<p>Since I started I was thinking that I need to make a product quickly so that I could launch it and start making money. The sprint started with a Week of Hustle in the community of product makers called <a href="http://jfdi.bz/">JFDI</a> (Just Fucking Do it) by <a href="http://justinjackson.ca/">Justin Jackson</a> - now called <a href="http://productpeople.club/">productpeople.club</a>. There are a <a href="http://bohumirzamecnik.cz/blog/categories/week-of-hustle/">few articles from that time</a> on my blog.</p>

<p>I focused much on building the application. Also I tried to find if other people are interested. I talked with many people live and some said they love the idea. I can remember when I was returning back from one Scala Dojo, we were talking about HarmonEye with one friend in the metro and some other guy listened to us and told me that he wants to buy it, just to tell him where. He was a musician.</p>

<p>This validated that there’s something interesting not only for me in the product.</p>

<p>I created a <a href="http://harmoneye.com/">website</a> a newsletter and posted some messages and screenshots to some online fora. Sometimes the reaction was “we like it”, most often “fuck off with your commercial shit”.</p>

<p>I read some self-development books to understand how online marketing can work. Most notably Amplification by Justin Jackson. The basic message was:</p>

<ul>
  <li>research for some pain, at best your own pain that you see also at others</li>
  <li>determine who is your audience</li>
  <li>start creating some useful content, eg. blog posts, videos, etc.</li>
  <li>start creating a community, eg. using a newsletter</li>
  <li>build your product and then launch it to your community</li>
</ul>

<p>Although I knew theoretically what to do I didn’t do it.</p>

<p>I thought my pain is in finding chords/tones in some unknown music. I thought other people also like to find chords and visualize the music. I though my audience are amateur musicians or people who start learning music.</p>

<p>I didn’t start writing articles for such people. I created a newsletter but didn’t write anything useful to it, only some info about the app being available. When I launched the Mac app a handful of people bought it. As for the Android app I launched only a free version without a price tag or ads.</p>

<p>Why?</p>

<p>I was too focused on making the app working before my runway ends so I didn’t start writing about music and using HarmonEye for music. I needed to have a working app to show examples. When the app was ready it was almost impossible to create a meaningful video since it was completely hardcoded with mic input and OpenGL output.</p>

<p>Along the way I wrote a lot of code and solved a lot of implementation problems but those were not useful for the musicians audience.</p>

<p>When I showed the app to the musicians some said it is not needed for them, some were interested.</p>

<p>I desperately wanted to create the full-featured app that I skipped even the initial phase, that is validating the problem and audience. It is an important step and its outcome determines what should be the next goal. I set the goal without knowing if it is really useful. I set the inital goal too high and too broad. There’s need to focus on something small and do it. And iterate.</p>

<h2 id="the-pains-with-java-etc">The pains with Java, etc.</h2>

<p>For the implementation I chose Java. Three years before it was quite natural, since I was using Java every day at work and it is of of the native languages for Android. However, from today’s perspective it was a really a bad decision. As bad a using C# at the university for team project, bachelor thesis and master thesis. Honestly, Java or C# are not suitable for this kind of projects at all. The reasons are multiple.</p>

<h3 id="it-is-hard-and-expensive-to-experiment">It is hard and expensive to experiment</h3>

<p>I’ve became a great fan of prototyping and found that crucial for this is to be able to quickly and cheaply experiment.</p>

<h3 id="lack-of-shell">Lack of shell</h3>

<p>For experimenting I find interactive shell an indispensable tool. You just open up the shell, type a few lines of code, see the results, type other code (while still having the previous results at hand) and iterate until you’re satisfied. Quick and dirty.</p>

<h3 id="initial-overhead-with-build-tools">Initial overhead with build tools</h3>

<p>In contrast, in Java world you need to create a project, set up a build tool, write some test class, some class with the code, run it and see the results. When you want to explore to results, you need to modify the code, compile and run again. This is just a huge overhead that quickly makes prototyping expensive, annoying and leads to writing lots of code blindly and then debugging the same amount of time. At least there are languages on JVM such as Scala or Groovy that provide shell.</p>

<h3 id="lack-of-usable-libraries---numeric-computation-plotting">Lack of usable libraries - numeric computation, plotting</h3>

<p>A big pain when working on HarmonEye and the university projects was that I had to reinvent wheel a lot of time just to have some basic tools. This takes a lot of time and effort, leads to suboptimal tools and projects since you have to invest your time not only in your own project but to all the tooling. I admit sometimes it is necessary to create the tooling - when there’s none available or doesn’t not fit your application at all. But otherwise it’s just a waste of time. You can do wonders if you can stand on shoulders of giants. And that’s exactly what existing libraries provide. Thanks to our predecessors who creted the tooling. Sometime you find yourself to create tooling along the way, that will be useful for other as well. That’s just a wonderful open-source ecosystem.</p>

<p>We, programmers, tend to be very arrogant when it comes other people’s code. Sometimes the critique is valid. Most often the problems of existing code results not from other people being totally stupid morons, just from lack of experience, lack of time, too much politics, etc. We think we’ll handle the problem better and often we fall into the same trap.</p>

<p>I needed to represent and handle multidimensional arrays efficiently. In Python you have numpy which has wonderful API, efficient memory representation and super-optimized C/Fortran backend. In Java I had plain arrays of integers. Now, you have <a href="https://github.com/deeplearning4j/nd4j">ND4J</a>, but this was not available at that time (initial commit at 31 Aug 2014). So since ND-arrays were not my main business I made some working code but it quickly became really painful to use.</p>

<p>The same goes for FFT, window functions, sparse matrices, complex numbers, zero-phase low-pass filtering, decimation and a ton of other numerical goodies. Scipy has all this stuff already available, tested and optimized. By hand you spend a lot of time to find bugs afterwards and you app waits for your attention and suffers.</p>

<p>Plotting is a chapter in itself. When you do signal processing you need visibility to the amounts of your data. A lot of various plots of different types. Sometimes at best interactive or animated. Doing this stuff by hand is possible of course but eats huge amounts of time and it really suboptimal and not nicely reusable. First I had to draw to the canvas in Swing UI, then in OpenGL. Both were really really painful and not suitable for experimenting at all. At least I found <a href="https://processing.org/">Processing</a> to be a nice tool for prototyping, even with a Java-like code. It helped me a lot.</p>

<p>In Python world you can use matplotlib or Bokeh. Output can go to a GUI, notebook, web page or to a file and could be interactive. There are tons of plots, options and examples. It is possible to create animations quite easily and produce videos that can be uploaded to YouTube. The integration between numpy or matplotlib is excellent.</p>

<h3 id="memory-management-with-gc">Memory management with GC</h3>

<p>When I first ran HarmonEye <a href="https://play.google.com/store/apps/details?id=com.harmoneye.android&amp;hl=cs">ported to Android</a> it ran for about 2 seconds. Then it crashed. Why? It turned out that some parts of the app including some third-party libraries allocate on-heap memory in each iteration. This quickly overloaded the GC and the application was terminated. The old HTC Android phone had a little memory and GC was not so fast.</p>

<p>I had to rewrite the code so that already allocated arrays are reused. This lead to abandoning functional paradigm and overwriting some shared memory. Bad.</p>

<p><em>First port of HarmonEye to Android, with rather geeky text mode plotting.</em></p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/HoPOUV4EAeo "></iframe></div>

<p><em>Pango playing on software keyboard that is visualized by some old versions of HarmonEye for Mac and Android 2.3. Note the slow response and lots of background noise.</em></p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/tW1H8GP_1tk "></iframe></div>

<h3 id="lack-of-functional-programming-tools">Lack of functional programming tools</h3>

<p>Java was created with procedural and object-oriented paradigm in mind. Functional paradigm in contrast to the previously mentioned is based on the idea that the elements of code are pure transformations, functions that do not have any side-effects. This allows for better testing, much higher-level code and is very suitable for today’s need for concurrent and parallel computation. Most importantly it relieves the programmer of considering the behavior of some code in all possible states because there’s no mutable state or it is very isolated.</p>

<p>As said this is a very powerful tool that allows to express code very concisely and minimizes the room for errors from mutable state. Java didn’t support functional paradigm up to version 8. And I used Java 6 or 7 at that time since Java 8 was released at Mar 18, 2014. Scala managed to join object-oriented and functional paradigm but I didn’t use it due to lack of experience and since it running it on Android was uncertain.</p>

<p>After experience with Python I wouldn’t give up functional programming for prototyping or production code until absolutely necessary. Well, when you have working code and measure a clear bottleneck that can be solved by some very optimized procedural code, then OK. Bot not before. Otherwise functional programming saves a lot of time and nerves which is usually the bottleneck during development.</p>

<h3 id="static-typing-and-explicit-naming">Static typing and explicit naming</h3>

<p>One thing I noticed when I was comparing my Java and Python code was that code in Java needed a lot more names for everything. Classes, methods, variable for everything. In Python using functional constructs, lambda functions and high-level APIs there was much less need for naming.</p>

<p>Also Java is strongly typed and Python duck-typed. This means that in Java you need to make custom classes and interfaces all the time. Things that behave the same way but have incompatible interfaces just can’t be used together without all the adapters and crap like that.</p>

<p>In duck-typed languages it doesn’t matter whether you provide a <code>plot()</code> function with a numpy array, list, tuple or you custom object as long as it behaves as expected. No need for some common explicit interface. No need for lots of names. Most of the time numpy arrays are the universal interface between various libraries.</p>

<p>A Computer Science cliche quotations says two hardest things in CS to do right is caching and naming things. When you don’t have to name a thing you don’t have a hard problem to solve. And this means more time for the actual business. I don’t say make anything anonymous, just don’t make everything explicit unless it’s really necessary.</p>

<h2 id="practical-machine-learning">Practical Machine learning</h2>

<p>After getting the pipeline to work I was happy. But soon I realized this is not what people would like to see. It is very hard to comprehend. The pitch class circle with intensities is just too low-level for humans to look at real-time.</p>

<p>What was needed was to automatically recognize whether a pitch class is active or not. And that is a machine learning problem.</p>

<p>One day an email came to my inbox from Coursera offering a the course of <a href="https://www.coursera.org/learn/machine-learning">Machine Learning</a> course taught by prof. Andrew Ng. I signed up since this was something that could provide the solution to the problems of HarmonEye. Besides that it was the first practical experience with ML. At the university there were theoretical lectures on pattern recognition or numerical optimization, bot nothing practical. Now we worked a lot of in MATLAB/Octave and it was also nice to experiment with the DSP stuff.</p>

<p>At this course I was really happy we went trought all the tough and boring lectures at the university such as Linear Algebra, Calculus, Statistics, etc. Things that must have been hard for a lot of students were quite natural after having those math tools in the belt. I realized machine learning can be applied universally beyond music processing.</p>

<p>Since the runway was almost off and the business was not going as I expected I concluded I need to find a job again. Doing machine learning with Python would be awesome. Soon I found an offer for such position.</p>

<h2 id="exhaustion">Exhaustion</h2>

<p>I developed HarmonEye about 6 months full-time. During that I worked way more than 8 hours per day (rather 12-16). I was just thinking about the project and could not relax. This is not sustainable. In order to minimize the cost of living I moved temporarily from Prague to my parents. Unfortunately the atmosphere was not quite healthy. Instead of being with people in the city I voluntarily imprisoned myself at home at my computer.</p>

<p>After some time I became not able to focus well and became quite depressed. I tried to reconsider if the project I’m doing is meaningful. During the last few months/weeks I tried to come up with a plans B and C.</p>

<p>I also create <a href="https://play.google.com/store/apps/details?id=com.harmoneye.tonecircle">Tone Circle</a>, an Android app that allow for playing with the pitch classes via touch gestures and shows the chord name.</p>

<p><img src="http://i.visualmusictheory.com/tone-circle/tone_circle_c_e_g.png" alt="" /></p>

<p>Besides that I tried to come up with some simpler product, a guitar tuner. I took the guts from Harmoneye, focused on a single harmonic signal and did a completely different UI. There are two prototypes - <a href="https://www.youtube.com/watch?v=iOsym2fTOVY">beads</a> similar to the Tone Circle and <a href="https://www.youtube.com/watch?v=8mBO7Ry8uQs">linear</a>. It was deployed to Google Play but never published, since it lacked proper classification of tones. Note it was done before taking the ML course.</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/iOsym2fTOVY "></iframe></div>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/8mBO7Ry8uQs "></iframe></div>

<p>At least to write some useful stuff on music theory. Without a clear focus about who is the reader (a ordinary musician, a person with maths background, a programmer) it was very hard to write something at the right level of detail. I have the stuff stored somewhere in git, but it is waiting for its time.</p>

<p>Finally I decided I have to quit this since it was pointless. I was so exhausted from all the things. I decided to pack my things and fuck off and clean my mind.</p>

<h2 id="road-trip">Road trip</h2>

<p>With a few bucks in my pocket and a car the obvious idea was to make a road trip. It was summer and the southern lands didn’t attract me. I’ve already been there. An unexplored territory was to the north, though. I’ve never been to Scandinavia before. After looking at the map a few days before leaving the rough plan was to drive around the Baltic sea to Scandinavia and back. I had a month before starting with the new job.</p>

<p>6738 km, 24 days, 10 countries, 1 car, single traveller, wonderful nature, kind people, a lot of experience and a pile of photos. It was a trip of lifetime or maybe just a beginning.</p>

<p>The route was from Czech republic through Poland, Lithuania, Latvia, Estonia, Finland, Sweden, Norway, Sweden, Denmark, Germany back to Czech republic.</p>

<p>It was the best thing I could do. Wonderful experience! I alone was responsible for whatever I do. There was so much to see everywhere and beautiful nature to admire. I also met nice people on the road. Every day was different and surprise. Every day full of stories. I blogged the whole journey (unfortunately it’s still available in only Czech language) and tool a lot of photos. Not all are published yet (shame on me).</p>

<p><a href="https://www.flickr.com/photos/elgriton/albums/72157645572363341">Scandinavia Road Trip 2014/06</a> on Flickr.</p>

<p>A month later I returned as someone else. Full of energy and determination to continue.</p>

<h2 id="wikidi">Wikidi</h2>

<p>In July 2014 I started at Wikidi a private startup with a few projects. I worked on some algorithmic trading stuff. It was nice that I could use Python and learn and apply some deep learning techniques. During that time I made myself familiar with Theano, word2vec, approximate nearest neighbors, etc. After a few months a colleague left the team and I took his role. This was also some trading but in Java. The code was complete ugly mess. We worked hard to make it usable. That time careful test-driven development brought its fruits. The resulting code was quite nice, flexible and maintainable. I’m really pround of it. The problem though was all the projects didn’t seem to lead anywhere. Without a clear goal you cannot get to that place. The same mistake - trying to take too big steps without validating if the product is really useful. Abundance of resources might not be cure for all problems. After a few months I got another offer.</p>

<h2 id="jumpshotavast">Jumpshot/AVAST</h2>

<p>In winter 2014 AVAST was looking for someone to scale machine learning models to big data. It seemed to me quite appealing, so that I could do ML again. In February 2015 I started, already in a spin-off called <a href="https://www.jumpshot.com/">Jumpshot</a>. It has been very nice to meet so much smart people. The data was a few orders larger that I ever seen before. I did a lot of various backend stuff and started to recognize familiar patterns. The same problem as ever before but on scale. In my opinion the test-driven development and business should be repeated almost like a mantra. Unfortunately until present I was not able to do ML, except for an awesome week-long deep learning workshop in a <a href="https://www.it4i.cz/">scientific cluster in Ostrava</a>. Besides learning a lot about big data I started using Jupyter notebooks regularly.</p>

<h2 id="some-stats-from-google-play">Some stats from Google Play</h2>

<h3 id="harmoneye">HarmonEye</h3>

<p>HarmonEye for Android <a href="http://bohumirzamecnik.cz/blog/2014/harmoneye-for-android-released/">released</a> at 14 January 2014, about two months after leaving Etnetera and starting the port.</p>

<p>Here are some number for HarmonEye for Android.</p>

<ul>
  <li>current installations: 513</li>
  <li>total installations: 1738</li>
  <li>percentage of active installation wrt. total: 29.5%</li>
</ul>

<p>Total active users:</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/harmoneye-hard-won-experience/google-play-harmoneye-users.png" /></p>

<p>Total active users by OS version:</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/harmoneye-hard-won-experience/google-play-harmoneye-users-by-os-version.png" /></p>

<p>OS versions:</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/harmoneye-hard-won-experience/google-play-harmoneye-os-versions.png" /></p>

<h4 id="reviews">Reviews</h4>

<p><img src="http://bohumirzamecnik.cz/assets/posts/harmoneye-hard-won-experience/google-play-harmoneye-reviews-summary.png" /></p>

<p>Saint Rezo 14. 2. 2015 v 1:42:
&gt; Are u serious? If you’re not then don’t do this to the rest of us, if yes then you should finish it.please more update!!! This is good start!</p>

<p>Ian MicMultiMillian 28. 2. 2014 v 5:27:
&gt; Amazing There’s nothing like this on the market anywhere and what’s better, it works perfectly! It’s beautifully simplistic design is so clear and nice to look at. Now I can learn the notes of whatever tune I want :)  And it’s also very pretty to look at, which, unfortunately, seems to be the most desired feature of apps today.</p>

<p>Adi Napiza 5. 1. 2015 v 3:15:
&gt; Like it Very helpful especially in a jam setting. Hoping dev will improve this by adding a chord finder feature and maybe mapping out octaves but so far its good and useful!</p>

<p>sgtransit 74 27. 12. 2014 v 17:06:</p>

<blockquote>
  <p>Something new. Hope developer can open source so it can be useful quickly.</p>
</blockquote>

<p>Ethan Taylor 20. 4. 2015 v 1:02:
&gt; Harmoneye is amazing Incredible tool for figuring out songs from recordings,  and live play, when the guitarists unexpectedly capo up.</p>

<p>Халиль Разиньков 10. 7. 2015 v 3:56:
&gt; Thanx, man Nice app in duet with Tone circle. But I’m used to a chord with #, not a b, which is little confusing. Can you make settings, like color themes or/and  chords forms in both apps?</p>

<p>This gives me hope that there are indeed people who find it useful and want it to be even better.</p>

<h3 id="tone-circle">Tone Circle</h3>

<ul>
  <li>current installations: 137</li>
  <li>total installations: 618</li>
  <li>percentage of active installation wrt. total: 22.1%</li>
</ul>

<h2 id="open-sourcing">Open-sourcing</h2>

<p>Since the original HarmonEye written in Java is not quite suitable for further development there was no point in keeping it in a drawer. So that at some point I open-sourced it (<a href="https://github.com/bzamecnik/harmoneye/tree/develop">harmoneye</a>, <a href="https://github.com/bzamecnik/harmoneye-android">harmoneye-android</a>). Also I realized it is better to publish a lot of other research <a href="https://github.com/bzamecnik/ideas">ideas</a> and question. One never knows when he’s gone and it would be <a href="http://bohumirzamecnik.cz/blog/2014/lets-share-the-ideas-with-the-world/">shame to keep the ideas to the grave</a>.</p>

<p>Also I thought about the audience. I realized that what I really enjoy is to teach. I have a lot of experience from those projects and feel a lot of pain when applying mathematical methods into practice. In my opinion there’s still a huge lag between researchers who speak in mathematical language with a lot of implicit context and between developers who speak in code. So another possibility is teach developers interested in music/audio processing and machine learning how to apply the mathematical methods. After all I’m one such person and I wished to have such a guidance earlier so that I can avoid all the costly mistakes.</p>

<h2 id="new-goals">New goals</h2>

<p>With this in mind I felt I need to build the tool I originally wanted to do. But in small steps and clear goal. Ie. series of tutorials for ML/MIR/DSP-interested programmers. If there’s HarmonEye 2.0 for mobile it should be a by-product not the end-goal.</p>

<p>The other goal is to prepare a course in a non-classical visual approach to music theory for musicians. The main ideas are written in the <a href="https://github.com/bzamecnik/ideas/blob/master/visual_music_theory_manifesto.md">Manifesto of Visual Music Theory</a>.</p>

<p>There are three blogs right now and I need to figure out what to do with them (merge or keep separate):</p>

<ul>
  <li><a href="http://bohumirzamecnik.cz/">bohumirzamecnik.cz</a> - audio processing, python, life, travels, etc.</li>
  <li><a href="http://www.visualmusictheory.com/">visualmusictheory.com</a> - about music theory, for musicians</li>
  <li><a href="http://www.neural.cz/">neural.cz</a> - about machine learning</li>
</ul>

<h2 id="a-lot-of-learning">A lot of learning</h2>

<p>I came across some awesome books and courses along the way. <a href="http://machinelearningmastery.com">Machine Learning Mastery</a> by Jason Brownlee is a very solid foundation for every ML practitioner. One of the main points is to take very small steps focused at learning one thing at time (a kind of TDD and Unix philosophy mix). Other useful concept is being lazy in learning the stuff - take a problem, explore it with some tools, then explore the methods, then write the algorithms, then dig deep into the maths. Not learn everything up front, but learn what’s needed at that point. This allows you to have meaningful results at each small steps and stay motivated.</p>

<p>Recently the book <a href="http://justinjackson.ca/marketingfordevelopers/">Marketing for Developers</a> by Justin Jackson finally came out. It is a foundation to set the goals and do all the stuff outside pure coding (finding the audience, launching the product, scaling, etc.). Other useful books may include <a href="http://nathanbarry.com/authority/">Authority</a> by Nathan Barry or <a href="http://theleanstartup.com/">Lean Startup</a> by Eric Ries.</p>

<p>A very nice experience was the <a href="http://www.dnxglobal.com/">DNX Digital Nomad Conference</a> in Berlin in summer 2015. About 500 like-minded gathered at one place sharing their thoughts and experience. There I finally realized for which audience I should create content.</p>

<p>By the way on a sunny Sunday you can find a vast number of street musicians in Berlin’s Mauerpark. Here’s how it looks when HarmonEye on a tablet shows the sound of australian rock band <a href="http://thesunpilots.com/">The Sunpilots</a>.</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/DhnZHA0vAfk "></iframe></div>

<p>Since autumn 2014 I’ve been attending <a href="http://www.mlmu.cz/">Machine Learning Meetups</a> in Prauge. Once I gave a lightning talk about ML on Time Series - comparision of financial and music data (in Czech language).</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/8_0mUWC2XyM "></iframe></div>

<p>I took or am presently attending various courses at Coursera and edX, namely <a href="https://www.edx.org/course/scalable-machine-learning-uc-berkeleyx-cs190-1x">Scalable Machine Learning</a> (in Spark), <a href="https://www.coursera.org/course/musictheory">Fundamentals of Music Theory</a>, <a href="https://www.coursera.org/course/audio">Audio Processing for Music Applications</a>, <a href="https://www.coursera.org/course/dsp">Digital Signal Processing</a> and the 5-course <a href="https://www.coursera.org/specializations/machine-learning">Machine Learning Specialization</a>.</p>

<p>In October 2015 we had a wonderful chance to attend a week-long workshop AVAST Deep Learning Sprint organized by Martin Vejmelka. In a group of about 20 people we had rented a few machines on Anselm, one of two <a href="https://www.it4i.cz/">supercomputers in Ostrava</a>, attended a lot of lectures about supercomputing, machine learning, deep learning, etc. Finally we worked on our real-world problems. We used <a href="http://torch.ch">Torch</a> and <a href="http://keras.io">Keras</a> and trained to models on Tesla GPUs. I was quite surprised how neural networks can predict complicated time-series so that we can detect anomalies. Awesome.</p>

<p>I realized good work needs a solid foundation in real life.</p>

<p>A wonderful experience was learning about <a href="http://comfortzonecrusher.com">Comfort Zone Challenges</a> and attending the course <a href="http://courses.comfortzonecrusher.com/courses/make-yourself-do-anything">Make Yourself Do Anything</a> by Till H. Gross. Fear has been something that held me back and I’m still fighting with it. But at least I have powerful weapons to overcome it.</p>

<p>Also I’m a geek and still fighting with relationships with girls. For years I was focusing too much on the work and had serious anxiety with approaching girls. Whenever I fell in love with any it became a catastrophe and it ended quickly. Thanks to Mark Manson and his book <a href="http://markmanson.net/books/models">Models: Attract Women Through Honesty</a> which provides really an enlightenment on how and why people behave and what can be done with this. It is applicable to general behavior beyond dating. I consider it one of the most important books I ever read.</p>

<h2 id="small-steps-with-python--deep-learning">Small steps with Python &amp; Deep Learning</h2>

<p>During the time at Wikidi and Jumpshot I was thinking what mistakes I did with HarmonEye and how to overcome them. I wanted to rewrite some parts of HarmonEye in Python, prepare suitable audio features and create ML models for chord recognition in the traditional way. Ie. give up real-time processing, which adds a lot of complexity, until the models are ready for it.</p>

<p>I’ve rewritten code to compute spectrograms including reassignemnt from scratch in Python. It is available in a git repo <a href="https://github.com/bzamecnik/music-processing-experiments">music-processing-experiments</a>. It works but still needs a lot of work to make it easy to use. Most importantly it allows to split the audio to blocks and compute chromagram features to feed into further ML models.</p>

<p>A wow moment was when I found the <a href="isophonics.net/content/reference-annotations-beatles">Beatles reference annotations</a> dataset. Some students did the hard work, took 180 Beatles songs and annotated each beat and chord and each key by hand. This labelled dataset allows to train ML models using the supervised training approach.</p>

<p>I found this dataset in summer 2014. The question was how should I visualize a song if the classification was working 100% accurately? Also one of the drawbacks of present HarmonEye is that is shows just a signle present moment without any context. However, eyes excel at looking at 2D landscapes. The result was this kind of visualization made in Processing (P5): http://vid.me/harmoneye.</p>

<iframe src="https://vid.me/e/Wat?stats=1&amp;tools=1" width="640" height="358" frameborder="0" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen="" scrolling="no"></iframe>

<iframe src="https://vid.me/e/is5?stats=1&amp;tools=1" width="640" height="242" frameborder="0" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen="" scrolling="no"></iframe>

<p>Since the chords are represented as textual labels described by a formal grammar and I needed to work with binary vectors I wrote a parser in ANTLR: <a href="https://github.com/bzamecnik/chord-labels">chord-labels</a>. This proved useful also for preparing data for ML.</p>

<p>In ML it is said that data preparation can take 90% of time and training models is like a cherry on the cake. I agree. After long hard work on preparing the data I was finally able to <a href="https://github.com/bzamecnik/ml-playground/blob/master/beatles/simple_chord_classification.ipynb">start training</a> some model for chord recognition. It employs convolutional neural nets of similar architecture to recognizing images and it’s written in Keras.</p>

<p>It needs some work but the results are quite promising. Right now I’m doing the three courses on Coursera and it takes long hours. And I hope to continue on the project and write more articles about the various things.</p>

<p>In the meanwhile I’m very happy I had the priviledge to meet some people that are on the same wave and are also deeply interested in music theory, audio processing and machine learning. We met in real life, on the course fora, etc. In order to discuss the things I created a channel on Gitter called <a href="https://gitter.im/bzamecnik/audio_ml">audio_ml</a>. So let’s meet there.</p>

<p>Ouch, this was a long article. Well, too much things happened in the last three years. Hope it was interesing and feel free to get in touch.</p>

<h2 id="conclusion--tldr">Conclusion / TL;DR</h2>

<ul>
  <li>do not blindly focus on your product, focus on the pain of your customers</li>
  <li>set a clear big vision and small goals</li>
  <li>make small steps, overcome the temptation to do everything at once</li>
  <li>leverage Python with interactive notebooks and vast libraries</li>
  <li>make automatic tests and do not forget to refactor</li>
  <li>make experiments repeatable by fixing input data</li>
  <li>first play with the data as a data scientist, then integrate a working pipeline</li>
  <li>keep good visibility in your data, don’t debug in production app to experiment</li>
  <li>write a blog about your successes and pains along the way</li>
  <li>write small tutorials</li>
  <li>don’t forget to relax to avoid burning out</li>
  <li>find some girlfriend/boyfriend</li>
  <li>traveling is awesome way to relax, make yourself more courageous and see things from a new perspective</li>
  <li>don’t let fear hold you back, you can do awesome things</li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Make a Hive UDF With Conflicting Guava]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2015/how-to-make-a-hive-udf-with-conflicting-guava/"/>
    <updated>2015-05-29T00:31:00+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2015/how-to-make-a-hive-udf-with-conflicting-guava</id>
    <content type="html"><![CDATA[<p>If you’re using Hive sooner or later you’ll need to create user defined functions (UDFs). Chances are such a function would use a code that depends on the Guava library. And it is not that unlikely that the required Guava version would be newer than Hive’s. Then you’re running into a trouble. Hopefully this article save you much of the pain I had to suffer to make it working. Let’s make a simple UDF and fix it using both maven and gradle.</p>

<!--more-->

<h2 id="example-udf---top-private-domain">Example UDF - top private domain</h2>

<p>As a concrete example take a UDF that given a internet host name computes the top private domain. Eg. for host name <code>www.google.co.uk</code>, <code>uk</code> and <code>co.uk</code> are public domains, <code>google.co.uk</code> and <code>www.google.co.uk</code> are private domains and <code>google.co.uk</code> is the highest (top) private domain in this case.</p>

<p>Guava’s <code>InternetDomainName.topPrivateDomain()</code> already does this job. We need lastest Guava in order to have an up-to-date trie representing public domains. However, there’s a difference between ancient Guava 11 and latest Guava 18:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">InternetDomainName</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">&quot;www.google.co.uk&quot;</span><span class="o">).</span><span class="na">topPrivateDomain</span><span class="o">().</span><span class="na">toString</span><span class="o">()</span>
</span><span class="line"><span class="c1">// returns &quot;google.co.uk&quot; in Guava 18</span>
</span><span class="line"><span class="c1">// returns &quot;InternetDomainName{name=google.co.uk}&quot; in Guava 11</span>
</span><span class="line"><span class="c1">//   &quot;google.co.uk&quot; is returned by name() instead of toString()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The whole UDF class looks like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">hive</span><span class="o">.</span><span class="na">udf</span><span class="o">;</span>
</span><span class="line">
</span><span class="line"><span class="kn">import</span> <span class="nn">com.google.common.net.InternetDomainName</span><span class="o">;</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">org.apache.hadoop.hive.ql.exec.UDF</span><span class="o">;</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">org.apache.hadoop.io.Text</span><span class="o">;</span>
</span><span class="line">
</span><span class="line"><span class="cm">/**</span>
</span><span class="line"><span class="cm"> * Extracts top private domain from a host name.</span>
</span><span class="line"><span class="cm"> */</span>
</span><span class="line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TopPrivateDomain</span> <span class="kd">extends</span> <span class="n">UDF</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="kd">public</span> <span class="n">Text</span> <span class="nf">evaluate</span><span class="o">(</span><span class="n">Text</span> <span class="n">host</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">host</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">try</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="k">new</span> <span class="nf">Text</span><span class="o">(</span><span class="n">InternetDomainName</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">host</span><span class="o">.</span><span class="na">toString</span><span class="o">())</span>
</span><span class="line">                <span class="o">.</span><span class="na">topPrivateDomain</span><span class="o">()</span>
</span><span class="line">                <span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</span><span class="line">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalArgumentException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In this case the incompatibility is just in the return value but in other cases there might be runtime errors such as added/removed/changed classes, methods, etc.</p>

<h2 id="conflicts-in-library-versions">Conflicts in library versions</h2>

<p>So what’s the problem with Guava and Hive? Hadoop and Hive are in general packaged with ancient or outdated version of Guava. Eg. Hive 0.14 available in CDH5 has Guava 11 and current Hive 1.2 has Guava 15, while the most recent Guava version is 18. The bigger the version difference the higher chance of incompatibilities. And the problem is that more than one version of the library cannot be easily loaded within JVM (at least in Hive).</p>

<p>However, there’s a trick. If there a conflict between classes in the same package(s) (in this case <code>com.google.common</code> and <code>com.google.thirdparty</code>), why not to rename the package(s)?</p>

<p>There’s one more catch with Hive UDFs. For some strange reason when registering the UDF Hive sees only classes from the JAR than contains the UDF class and not from other specified JARs. This along with renaming the packages leads to the need for a fat JAR, ie. a JAR containing all the necessary dependencies for the UDF class (or at least those shaded or not seen by Hive). Blindly packaging all transitive dependencies might result in a big bloated JAR, so we’d also like to minimize it just to classes that are actually used by our UDF.</p>

<p>The overall plan is thus to:</p>

<ul>
  <li>package all the dependencies of the UDF into a fat JAR
    <ul>
      <li>to make Hive see the other classes</li>
    </ul>
  </li>
  <li>rename (shade) the Guava packages
    <ul>
      <li>both the packages of the Guava classes and their imports in our code</li>
      <li>to prevent conflict with Hive’s own Guava</li>
    </ul>
  </li>
  <li>(optional) minimize the resuling fat JAR
    <ul>
      <li>remove unnecessary dependencies or even unused classes</li>
    </ul>
  </li>
</ul>

<p>We’ll explore how to do it using maven’s <code>maven-shade-plugin</code> and gradle’s <code>shadow</code> plugin.</p>

<h2 id="maven---maven-shade-plugin">Maven - maven-shade-plugin</h2>

<p>If your’re using maven for building fortunately there’s a plugin called <a href="https://maven.apache.org/plugins/maven-shade-plugin/">maven-shade-plugin</a> which can do both creating a fat JAR and renaming packages.</p>

<p>Within Maven’s <code>pom.xml</code> in the plugin’s configuration just specify using the <code>&lt;relocation&gt;</code> tags which package(s) should be renamed to what. The old package name is in the <code>&lt;pattern&gt;</code> and the new one in <code>&lt;shadedPattern&gt;</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="xml"><span class="line"><span class="nt">&lt;build&gt;</span>
</span><span class="line">  <span class="nt">&lt;plugins&gt;</span>
</span><span class="line">    <span class="nt">&lt;plugin&gt;</span>
</span><span class="line">      <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
</span><span class="line">      <span class="nt">&lt;artifactId&gt;</span>maven-shade-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class="line">      <span class="nt">&lt;version&gt;</span>2.3<span class="nt">&lt;/version&gt;</span>
</span><span class="line">      <span class="nt">&lt;executions&gt;</span>
</span><span class="line">        <span class="nt">&lt;execution&gt;</span>
</span><span class="line">          <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
</span><span class="line">          <span class="nt">&lt;goals&gt;</span>
</span><span class="line">            <span class="nt">&lt;goal&gt;</span>shade<span class="nt">&lt;/goal&gt;</span>
</span><span class="line">          <span class="nt">&lt;/goals&gt;</span>
</span><span class="line">          <span class="nt">&lt;configuration&gt;</span>
</span><span class="line">            <span class="nt">&lt;relocations&gt;</span>
</span><span class="line">              <span class="nt">&lt;relocation&gt;</span>
</span><span class="line">                <span class="nt">&lt;pattern&gt;</span>com.google.common<span class="nt">&lt;/pattern&gt;</span>
</span><span class="line">                <span class="nt">&lt;shadedPattern&gt;</span>com.example.shaded.com.google.common<span class="nt">&lt;/shadedPattern&gt;</span>
</span><span class="line">              <span class="nt">&lt;/relocation&gt;</span>
</span><span class="line">              <span class="nt">&lt;relocation&gt;</span>
</span><span class="line">                <span class="nt">&lt;pattern&gt;</span>com.google.thirdparty<span class="nt">&lt;/pattern&gt;</span>
</span><span class="line">                <span class="nt">&lt;shadedPattern&gt;</span>com.example.shaded.com.google.thirdparty<span class="nt">&lt;/shadedPattern&gt;</span>
</span><span class="line">              <span class="nt">&lt;/relocation&gt;</span>
</span><span class="line">            <span class="nt">&lt;/relocations&gt;</span>
</span><span class="line">          <span class="nt">&lt;/configuration&gt;</span>
</span><span class="line">        <span class="nt">&lt;/execution&gt;</span>
</span><span class="line">      <span class="nt">&lt;/executions&gt;</span>
</span><span class="line">    <span class="nt">&lt;/plugin&gt;</span>
</span><span class="line">  <span class="nt">&lt;/plugins&gt;</span>
</span><span class="line"><span class="nt">&lt;/build&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In order to minimize the JAR, enable it via the following. Beware that this might remove some classes used only by reflection. In such a case explicitly include the class via <code>configuration.filters.filter.include</code>. Please find the details in the <a href="https://maven.apache.org/plugins/maven-shade-plugin/examples/includes-excludes.html">docs</a>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="xml"><span class="line">...
</span><span class="line"><span class="nt">&lt;configuration&gt;</span>
</span><span class="line">  <span class="nt">&lt;minimizeJar&gt;</span>true<span class="nt">&lt;/minimizeJar&gt;</span>
</span><span class="line"><span class="nt">&lt;/configuration&gt;</span>
</span><span class="line">...
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>By default the plugin produces the shaded JAR with the same name as the original and add a prefix <code>original-</code> to the latter. If we want the opposite behavior (mark the shaded JAR, eg. with <code>-jar-with-dependencies</code> suffix), we can to this via:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="xml"><span class="line">...
</span><span class="line"><span class="nt">&lt;configuration&gt;</span>
</span><span class="line">  <span class="nt">&lt;shadedArtifactAttached&gt;</span>true<span class="nt">&lt;/shadedArtifactAttached&gt;</span>
</span><span class="line">  <span class="nt">&lt;shadedClassifierName&gt;</span>jar-with-dependencies<span class="nt">&lt;/shadedClassifierName&gt;</span>
</span><span class="line"><span class="nt">&lt;/configuration&gt;</span>
</span><span class="line">...
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Then just build the JAR with <code>$ maven package</code> and copy it to the machine(s) running Hive.</p>

<h2 id="gradle---shadow">Gradle - shadow</h2>

<p>Gradle <a href="https://github.com/johnrengelman/shadow">Shadow</a> plugin is inspired by <code>maven-shade-plugin</code>. The basic configuration might look like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="groovy"><span class="line"><span class="n">plugins</span> <span class="o">{</span>
</span><span class="line">  <span class="n">id</span> <span class="s1">&#39;java&#39;</span> <span class="c1">// or &#39;groovy&#39; Must be explicitly applied</span>
</span><span class="line">  <span class="n">id</span> <span class="s1">&#39;com.github.johnrengelman.shadow&#39;</span> <span class="n">version</span> <span class="s1">&#39;1.2.1&#39;</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;java&#39;</span> <span class="c1">// or &#39;groovy&#39;. Must be explicitly applied</span>
</span><span class="line"><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;com.github.johnrengelman.shadow&#39;</span>
</span><span class="line">
</span><span class="line"><span class="n">shadowJar</span> <span class="o">{</span>
</span><span class="line">  <span class="n">relocate</span><span class="o">(</span><span class="s1">&#39;org.google.common&#39;</span><span class="o">,</span> <span class="s1">&#39;com.exaple.shaded.org.google.common&#39;</span><span class="o">)</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>gradle shadowJar
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="registering-the-udf">Registering the UDF</h2>

<p>Within Hive register the UDF like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sql"><span class="line"><span class="k">ADD</span> <span class="n">JAR</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="k">to</span><span class="o">/</span><span class="n">the</span><span class="o">/</span><span class="n">example</span><span class="o">-</span><span class="n">hive</span><span class="o">-</span><span class="n">udf</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span><span class="n">jar</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">dependencies</span><span class="p">.</span><span class="n">jar</span><span class="p">;</span>
</span><span class="line"><span class="k">CREATE</span> <span class="k">TEMPORARY</span> <span class="k">FUNCTION</span> <span class="n">topPrivateDomain</span> <span class="k">AS</span> <span class="s1">&#39;com.example.hive.udf.TopPrivateDomain&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The first command tells Hive to copy the JAR into the distributed cache and put it on the claspath, so that it is visible from all MapReduce tasks. The second one registers the UDF class with the given function name.</p>

<h2 id="tips">Tips</h2>

<p>In case you just need to modify the classpath and give your JAR more priority (without renaming packages) try to fiddle with these options:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">export </span><span class="nv">HADOOP_USER_CLASSPATH_FIRST</span><span class="o">=</span><span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sql"><span class="line"><span class="k">SET</span> <span class="n">mapreduce</span><span class="p">.</span><span class="n">job</span><span class="p">.</span><span class="k">user</span><span class="p">.</span><span class="n">classpath</span><span class="p">.</span><span class="k">first</span><span class="o">=</span><span class="k">true</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">hive --hiveconf hive.aux.jars.path<span class="o">=</span><span class="s1">&#39;some-jar-1.0.jar&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>More info on Hive UDFs:</p>

<ul>
  <li>https://cwiki.apache.org/confluence/display/Hive/HivePlugins</li>
  <li>http://blog.matthewrathbone.com/2013/08/10/guide-to-writing-hive-udfs.html</li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Image Whitening - Clean B&W Documents From Nasty Photos]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2015/image-whitening/"/>
    <updated>2015-02-15T19:29:32+01:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2015/image-whitening</id>
    <content type="html"><![CDATA[<p><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_orig_and_whitened_row_t.jpg" /></p>

<p>Turn a poor smartphone-camera photo of a document or whiteboard into a nice black &amp; white or color “scan” that can be printed or converted to PDF. It works for text / line drawings / sheet music. The method is described here along with a Photoshop tutorial (and a Photoshop action for download) and a handful of examples.</p>

<!--more-->

<h2 id="the-problem">The problem</h2>

<p>As you can see in the image above, we have taken a photo of a whiteboard at some irregular ambient day light. In order to print it or embed it into web page we want pure white background and nice black text or lines. The image should not be binarized (ie. only black and white pixel), the anti-aliasing of the lines should be preserved.</p>

<h3 id="thresholding---bad">Thresholding - bad</h3>

<p>The trivial method is <a href="http://en.wikipedia.org/wiki/Thresholding_%28image_processing%29">thresholding</a> - all pixels darker than some value will be black, and the rest white. It works kind of ok for scans with regular lighting but fails miserably for our photos. The problem is the threshold is global for the whole image and cannot cope with gradients in background. Also scanners are usually not available at hand and certainly cannot scan whiteboards. The other problem with thresholding is that we lose color information and anti-aliasing.</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_threshold_150.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_threshold_150_t.jpg" alt="" /></a></p>

<p>Well, yes, there are some adaptive thresholding methods out there which try to find optimal threshold value for small image block. Yet, they still produce binarized image and lose colors. We need something better.</p>

<h2 id="the-solution">The solution</h2>

<p>I’ve came across this problem many time through the years, tried to solve it many ways, including spectral filtering, without much success. Yesterday I needed to prepare some illustration images for my one of my <a href="http://www.visualmusictheory.com/tone-circle.html">blog articles</a> and make an animated GIF. I only had my new whiteboard and iphone.</p>

<p>Suddenly, the light bulb in my head lit up:</p>

<blockquote>
  <p>Use the median filter!</p>
</blockquote>

<p>What does the <a href="http://en.wikipedia.org/wiki/Median_filter">median filter</a> do. Simply said, for each pixel it finds the most common value from its neighborhood, a <a href="http://en.wikipedia.org/wiki/Median">median</a>. From the image processing lecture I can remember it is good for removing salt and pepper noise, ie. lone black or white pixels. And what are the lines and text? A kind of salt and pepper!</p>

<p>The median filter with wide enough radius of neighborhood just keeps the background and removes the text. Then we can just remove this background, eg. divide the original image by the median-filtered one. A similar (yet not really the same) procedure is called <em>whitening</em> in the image-processing field.</p>

<pre><code>I_whitened = I / median2d(I, radius)
</code></pre>

<h3 id="how-to-do-it-in-photoshop">How to do it in Photoshop</h3>

<p>The easiest tool to experiment with this idea is probably Photoshop (although it might not be the best for batch processing and certainly it is not free).</p>

<p>So here the procedure:</p>

<ul>
  <li>open the image</li>
  <li>duplicate the layer twice
    <ul>
      <li>name the top layer “median” (not necessary, just for clarity)</li>
      <li>name the second layer from top “background”</li>
    </ul>
  </li>
  <li>apply the median filter to the “median” layer: Filter -&gt; Noise -&gt; Median
    <ul>
      <li>fiddle with the radius so that the background is quite smooth</li>
      <li>start eg. with 100px for a 6Mpx photo</li>
    </ul>
  </li>
  <li>set the “median” layer blending mode to “divide”</li>
  <li>merge down the “median” and “background” layers</li>
  <li>voilà!</li>
</ul>

<h4 id="tips">Tips</h4>

<p>Try to fiddle with the radius. Use the least radius that doesn’t leave too much dark blobs.</p>

<p>In case there are larger areas filled with black or color the whitening doesn’t work well. See the “Document with color diagrams” example below. But there’s a work around. We need to remove the big spots from the median layer. The <em>Content-aware fill</em> feature is our savior:</p>

<ul>
  <li>just select the remaining blobs</li>
  <li>Edit -&gt; Fill (SHIFT+F5) -&gt; Content Aware</li>
  <li>and select the “divide” blending mode again</li>
</ul>

<p>Denoise before whitening. A great denoising tool is in Lightroom. Something is probably in Photoshop as well.</p>

<p>Adjust Levels after whitening - do white and black clipping. This leaves the background perfectly white and makes the lines/text more contrasty.</p>

<p><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/photoshop/levels.png" width="268" /></p>

<h4 id="photoshop-action">Photoshop Action</h4>

<p>It is too much hand work. As a bonus I have made a Photoshop action and exported it so that you can just plug it in your installation!</p>

<ul>
  <li><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/photoshop_actions/median_whitening.atn">median_whitening.atn</a></li>
</ul>

<h2 id="examples">Examples</h2>

<h3 id="document-with-color-diagrams">Document with color diagrams</h3>

<p>Original (bad gradients from a table lamp):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_orig.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_orig_t.jpg" width="400" /></a></p>

<p>Thresholded at 100 (bad):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_threshold_100.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_threshold_100_t.jpg" width="400" /></a></p>

<p>Median with 100 px radius (notice the color blobs):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_median_100px.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_median_100px_t.jpg" width="400" /></a></p>

<p>Whitened (artifacts from color blobs):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_whitented.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_whitented_t.jpg" width="400" /></a></p>

<p>Median with 100 px radius + content-aware fill:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_median_100px_content_aware_fill.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_median_100px_content_aware_fill_t.jpg" width="400" /></a></p>

<p>Whitened (artifacts are gone):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_whitented_content_aware_fill.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_whitented_content_aware_fill_t.jpg" width="400" /></a></p>

<h3 id="sheet-music">Sheet music</h3>

<p>Original (shadow from my hand):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_original_photo.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_original_photo_t.jpg" width="400" /></a></p>

<p>Thresholded at 128 (bad):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_threshold_128.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_threshold_128_t.jpg" width="400" /></a></p>

<p>Median with 100 px radius:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_median_50px.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_median_50px_t.jpg" width="400" /></a></p>

<p>Original divided by the median:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_whitened_divide.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_whitened_divide_t.jpg" width="400" /></a></p>

<h3 id="simple-whiteboard">Simple whiteboard</h3>

<p>Original, denoised (in Lightroom):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_denoised.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_denoised_t.jpg" width="400" /></a></p>

<p>Thresholded at 80 (the light blue is gone - bad):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262-threshold_80.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262-threshold_80_t.jpg" width="400" /></a></p>

<p>Median with 100 px radius:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_median_100px.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_median_100px_t.jpg" width="400" /></a></p>

<p>Whitened:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_whitened.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_whitened_t.jpg" width="400" /></a></p>

<p>Whitened + levels:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_whitened_levels.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_whitened_levels_t.jpg" width="400" /></a></p>

<h3 id="whiteboard">Whiteboard</h3>

<p>Original (day light + some reflections):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_orig.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_orig_t.jpg" width="400" /></a></p>

<p>Denoised in Lightroom (click for detail view):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_t.jpg" width="400" /></a></p>

<p>Denoised + thresholded at 150 (bad):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_threshold_150.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_threshold_150_t.jpg" width="400" /></a></p>

<p>Median with 100 px radius:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_median_100px.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_median_100px_t.jpg" width="400" /></a></p>

<p>Whitened:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_whitened_color.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_whitened_color_t.jpg" width="400" /></a></p>

<p>Whitened + desaturated + levels:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_whitened_bw_levels.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_whitened_bw_levels_t.jpg" width="400" /></a></p>

<h2 id="conclusion--tldr">Conclusion / TL;DR</h2>

<p>In this article I’ve presented a very simple, yet effective method for converting photographed or scanned documents or whiteboards to a nice printable form with pure white backround and crispy dark text / lines.</p>

<p>The principle is using median filter with a wide radius to remove the text and then divide the original image by the filtered one.</p>

<p>We have seen a procedure in Photoshop and the action available for download.</p>

<p>This method is most suitable for smaller text and lines. It has problems with larger dark or colored blobs. In such case we can manually apply content-aware fill to the remaing blobs in median layer to overcome the problem.</p>

<p>It is good to use denoising before and adjust level after the filter.</p>

<h3 id="further-directions">Further directions</h3>

<p>Since Photoshop is not free and most importantly is it not that great for true batch processing I’d like to implement this method in Python. Hope the code will be available soon.</p>

<p>I also hope you found this article useful. If so feel free to share it and let me know. Also you can follow me at twitter: <a href="https://twitter.com/bzamecnik">@bzamecnik</a>.</p>

<p>Enjoy!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Run SMS-tools on Python 3 on Mac]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2015/how-to-run-sms-tools-on-python-3-on-mac/"/>
    <updated>2015-01-04T18:20:09+01:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2015/how-to-run-sms-tools-on-python-3-on-mac</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://i.bohumirzamecnik.cz/2015-01-04-how-to-run-sms-tools-on-python-3-on-mac/sms_tools_cover_t.png" /></p>

<p><a href="https://github.com/MTG/sms-tools">SMS-tools</a> (Spectral modeling synthesis) is a Python education library for audio signal analysis and modeling. It serves for practical excercises within the <a href="https://www.coursera.org/course/audio">Audio Signal Processing for Music Applications</a> course at Coursera. It was written to run Ubuntu Linux and Python 2.7. Here we see how to run it on latest Python 3.4 on Mac OS X Yosemite.</p>

<!--more-->

<h2 id="overview">Overview</h2>

<p>What are SMS-tools good for? In short they provide models for music analysis - how to turn a music recording into a spectrogram and then a each frame into a sum of sinusoids, sum of harmonic sinusoids, sum of harmonic sinusoids and random noise, etc. Also it contains some very cool transformations including sound morphing. Besides the library of models and transformations there is some GUI that allows you to quickly experimentat with various parameters and data. Just open a wav file, set the params, look at the graphs and play the reconstructed audio. Also there’s a lot of short example scripts.</p>

<p>If you look at the <a href="https://www.coursera.org/course/audio">Audio Signal Processing for Music Applications</a> course at Coursera you can see the theory, practical details and more. I liked to attend the first session of this course which was held in Autumn/Winter 2014. Since I found some free time after the course ended I’m going to take it now and wait for the next session this year to get the certificate. Anyway the software is quite interesting for my own experiments.</p>

<p>In the README you can find the recommended environment is Python 2.7 and Ubuntu Linux. I don’t use none of it and don’t want to install a lot of GB just to run some little piece of Python code.</p>

<p>There must be a way to run it on Python 3.4 and Mac. Fortunately there is! It consists of two steps: install all the dependencies, port the code to Python 3. The good news is that the step 2 is already done for you. So in this article I’ll just summarize both.</p>

<h2 id="install-dependencies">Install dependencies</h2>

<p>As for the package manager I use macports. For homebrew it should be quite similar (or try to <a href="https://class.coursera.org/audio-001/forum/thread?thread_id=126#post-535">consult the fora</a>).</p>

<p>First we’ll assume that you already have Python 3 installed (otherwise you wouldn’t find this tutorial). If not <code>sudo port install python34</code> (or the latest).</p>

<p>It is recommended to keep Python packages for different purposes in virtual environments (or at least in one) and not to install into the system location to prevent conflicts. Python 3.4 contains out-of-the-box a nice tool called <a href="https://docs.python.org/3/library/venv.html">pyvenv</a> which can solve exactly this problem. So we’ll assume you have one virtual env and it is activated. Otherwise:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">pyvenv my-audio-env
</span><span class="line">source my-audio-env/bin/activate</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>SMS-tools requires several Python packages and other dependencies. Some of them are available via pip, some of them via macports. Tkinter, SDL, XQuartz (eg. XQuartz-2.7.7.dmg) and Pygame.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">sudo port install libsdl-framework libsdl_ttf-framework libsdl_image-framework libsdl_mixer-framework mercurial
</span><span class="line">pip install cython numpy scipy matplotlib ipython readline
</span><span class="line">pip install hg+http://bitbucket.org/pygame/pygame</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Note that installing PyGame via a pip package doesn’t work now and as alternative we install from a Mercurial repo.</p>

<p>XQuartz is an implementation of X11 UI server. It can be installed from a DMG from <a href="http://xquartz.macosforge.org/">xquartz.macosforge.org</a>. You should log out and log in again for some settings to take effect.</p>

<p>SMS-tools also use Tkinter GUI toolkit with is a bit tricky to install. I’ve describe its installation in a separate article <a href="http://bohumirzamecnik.cz/blog/2014/install-tkinter-with-python-3-on-mac/">How to Install Tkinter With Python 3 on Mac</a>. In summary you need to install py34-tkinter and make a symlink since the module in on the wrong path.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">sudo port install py34-tkinter</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="install-sms-tools">Install SMS-tools</h2>

<p>Clone the fork SMS-tools and checkout the branch with Python 3 port:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">git clone https://github.com/bzamecnik/sms-tools.git
</span><span class="line">git checkout -b python3</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="run">Run</h2>

<p>Make sure you have activated you pyvenv.</p>

<p>There are two GUIs, one for models, the other for transformations. You can run the GUIs like this. Yes, it really expects you to be inside that directory…</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">sms-tools $ cd software/models_interface
</span><span class="line">models_interface $ python models_GUI.py
</span><span class="line">models_interface $ cd ../transformations_interface
</span><span class="line">transformations_interface $ python transformations_GUI.py</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="http://i.bohumirzamecnik.cz/2015-01-04-how-to-run-sms-tools-on-python-3-on-mac/sms_tools_gui_hps.png" /></p>

<h2 id="how-was-porting-to-python-3">How was porting to Python 3?</h2>

<p>First I converted the source code with <code>2to3</code>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">sms-tools $ 2to3 -w .</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Then it was necessary to fix some more subtle problems.</p>

<p>The / operator now represents floating-point division, not integer one.
So to avoid indexing with floats it was sometimes necessary to convert the result to integer via <code>int()</code>.</p>

<p>Tkinter stuff needs to be imported in a little bit different way. This should work both in Python 2 and 3.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class=""><span class="line">try:
</span><span class="line">	from tkinter import *
</span><span class="line">	from tkinter import messagebox, filedialog
</span><span class="line">except ImportError:
</span><span class="line">	from Tkinter import *
</span><span class="line">	import tkFileDialog as filedialog, tkMessageBox as messagebox</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>instead of</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">from Tkinter import *
</span><span class="line">import tkFileDialog, tkMessageBox</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>And that’s about it. The result should be compatible with Python 3.4. Since I don’t have Python 2.7 I can’t test if it still work. Probably not. But anyway, Python 2 is history.</p>

<p>Thanks for reading and have fun with audio processing with SMS-tools.</p>

<p>Here are some nice screenshots:</p>

<p>DFT spectrum of a single frame:
<img src="http://i.bohumirzamecnik.cz/2015-01-04-how-to-run-sms-tools-on-python-3-on-mac/01_dft_piano.png" /></p>

<p>STFT spectrogram:
<img src="http://i.bohumirzamecnik.cz/2015-01-04-how-to-run-sms-tools-on-python-3-on-mac/02_stft_piano.png" /></p>

<p>Analysis with the sine model:
<img src="http://i.bohumirzamecnik.cz/2015-01-04-how-to-run-sms-tools-on-python-3-on-mac/03_sine_model_analysis_bendir.png" /></p>

<p>Harmonic sines model:
<img src="http://i.bohumirzamecnik.cz/2015-01-04-how-to-run-sms-tools-on-python-3-on-mac/04_harmonic_model_analysis_vignesh.png" /></p>

<p>Stochastic model:
<img src="http://i.bohumirzamecnik.cz/2015-01-04-how-to-run-sms-tools-on-python-3-on-mac/05_stochastic_model_ocean.png" /></p>

<p>Sine plus residuals model:
<img src="http://i.bohumirzamecnik.cz/2015-01-04-how-to-run-sms-tools-on-python-3-on-mac/06_spr_model_bendir.png" /></p>

<p>Stocharstic plus residuals model:
<img src="http://i.bohumirzamecnik.cz/2015-01-04-how-to-run-sms-tools-on-python-3-on-mac/07_sps_model_bendir.png" /></p>

<p>Harmonic sines plus residuals model:
<img src="http://i.bohumirzamecnik.cz/2015-01-04-how-to-run-sms-tools-on-python-3-on-mac/08_hpr_model_sax_phrase_short.png" /></p>

<p>Harmonic sines plus stochastic model:
<img src="http://i.bohumirzamecnik.cz/2015-01-04-how-to-run-sms-tools-on-python-3-on-mac/08_hps_model_sax_phrase_short.png" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My First Handmade Bushcraft Knife]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2014/my-first-handmade-bushcraft-knife/"/>
    <updated>2014-12-31T22:09:31+01:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2014/my-first-handmade-bushcraft-knife</id>
    <content type="html"><![CDATA[<p><img src="https://farm8.staticflickr.com/7544/15529158714_385293995d_b.jpg" width="512" height="342" alt="CRW_7670.jpg" /></p>

<p>Everyone can make their own knife. Even a programmer with no previous experience in crafting wood and metal. It is the very basic tool useful in many situations. And if you dedicate it your love and passion it will serve you along time and make you happy evertime you use it. Here’s how I hand-made my first bushcraft knife for almost $0 from an old saw blade, juniper wood and a welding electrode.</p>

<!--more-->

<h2 id="why">Why?</h2>

<p><strong><a href="https://www.flickr.com/photos/elgriton/sets/72157649617351668/">A complete photo gallery on Flickr</a>.</strong></p>

<p>As I was on the <a href="http://bohumirzamecnik.cz/blog/categories/scandinavia-2014/">Scandinavia Road Trip</a> it took with me my little Swiss army knife which is very portable, nice for small woodwork. I carry it almost everytime and it’s very useful. Also I took a somewhat bigger <a href="https://www.ragweedforge.com/11867.jpg">Mora knife</a>. I use it mainly for preparing food (cutting onion and geasing my bread) and just in case I needed to cut bigger branches or split some wood. I found it at my parents, better than nothing for that travel, but I found the plastic parts not very comfortable and pleasing for eye.</p>

<p>I was thinking about things I should learn and try to do after I return. I definitively didn’t want to sit around at the computer all day long, but do something more ballsy. I decided to make bushcraft trips more often and to learn more about survival in nature.</p>

<p>What I wanted for bushcraft was a little bigger rugged knife. I started looking at the internet for all about knives. What are different type, how to use them effectively, what is for sale and even how to make them. I quickly found that I don’t like how most of the knives on the market look - just too unpersonal. Of course there were beatiful knife one can admire, usually hand-made and with respective price tag. Hand work is just expensive.</p>

<p>Meanwhile I saw many photos and videos of people making their own knives completely to their own aesthetic taste. Many of them were amateurs or they were made using just basic tools. Some of them were just beatiful and very inspiring, eg. <a href="http://trollsky.com">Trollsky Custom Knives</a> (<a href="https://www.youtube.com/user/Trollskyy">YouTube</a>, <a href="https://www.facebook.com/pages/Trollsky-custom-knives/203079099749271">FB</a>) from Poland. When I learnt some of the theory behind and of the principles of the techniques it stopped looking just impossible to make my own knife as I imagined it. Although I’m a geek with just a little practical experience in making hardware I took it as a challenge.</p>

<h2 id="what">What?</h2>

<p>As a first knife I wanted a bigger full-tang bushcraft knife. Fortunately my daddy is a mechanical engineer and has a lot of tools, materials and useful advices. For the blade we found an old saw blade from an old cutter made of high quality carbol steel. The handle is made of juniper wood. The tree allegedly grew for about fifty years near a cemetery and then the wood has dried for years under a roof of an outside fireplace. The brass pins were cut from an old welding electrode.</p>

<h2 id="how">How?</h2>

<p>For several evenings I drew on paper various shapes of the blade and the handle until I was visually satisfied. The resulting knife is still a bit different, however. </p>

<p>Then came the day D. I drew the shape on the plate with an black alcohol marker and realized that the blade is too small it at the same level at the hand, so that if it slips forward it can cut the finger. Thus I decided to make the blade slightly bigger. It also looked better.</p>

<p>Then we cut it around with a portable wheel grinder. Then with the grinder and then a belt sander I took off material from the blade to made a very rough edge. I originally wanted to make scandi grind but it turned of to be quite different - big edge across the whole blade with a small sharp convex edge.</p>

<p>Since the stell is hard in its present state I didn’t want to soften the steel and quench it again since I couldn’t do it so well. Thus I had to remove the material even if it was hard. And it’s true that removing it was hard too.</p>

<p>I wanted the handle to be secured in two ways - with epoxy glue and with brass pins. For them I needed to make holes in the steel. Since the steel was hard I couldn’t use an ordinary drill. Fortunately in a shop in the town they had exactly the special drill I needed. With it it was very easy to drill through even using a battery-powered tightener. In a minute there were two nice holes.</p>

<p>Next I needed to prepare the wood for the handles. Just a few whiles with the saw and a log was split in halves. Then I shaved it to made a flat surface. With a pencil I drew the outline of the handle and with my Swiss knife I cut the excess wood.</p>

<p>Then I cut the pins from an old electrode. The diameter was almost the same as the holes. Well the holes were just a very little bit tight so I needed to sand the pins to fit.</p>

<p>Now everything was prepared to get the parts together. I bought some epoxy glue and started gluing them together. First, with some thinner I got rid of grease from all the surfaces. Then I just mixed the two parts of the glue, brushed it over the metal, wood and pins, put them together, wrapped in some hard paper and clamped into a vice overnight. After a day or two it was nicely dried.</p>

<p>The next task was to shape the handle. With a belt sander I took of the outline to match the wood with the metal. Then I took off the sanding paper beld and sanded the edges by hand. Unfortunately I had no fine sand paper, so the surface remained a bit rough.</p>

<p>Shaping the handle was a very creative process. I kept looking at the wood, evaluating if I like it and grinding it more. It took a bit of a 3D shape so that the handle fits into my hand well. Holding my own knife for the first time was a very satisfying moment.</p>

<p>The wood needs to be impregnated to prevent absorbing moisture and rotting. One common option is oil, the other is wax. I decided to use bees wax from an old candle that I gave to my grandpa years ago. It smells really wonderfully and should not smell like beting rotten like some oils. Moreover it should not make a hand greasy and melt on sunlight.</p>

<p>I heated some wax inside an aromatherapy fountain and coated the handle with a brush. Then I let the wax soak inside the wood well by heating it with a hair-dryer. Afterwards I polished the surface with a rag and get off the excessive wax.</p>

<p>Now the knife was almost completely done. It looks beautiful to me! It’s my own baby :) Still it needed a sharp edge. So I bought a set of water-resistant sandpapers to make a nice sharp edge. A trick: look at the edge towards light. If you see a reflection it is not sharp. There are still some reflections so I need to sand somewhat more. A patina made using some acid would be nice and useful to protect the blade.</p>

<p>This autumn the woods were full of delicious mushrooms and my knife was there to clean them. It is also useful in the kitchen, eg. to prepare a bottle of marinated wursts.</p>

<p>It took me about a month or two of weekends to make my own knife as I imagined it. The total cost was negligible - some glue, drill and sandpapers. I have a nice tool that I can be whenever I go to the wood.</p>

<p>But the most important thing is I learned something very useful and realized that you just need desire and invest some time to make the seemingly impossible.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Install Tkinter With Python 3 on Mac]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2014/install-tkinter-with-python-3-on-mac/"/>
    <updated>2014-12-30T00:00:00+01:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2014/install-tkinter-with-python-3-on-mac</id>
    <content type="html"><![CDATA[<p><img src="http://bohumirzamecnik.cz/assets/posts/install-tkinter-with-python-3-on-mac/tkinter-missing.png" width="296" align="right" />
Tkinter is an old GUI toolkit, that has been popular also in some Python projects. Sometimes it might be tricky to install. If you just can’t get past <code>ImportError: No module named '_tkinter'</code>, read on. We’ll install it with Python 3.4 on Mac OX S Yosemite and macports.</p>

<!--more-->

<p>We’re assuming to have a Python 3 installation, possibly inside a pyvenv.</p>

<p>If we’d like to use tkinter, we get the following error:</p>

<pre><code>$ python
&gt;&gt;&gt; import tkinter
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
&lt;ipython-input-1-b98d59735c04&gt; in &lt;module&gt;()
----&gt; 1 import tkinter

/opt/local/Library/Frameworks/Python.framework/Versions/3.4/lib/python3.4/tkinter/__init__.py in &lt;module&gt;()
     36     from tkinter import _fix
     37 
---&gt; 38 import _tkinter # If this fails your Python may not be configured for Tk
     39 TclError = _tkinter.TclError
     40 from tkinter.constants import *

ImportError: No module named '_tkinter'
</code></pre>

<p>First we check that we have the <code>tkinter</code> package installed and it’s in the Python module path.</p>

<p>For Python 3.4 there’s a port named <code>py34-tkinter</code>:</p>

<pre><code>$ sudo port install py34-tkinter
</code></pre>

<p>The installed files are here:</p>

<pre><code>$ port contents py34-tkinter

Port py34-tkinter contains:
/opt/local/Library/Frameworks/Python.framework/Versions/3.4/lib/python3.4/site-packages/_tkinter.so
/opt/local/Library/Frameworks/Python.framework/Versions/3.4/lib/python3.4/site-packages/tkinter-0.0.0-py3.4.egg-info
</code></pre>

<p>However the module is not in the Python path (note the <code>site-packages/</code> subdirectory):</p>

<pre><code>$ python -c 'import sys; print(*sys.path, sep="\n")'

/opt/local/Library/Frameworks/Python.framework/Versions/3.4/lib/python34.zip
/opt/local/Library/Frameworks/Python.framework/Versions/3.4/lib/python3.4
/opt/local/Library/Frameworks/Python.framework/Versions/3.4/lib/python3.4/plat-darwin
/opt/local/Library/Frameworks/Python.framework/Versions/3.4/lib/python3.4/lib-dynload
</code></pre>

<p>It seems that the <code>py34-tkinter</code> package should put the <code>_tkinter.so</code> file one directory level higher. We can hack it by making a symlink:</p>

<pre><code>$ TKMODULE=$(port contents py34-tkinter|grep _tkinter.so)
$ sudo ln -s $TKMODULE $(echo $TKMODULE|sed 's/site-packages\///')
</code></pre>

<p>If it’s ok, the <code>tkinter</code> module can be imported without any error:</p>

<pre><code>$ python -m tkinter
</code></pre>

<p>Importing the module this way opens up a small testing GUI dialog.</p>

<p>Hope this helps!</p>

<p><img src="http://bohumirzamecnik.cz/assets/posts/install-tkinter-with-python-3-on-mac/tkinter-test-dialog.png" width="281" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Let's Share the Ideas With the World!]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2014/lets-share-the-ideas-with-the-world/"/>
    <updated>2014-11-08T00:00:00+01:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2014/lets-share-the-ideas-with-the-world</id>
    <content type="html"><![CDATA[<p>What’s better? A stream of brilliant ideas rotting in a shelf or one great idea living its own life beyond the author imagination and helping many other people? Have you ever considered what will remain after you pass away? I’ve thought a bit about those questions and guess what I realized.</p>

<!--more-->

<p>You’d probably agree a week lacking enough sleep is certainly not a fertile soil for being inspired with great ideas. Last Wednesday I finally tried to fall asleep after a long tiring day but I couldn’t. A stream of interesting ideas and questions started coming to my mind. Or reminding me that I should not forget about them as this happens to me quite often. To give you some impression:</p>

<ul>
  <li>Machine Learning on chemometrical data.</li>
  <li>Sonification of time-series.</li>
  <li>Aggregated statistics on time-series.</li>
  <li>Stochastic sampling of the time-frequency plane.</li>
  <li>Visualizing a chord time-series as a curved 3D tube.</li>
  <li>Measuring and visualizing the tuning profile of a piano.</li>
  <li>Measuring and visualizing information flow in songs.</li>
  <li>Visualizing chord progressions with both 1-step and 7-step connections using Hamiltonian circles.</li>
  <li>Song visualization via non-linear dimensionality reduction to 2D or even 1D time-series.</li>
  <li>A fast implementation of SliCQ and frequency reassignment with good API.</li>
  <li>Blog about refactoring open-source projects.</li>
  <li>Small programming projects in many fields - code &amp; e-books.</li>
  <li>Clustering with autoencoder.</li>
  <li>Using bilateral filter or content-aware fill on sound instead of images.</li>
  <li>Deep learning for sound compression.</li>
  <li>What would I start coding if I was 6 years old again but with today’s knowledge.</li>
  <li>Did people developed such farther than other animals due to fire and music?</li>
</ul>

<p>I was writing them down and finally an important question appeared.</p>

<blockquote>
  <p>What if I shared all my ideas with the world?</p>
</blockquote>

<p>My problem is not having enough interesting ideas - although I’m certainly far from the smartest people around, I’ve been gifted with a decent fantasy and I’ve been training it whole my life. The problem to utilize the holy raw material and bring the ideas to life so they actually help people. Without it they’re useless and empty. Throughout the years I had ideas for many dissertations and I don’t have so much time and abilities to finished them all alone. Actually I delved into practice instead of doing a PhD, just to be able to fiddle with my projects.</p>

<p>Recently I wondered what to do with the ever growing list of project and research ideas that I gathered in many years. I always had a mindset that each one idea could be turned into product and sharing the idea would prevent me from making money from it someday since someone could be faster - and have a free lunch. So the majority of my ideas are still in rotting a shelf. Worse than not having them at all, each time I look at them they always remind me that I’m wasting them tremendously.</p>

<p>Earlier this year I tried to turn several ideas into product (eg. the <a href="http://harmoneye.com/">HarmonEye</a> application for music visualization, etc.). Unfortunately I focused too much on the technical aspects and less on the actual people and problems. Although <a href="http://buildandlaunch.net/courses/">I learned that I should build audience first</a>, I didn’t do it properly and rather coded furiously.</p>

<p>Finally it made me completely tired without having the product running. So I made a <a href="http://bohumirzamecnik.cz/blog/categories/scandinavia-2014/">month-long road trip Scandinavia</a>, cleaned my head, decided to focus on Machine Learning and took another job. And most importantly I’m finally trying hard to learn and train an effective process of realizing the projects, GTD. I realized that for a knowledge worker this is the one of most important generally usable tools ever. Yearst ago I knew I should probably master it but I was always feeling to busy or lazy to actually start.</p>

<p>Recently I was thinking ahead of time of one moment in life that will certainly come, although noone knows when:</p>

<blockquote>
  <p>What work would I leave behind me to the society when I pass some day?</p>
</blockquote>

<blockquote>
  <p>How did I help other people solve their problems?</p>
</blockquote>

<p>This is, in my opinion, a very good tool to distinguish what is important and what isn’t.</p>

<p>So I realized ideas that appear in my brain are worthless if I just put them to some “icebox” and never share or implement them in order help other people. Having new ideas connecting multiple fields is not so expensive for me today. I cannot control them. They just instantly appear and then chase me until I write them down.</p>

<p>Partly it is a gift, but mainly it is due to the continous training and enormous stimuli from the society, in the last few decades enormously accelerated by the Internet. We live in a strange, yet wonderful era. I realize the conditions won’t be there forever, so in fact I feel a kind of responsibility.</p>

<p>So what are the pros and cons of sharing the ideas with the world?</p>

<ul>
  <li>(+) While I write a raw idea down for others I have to clarify its goals and produce a presentable unit of information. Note that this naturally corresponds is the first step in GTD or Agile.</li>
  <li>(+) When I have clarified the goals there’s a much higher chance I’ll actually make the idea.</li>
  <li>(+) If I publish a idea, eg. on my blog, someone gets interested and actually builds a product, I might still benefit from the solution, even though I didn’t have the time and/or resources to build it myself.</li>
  <li>(-/0) Maybe someone else makes a profitable product faster than me. Thus he will act as a possible competition for me. Well, this might inevitably happen even if I publish my product earlier. Then he’s called a fast follower. On the other hand every implementation is different (optimized for different goals), I might do better and also the market is usually big enough to offer room for both.</li>
  <li>(+) Even if someone else make business upon my idea, new working places might be created and possibly I might be credited as the source of inspiration.</li>
  <li>(+) Whatever happens, a good idea might attract likely minded people, start a discussion, or even live its own life beyond my control and eventually help people.</li>
  <li>(+) This way I might build audience, a group of people that are interested in this kind of ideas, that might help further sharpen the ideas, encourage me to build a product and eventually help me spreading the word.</li>
  <li>(+) Discussing the ideas with other people might help me recognize which ideas are really worth giving the energy into realizing them.</li>
  <li>(+) In the long term it might help me building a better credit in the community, make new friends, and possibly be noticed for some interesting job or contract, or make better products alone or in cooperation with someone else.</li>
  <li>(+) Something useful will remain after me.</li>
</ul>

<p>Probably you’ll agree there are mostly possitives and the nagatives are in fact inevitable and actually not that bad. It feels a little bit like a step outside a comfort zone, but such actions are usually the most useful ones. I don’t believe an idea can be “owned” (or more precisely “squatted”) by anyone, let alone the first one ever.</p>

<p>It’s like a seed. Sometimes it gets into your way and it’s up to you how you utilize it. You can burn it for heating or grow a big plant from it.</p>

<p>For myself this means that sharing my vast shelf of ideas with the world seems to the best I can do now.</p>

<p>What do you think? Do you have a similar experience?</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Scandinavia Road Trip - Den 24.]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-24/"/>
    <updated>2014-06-28T00:00:00+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-24</id>
    <content type="html"><![CDATA[<p>Německo, Česko. Výlet Lužicí, zaprášené pošprechtění s šéfovou od lahváčů, odkud pochází starý objektiv?, vyprahlá nádrž, vojenská jatka před staletími, jak chutná Míša s Birellem?, poskákán a oblízán od Růženky.</p>

<!--more-->

<p>Probuzení v lese bylo příjemné, sluníčko mi od rána vyhřívalo pelech, takže jsem vůbec nemusel klepat kosu, ani se moc oblíkat. Venku jeho paprsky hladily stébla lesí trávy mezi borovicemi. Když jsem se ohlídnul, ve směru odkud v noci štěkal pes, stála nějaká lesní chata, asi myslivecká, nevím.</p>

<p>Dnešním plánem je nehnat to dálnicí přes Drážďany a Prahy, ale projet si Lužicko - podívat se do Chotěbuzi, Görlitzu (odkud mám starý objektiv), Zittau. Pak zpět do České republiky - přes Hrádek nad Nisou, Liberec, Turnov, Jičín, Hradec Králové a známou štrekou až do Dlouhoňovic, tj. skoro do Žamberka.</p>

<p>Vzal jsem to tedy po místních silnicích a navigaci jsem nechal vypnutou, stačil jen starý dobrý autoatlas. Menší silničky se klikatily nízkými lužními lesy a poli, každou chvíli vesnice. Nápisy na cedulích jasně dávaly vědět, že místní kromě Němčiny mluví i lužickou srbštinou. O původu názvů “Lužice” a “Srbové” mám po prohlédnutí spousty středověkých map takovou jednu odvážnou teorii, ale o ní až někdy jindy.</p>

<p>V jedné menší vesnici vidím zdálky nějaké basy piv a na baráku německý nápis “Getränke….něco…”, asi jako sklad chlastu. Zaparkoval jsem to tam, protože bych tam mohl přeci sehnat nějaký místní pivka za slušný peníz. Přede dveřmi nad pár basami piv klábosili místní chlapi, uvnitř v chládku stohy bas nejrůznějších značek a za takovým stolečkem, spíš školní lavicí, seděla stará lužická babčka, co tomu tam šéfovala.</p>

<p>Ptám se jí, jestli by mi mohla doporučit nějaké místní pivo, že sháním nějaký dárek. Záhy jsem zjistil, že asi anglicky toho moc nechytá a že bych asi teda měl trochu oprášit těch osm let němčiny, které jsou pokryté asi takovými šedivými pavučinami, co se tu táhly na stropě mezi traverzami. Za chvíli jsem šprechtil jako na gymplu a ještě jsme pokecali o tom, kudy jsem projížděl. No přiznávám, ta němčina byla ale hodně lámaná. Nicméně jsem si odvezl čtyři pěkné lahváče za (oproti severu) luxusní necelá čtyři éčka.</p>

<p>Za pár hodin od výjezdu (jak se to po těch obcích vleklo) jsem byl v Chotěbuzi, hlavním centru tohoto regionu. Moc jsem se tam nezdržoval, jen mě zaujala místní knihovna, nebo budova univerzity. Nevím, co to přesně bylo, ale je to příklad pěkné moderní architektury.</p>

<p>Na větší procházku jsem se ale zastavil ve městě Görlitz, polsky Zgorzelec. Zdá se, že někdy v minulosti město lehlo popelem. K foťáku mám jeden starý objektiv, co se používal na kinofilmových Praktikách. Jmenuje se Oreston a je od firmy Meyer právě z Görlitzu. Starou fabriku jsem nehledal, asi bych ji ani nenašel a stejně jsem neměl připojení k netu. Radši jsem se podíval do historického centra. Město je to velice malebné.</p>

<p>Autu ale zas docházela nafta a já hledal nějaké slušné palivo za rozumnou cenu. Říkal jsem si, že cestou se stavím na pumpě, kterou jsem viděl při příjezdu, ale zapomněl jsem na to, že jsem vyjížděl jiným směrem. Do Zittau to ještě nebylo úplně blízko a rovinka se proměnila v pořádné kopečky se průměrnou spotřebou hravě přes 10 l na 100 km.</p>

<p>Doufal jsem, že někde pumpa přeci musí být. Jednou jsem zdálky zahlédl sloupy a střechu, zabočil tam, ale byly to jen zbytky zrušené pumpy. Shit. Pokračoval jsem dál a doufal, že nebudu muset stopovat s flaškou nafty v batohu do Zittau a zpět.</p>

<p>Projel jsem nádherné malé městečko Hirschfelde s hrázděnými domečky a u jeho výjezdu konečně pumpa. Sice samoobslužná, ale lepší než nic. Natankoval jsem tedy něco málo, abych dojel v pohodě aspoň do Liberce, jenže jsem netušil, že kvůli 6 eurům mi na pár dní udělají na kartě blokaci na 80 EUR. “<a href="http://milujipraci.cz/#02">Hajzli jedni!</a>”, zařval by Luboš Lakatoš. Těchhle blokací jsem si všiml už dřív, a proto jsem radši vyhledával pumpy s obsluhou.</p>

<p>Za chvíli jsem byl před Zittau a cedule už mi ukazovaly směr na Reichenberg/Liberec (CZ). Za chvíli jsem byl v centru, přede mnou pěší zóna a výjezd na Liberec nikde. Tak jsem to zase objel podle cedulí ven a překvapen vyjížděl stejnou trasou, odkud jsem přijel. Zase se objevil Liberec doleva, tak jsem tam zahnul a zase velký kulový, jen průmyslová zóna. Až na potřetí jsem trefil tu správnou odbočku a napojil se na rychlostní silnici skrz Polsko do Čech. Mají to nějak blbě značené.</p>

<p>Chviličku po ceduli Polska se objevila Česká republika. Nikde žádná celnice, jen cedule. Hurá, už jsem skoro doma! Za chvíli Hrádek nad Nisou a pěkně ostré serpentiny lesem do údolí. Dostal jsem pořádnou chuť si dát nějaké domácí pivko, aspoň Birella, když jsem byl za volantem. Za chvíli jsem přijel do Liberce, kde to chtělo trochu dotankovat, abych dojel až dom.</p>

<p>Do navigace jsem hodil Shellku (už jsem měl domácí připojení k netu) a ukázalo mi to, že je někde kousek u hlavní silnice, ale jede se k ní oklikou přes nějaké další obytné čtvrti. WTF? Co dělá pumpa tam? Navigace měla opět mapy trochu popletené. Brána do fabriky prozrazovala, že tady pumpa teda rozhodně není. Na druhý pokus do sousední Shellky už jsem se dostal a mohl tam hodit trochu FuelSave dieselu.</p>

<p>Adios Liberec a frr na dálnici! Teda cesta po dálnici moc dlouho netrvala, za chvíli z ní byla obyčejná státovka. Minutu po výjezdu z jedné vesnice se za křovím už rýsovala další bílá značka a naprosto nemělo smysl zrychlovat na devadesátku. Ostatní řidiči si to nemysleli, zuřivě předjížděli a ti více ukáznění stejně zuřivě brzdili před vesnicí. Jeden motorkář si vesnice asi vůbec nevšiml a asi si myslel, že jede na brněnském okruhu.</p>

<p>Sluníčko pražilo a já se potil zas až na prdeli. Přede mnou se rýsovaly Trosky a při pohledu na ceduli motorest, jsem si vzpoměl na ten Birell. Opravdu ho měli, bodnul teda fest. A dokonce měli i tvarohového Míšu. Krásně osvěžil, i když teda s tím pivem to není úplně ideální kombinace.</p>

<p>Kousek před Hradcem na mě zamrkala hnedá cedule Bitva u Chlumu 1866. Vzpoměl jsem si, že o ní točil brácha přes pár lety zvuk k filmu Les svíb, jež docela názorně ukazoval, jak si tam během chvíle zřídila jatka rakousko-uherská a pruská vojska. Po staletí jsou lesy a vsi kolem plné pomníčků a dneska tam stojí přestavěné muzeum, kde právě onen film běží.</p>

<p>Muzeum bylo v sobotu večer už zavřené, jenom si na jeho travnaté střeše hrály místní děti, pokud zrovna nelítaly obilím. Vedle muzea pěkná, ale rovněž zavřená rozhledna a za ní myslivecká hospoda s venkovními lavičkami, které praskaly ve švech.</p>

<p>Ani se nedivím, proč se tam ti vojáci tak zmasakrovali. Z kopce Chlum je totiž velmi strategický výhled na celé širé okolí. Ale mohli si taky dát přes držku jen jejich velitelé a pak v klidu odtáhnout zas dom.</p>

<p>Zbývající důvěrně známá cesta se už krátila, na Popluží, kudy vede zkratka z Helvíkovic do Dlouhoňovic mě přivítala po víc než dvaceti letech zbrusu nová silnice a v devět večer jsem dojel dom a celou výpravu zdárně završil. Jako první mě už dálky vítala chlupatá leonbergřice Růženka. Hurá, dokázal jsem to!</p>

<p>Dneska 408 km, celkem 6738,7 km, 24 dní.</p>

<p>Až nějak vstřebám všechny ty zážitky, ještě mě čeká zpracovat tu hromadu fotek, na které už netrpělivě čekáte, a taky plánuju sepsat ještě nějaké shrnutí a zkušenosti z cesty.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Scandinavia Road Trip - Den 23.]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-23/"/>
    <updated>2014-06-27T00:00:00+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-23</id>
    <content type="html"><![CDATA[<p>Německo. Burácení stíhaček, vikingské dědictví, kolik stupňů Celsia vydrží iPhone 4S?, smrad spáleného železa a klepající gumy, jak je ucpaná noční dálnice za Berlínem?, zuřivý pes v černém lese.</p>

<!--more-->

<p>V noci mě zas pěkně bolelo pravé koleno. Namohl jsem si ho před měsícem na vandru a doteď mě pobolívá. Musím někde sehnat kostival. Abych se ráno dobře vyspal, nejdřív mě ve snu ukradli auto, pak mě tam někdo pořád honil, až mě probudilo burácení stíhaček, tentokrát už pravých. Jejich burácení mě doprovázelo celé dopoledne.</p>

<p>Ráno po silničce kolem už projelo pár aut, a když sem si sbalil postel, jeden projíždějící řidič v dodávce se na mě koukal zvlášť divně. Ale to je jeho problém. Nicméně lepší bude najít si pro snídani nějaké klidnější místo. Zvolil jsem tedy parkoviště v obci Busdorf, které mi doporučovala nedaleká keška.</p>

<p>V obci jsem se i s navigací zase trochu zamotal, protože GPSka je asi trochu vedle a hlásí “odbočte doprava” na sousední křižovatce. Poté, co jsem se vymotal ze zástavby rodinných domků a napojil se na cestu lemovanou stromy, dorazil jsem na pěkné parkovišťátko s informačními cedulemi.</p>

<p>Ta hora přede mnou vypadala jako vikingská mohyla. Za chvilku jsem se ale dočetl, že to žádná mohyla není, nýbrž je to kus dlouhé hradby, která dokola obepínala město Haithabu s přístavem a pak se táhla dál. Chránila Vikingy před nájezdy Anglů a Sasů. Postavili ji někdy před 1000 lety. Nedaleko taky leží jedna keška, tak proč bych ji taky neodlovil. Už na parkovišti a pak po cestě jsem zjistil, že tam pazourky jsou fakt všude.</p>

<p>Po snídani, stále za řevu tryskových motorů stíhaček, jsem se konečně mohl vydat zpět na dálnici. Začal se dělat pěkný hic. Dál už je to celkem nuda. Skoro pořád dálnice, občas nějaká spojka dálnic, občas kolona. Na jednom parkovišti jsem zjistil, že teplo ze sluníčka iPhonu moc dobře nedelá a on sám to pozná a vypne se, šikula.</p>

<p>Dál jsem přemýšlel, jestli to zabalím ještě před Berlínem, nebo to prubnu a dám to až za Berlín. Byl pátek večer a po zkušenostech s ucpanou Varšavou se mi moc centrem projíždět nechtělo, i když situace na dálnici nic špatného nevětšila. Byl jsem utahaný a představa, že bych dvě hodiny popojížděl na dvojku mě moc lekákala. Tak jsem tedy zvolil vnější okruh po dálnici, který byl sice asi o 20 kilometrů delší, ale zato provoz tam byl fakt velmi mírný.</p>

<p>Měl jsem za sebou asi 450 km a únava tomu odpovídala. Každou chvíli jsem musel zastavit a trochu si odpočinout. Sice zdržení, ale pořád lepší než na pár vteřin usnout a někam to napálit. V jednu chvíli jsem začal slyšet pár kiláků takové divné pravidelné hupsání a ucítil jsem smrad spáleného železa. Určitě jsem někde píchnul a teď brousím ráfky, pomyslel jsem si. Na asi 5 km vzdáleném parkovišti jsem kouknul na gumy a ty byly naštěstí naprosto v cajku. Asi ta dálnice je hrbolatá a načuchnul jsem pálící se brzdy kamionu přede mnou.</p>

<p>Už se setmělo, po cestě na sever celkem brzo, “už” v deset večer, a mě se fakt chtělo do pelechu. Už jsem myslel, že to nechám do zítřka na jednom parkovišti u dálnice. Chvíli jsem si dáchnul a pak jsem si to rozmyslel. Pořád tam sviští jedno auto za druhým a hučí kamiony, na zítra bych se moc nevyspal a to mi zbývá okolo ještě 400 km. Rozhodl jsem se, že se přemůžu a podle půdvodního plánu ujedu ještě pár kiláků z druhému nejbližšímu exitu a hodím to někam do lesa k městu.</p>

<p>Dálnice byla v noci úplně prázdná. Do ausfahrtu 5a jsem nepotkal snad jediné světlo ani v jednom pruhu. Zamířil jsem to k městu a ještě před ním odpočil do nějaké průmyslové zóny. Na jednom parkovišti vedle už spal kamioňák, tak jsem pokračoval, až zas cedule města skončila. A hle, pěkná odbočka do lesa a za chvíli dokonce prostorné parkoviště na několik aut. Super. To je moje dnešní místo!</p>

<p>Z dálky se slabě ozval projíždějící vlak a provoz z dálnice nebyl slyšet skoro vůbec. Nejhlasitější byly tak možná noční cikády, nebo ptáci. Tady se bude odpočívat dobře.</p>

<p>Než jsem usnul, ještě jsem kousek vedle uviděl projíždějící auto a celkem zuřivě štěkal pes. Myslel jsem, že jde po mě nějaký myslivec, ale nic. Za chvíli bylo úplně ticho a já mohl konečně jít spát. Zítra možná dojedu až domů.</p>

<p>Dnes nejdelších 488 km, celkem 6331 km.</p>

<p><a href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-24/">Další den</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Scandinavia Road Trip - Den 22.]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-22/"/>
    <updated>2014-06-26T00:00:00+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-22</id>
    <content type="html"><![CDATA[<p>Dánsko, Německo. Rozjuchaná mládež ve starobylém městečku, nečekané mýto, dálniční šusi, hluční skauti, pazourková cesta.</p>

<!--more-->

<p>Ráno jsem si říkal, že bych se taky mohl v Dánsku trochu podívat na místní architekturu. Sice jsem propásl Kodaň a ani se mi do ní zajíždět nechtělo - bylo by to na dlouho, drahé parkování, mohl bych zase dostat nějaký tučný flastr. To se radší podívám do menšího Køge, které leží pár kiláčků ode mě.</p>

<p>Chvíli potom, co jsem zaparkoval, začala odkudsi dunět taneční muzika, jako v klubu. Porozhlédl jsem se kolem a vidím zelený náklaďák, korba ozdobená listnatými větvemi a barevnými fáborky a na ni křepčí parta mladých studentů. Projeli kolem, já si je vyfotil, oni na mě mávali. Za chvíli další a další podobné kamiony. Asi budou mít nějaký majáles, nebo co.</p>

<p>Køge mě nadchlo od první ulice. U řeky krásné maličké domečky s hrázděnými zdmi, určitě mnoho staletí staré. V centru stejně tak. Krásně zdobené trámy, nápisy ze 17. století, prostě paráda. Studenti se shromažďovali na náměstí, kde na ně už čekali rodiče, babičky a známí. Skoro všichni v pacce plechovku Tuborga a úsměv na tváři. Zeptal jsem se, co to slaví za fesťák - prý oslavují maturitu. Pěkný.</p>

<p>Pokračoval jsem dál a trochu mě překvapila další cedule s placením mýta. Myslel jsem, že budu platit jen na Øresundu. No ale ještě tam je jeden placený most přes moře, a to mezi Korsørem a Nyborgem. Takže dalších 235 DKK. Tentokrát tam v budce už nikdo neseděl, jen jsem vložil kartu, kamera zjistila, že jedu osobním autem, a vyjelo mi to lísteček. Jednoduché jak facka.</p>

<p>Ručička nádrže zajížděla do červené zóny a Německo dakelo. Bylo ještě potřeba trochu dotočit. Vybral jsem si ale blbý čas, ráno jsem viděl naftu za 10,07 DKK/l, teď jsem musel tankovat za 11,59. Cestou jsem narazil na automatickou Shellku s docela příznivou cenou, 9,96 DKK/l. Super, nebudu čekat na Německo a šplejchnu tam pořádně.</p>

<p>Za chvíli jsem byl Německu. Málem bych si toho přechodu Flensburg ani nevšiml. Cedulku Deutschland jsem nikde pořádně neviděl, jen tabuli s rychlostmi. Ve městě 50, mimo město 100, na dálnici 130 - ale to je doporučená rychlost, limit tam obecně není. To jsem si všiml hned za chvíli. Oproti Švédsku, kde si všichni spokojeně brmlají tu svou stovku, tady spousta osobáků jezdí jak šusi.</p>

<p>Na dálnici byl sice docela provoz, ale aspoň to odsejpalo. Celý den ale střídavě svítilo sluníčko a chcalo, ale fest. Odpoledne to byla jedna průtž mračen za druhou. Padalo tolik vody, že nebylo vidět na krok.</p>

<p>Večer jsem už znaven hledal nějaké klidné místo ke spaní. U dálnice na odpočívadle se mi to nechávat nechtělo, jednak kvůli bezpečnosti a jednak je tam pěkný hluk. Na mapě jsem jako obvykle našel nějaké pěkné místo a vydal se tam. Obec se jmenovala Selk a cestou se objevilo takové pěkné ukryté místo u lesa. K mému překvapení, tam bylo ale pěkně rušno, sice ne tak jako na dálnici, ale ty děti na skautském táboře řvali jako tuři. Ale co, je tu les a klid, snad mě nikdo vyhánět nebude.</p>

<p>Ještě nebylo tolik hodin, a tak jsem si řekl, co třeba si dát nějakou procházku do lesa kolem vody. Vede tam turistická stezka a dokonce je tam i cache. Moc pěkné to tam je. Všudě cvrdlikali ptáci, sluníčko se ukládalo k spánku a já si cestou všiml, že chodím po pazourcích. Ano, po pěšině byly v písku rozeseto nespoček úlomků sklovitých kamínků spečených sopečnou činností. Ty jo, z toho by se daly udělat třeba hroty do šípů, nebo nějaké jiné pravěké nástroje!</p>

<p>Znáte to, čuchací pud lovce a sběrače. Jako když vyrazíte v zapařeném letním dni do lesa na houby. Koukal jsem pod sebe, prohlížel si kamínky, představoval si, k čemu by se mohly hodit. Takovéhle kameny jen tak člověk nevidí a tady jich je plná země. Za chvíli mi začaly kapsy u kalhot poněkud těžknout, a to jsem ještě ani nedorazil k té kešce.</p>

<p>Celé to místo kolem vody bylo moc pěkné. Už jsem sjel ale hodně na jich a tak sluníčko zapadalo “už” někdy v deset večer. Poslední rudé paprsky na kmenech staletých buků nad vodou mě vyprovodili a já mohl jít v klidu spát.</p>

<p>Dneska 349 km, celkem 5843 km, zbývá něco kolem 870 km.</p>

<p><a href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-23/">Další den</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Scandinavia Road Trip - Den 21.]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-21/"/>
    <updated>2014-06-25T00:00:00+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-21</id>
    <content type="html"><![CDATA[<p>Švédsko, Dánsko. Hekající běžec, jahody ve Varle, tajemný rosol na pláži, stopař na dálnici, most ze sci-fi.</p>

<!--more-->

<p>Poté, co jsem se v lese na ostrvě Tjörn vzbudil, bylo na cestě docela “rušno”. Kromě pár aut se na mě šel podívat jeden zajíc, uháněl okolo běžec s ortézou na koleni, co hekal jako ve východoněmeckém péčku, a pak s skoro nahatý lyžař, co se potil na kolečkových lyžích.</p>

<p>Vymotal jsem se z labyrintu silniček na ostrově a zase se napojil na dálnici na jih. Zastihlo mě ale pěkně silné pršení, že jsem znovu byl šťastný jak blecha, že jsem si před cestou koupil pořádné stěrače.</p>

<p>U města Kungsbacka mě zaujala cedule Varla, tak jsem se tam jel podívat a vyfotit si ji do sbírky. Aspoň bylo poblíž parkoviště a já si mohl dát svačinku a doplnit naftu (pumpa OKQ8, nafta za 14,51 SEK/l). Nedaleko prodávala slečna jahody, nebo spíš celou dobu někomu volala, protože nikdo nezastavoval.</p>

<p>Odpoledne jsem hledal místo pro oběd. Docela pěkně vypadala pláž u města Ängelholm. A taky, že jo, pěkný les, turistické parkoviště, záchody, dokonce i ohniště. Po zaparkování šli kolem nějací důchodci, manželský pár, a hned se se mnou dali do řeči. Za dunami nekonečná písečná pláž plná kousků škeblí z průlivu Kattegat. To si pamatuju ještě ze školy - Kattegat a Skagerrak. Kattegat je prý v překladu kočičí ocas. Asi to tam námořníci neměli úplně snadné, aby někde neztroskotali.</p>

<p>Na pláži mě zajalo, co Severní moře vyplavilo kromě mořské trávy i za takové kusy rosolu. Asi nějaké medůzy či co. Sluníčko za chvíli vystřídaly černé mraky a já měl ještě takovou chuť na teplý zázvorový čaj, polívku a fazolky. Za chvíli už hřál ohýnek a mraky šly šejdrem.</p>

<p>Už se blížil večer a já se rozhodl, že do Dánska to není zas tak daleko a že tam zkusím dojet ještě dnes. Kodaň už asi nedám - je to zas komplikované a drahé někde zaparkovat, bolí mě koleno, musel bych v noci jet dál hledat místo na spaní a stejně asi bude pršet. To si radši v klidu prohlídnu zítra nějaký menší malebný městečko.</p>

<p>Cestou po dálnici mě fascinoval stopař, co si to úplně v klidu štrádoval s krosnou na krajnici a ještě mával palcem. Jako, kdyby to byl nějaký slušný stopak, klidně ho vezmu, abych si s ním pokecal, ale zastavoval na dálnici je jako strkat ruku do košíku s jedovatými hady.</p>

<p>Na sloupu cedule “Last exit in Sweden” a přede mnou se začaly rýsovat pilíře mostu. To bude ten slavný Øresund. Za chvíli budka, v ní dva chlapíci. Zaplatil jsem 49 EUR, ani to nechtělo PIN, a mohl pokračovat po moři do Dánska. Vybral jsem si takovou dvojsečnou dobu. Jel jsem na západ a přímo do očí mi smažilo sluníčko. Ale na druhou stranu pohled, který se přede mnou rozprostíral za to mýto stál. Připadal jsem si jako v ilustraci k nějakému sci-fi románu.</p>

<p>Silnice vedla po mostě docela vysoko, pode mnou šplouchaly vlny na moři, v dáli mořské větrníky a na obzoru se rýsovalo Dánsko. Z Kodaně odlétalo prudce vzhůru každou chvíli nějaké letedlo. Poté, co se most zase začal svažovat dolů, vidím před sebou jen moře. A kde je zbytek mostu? Za minutku jsem se zanořil do podmořského tunelu. Před chvílí oslnivé světlo, teď zas tma jak v řiti. Až vyjedu, nic neuvidím. Taky, že ne. Na konci tunelu jsem si připadal jak krtek, co právě vykoukl z díry.</p>

<p>Kodaň jsem jen projel a ani už nezajížděl do centra a pokračoval se zamhouřenýma očima dál po dálnici. Auto už mělo od Švédska žízeň a tak jsem ho napojil v Shellce u Karlslunde, nafta za 11,57 DKK / l (1 DKK ~ 3,8 CZK). Jak jsem tak odpočíval, přijel natankovat taky kamion s velkým nákladem. Když jsem pak vyjížděl, byl trochu šprajcnutý u výjezdu.</p>

<p>Na obloze se začaly dělat naprosto luxusní červánky, že jsem si říkal, škoda, že jsem po tom mostě nejel o hodinu později. Parkoviště jsem našel u města Borup - kousek u dálnice, ale docela tam byl klid.</p>

<p>Místní SIMku v Dánsku a Německu už řešit nebudu, koupil jsem si další balíček datového roamingu od Mobil.cz, 100 MB za 185 Kč. Na navigaci to snad bude stačit.</p>

<p>Dnes rekordních 440 km, celkem 5494 km, zbývá cca 1130 km.</p>

<p><a href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-22/">Další den</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Scandinavia Road Trip - Den 20.]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-20/"/>
    <updated>2014-06-24T00:00:00+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-20</id>
    <content type="html"><![CDATA[<p>Norsko, Švédsko. Překvapení s hnědou cedulkou, nidky nedobytá pevnost, kontakt s pravěkými lidmi, pobřeží tisíců ostrovů.</p>

<!--more-->

<p>Od rána za stromy na hlavní silnici, která se táhla vsí, hučela auta. Všichni spěchali do práce a já jsem jim byl asi ukradený, pokud si mne vůbec někdo všiml. Ještě bych si chvíli pospal, ale sluníčko bylo neúprosné. Vyrazil jsem celkem brzo, někdy o půl deváté.</p>

<p>Říkal jsem si, že dnešek bude asi docela nuda, jen rychlostní silnice, která se pak změní v dálnici, pak most Svinesund a hurá do Švédska, kde bude zas jen ta dálnice. Ale co, aspoň to bude rychle ubíhat.</p>

<p>Nejdřív bylo ale potřeba vyřešit vodu. Mám s sebou filtr, takže můžu prakticky zastavit u každé louže, ale na druhou stranu je s tím trochu práce a zatím nechci riskovat, že bych náhodou z toho dostal nějaké bolení břicha, když mohu sehnat vodu v civilizaci. PETek už mam dost a kupovat si mi balenou vodu za draho teda nechce.</p>

<p>Stavil jsem se tedy na první pumpě, kterou jsem potkal. Záchody měly za mince. Ne, že bych to v životě např. v Německu neviděl, ale za celou výpravu jsem se s tím nesetkal a stejně jsem žádnou norskou korunu neměl. Teda jen jednu z cache, ale tu do automatu na záchodku teda dávat nebudu. Z boku pumpy jsem z dálky zahlídl ceduli s kohoutkem. To vypadá dobře. Kohoutek byl na klíč, tak jsem se poptal na kase a cajk, v klidu jsem si mohl natankovat. Vzal jsem pár flašek, aspoň to vydrží na zítra.</p>

<p>Pokračoval jsem dál a na státovce to pěkně rychle jelo a ani zas tak moc aut. Včera jsem ale koukal do mapy a zaujalo mě nějaké místo se dvěma hvězdičkami. Jedna znamená, že to stojí za zajížďku, dvě, že to stojí za samostatnou cestu. Prý nějaké jeskynní malby, či co.</p>

<p>Ujel jsem nějaký sto kiláků a objevila se hnědá cedule značící nějakou památku nebo turisticky zajímavé místo. Frederiksten Festning u města Halden sice ale pravěká malba nebude, ale i tak to může velmi pěkné a mohl bych si tam dát svačinu. Deset kiláčků od hlavní trasy je kousíček. I na takovém štráfku asfaltu ale mají nasazených pět radarů - v každém směru.</p>

<p>Přijel jsem do města a už z dálky bylo vidět krásné hradby. Cedulky mě dovedly až na velké parkoviště, i se záchody a dokonce i s pitnou vodou. Super, kromě svačinky jsem mohl doplnit vodu snad až do Čech. Posilněn jsem se vydal na procházku po pevnosti.</p>

<p>Jedním slovem krása. Staré hradby prošpikované komorami tu na kanóny, tu na munici, tu na ubytování vojáků. Ze tmy na člověka vybafne i duch - děti z toho musejí mít zážitek na celý den. Uvnitř hradeb mezi dvěma skálami citadela - velitelské budovy, věže na střelný prach. Z druhé strany hradeb starobylá děla. Na vršku skály věžička s poplašním zvonem. Všechno krásně zrekonstruované a popsané, dokonce i pár kešek a překrásný výhled na místní fjord.</p>

<p>Pevnost začali Norové stavět někdy v 17. století na obranu proti Švédům, když jim Švédové zabrali kus území s jinou pevností. Používala se celá staletí, až pak uzavřeli mezi sebou mírovou dohodu někdy počátkem 20. století. Za II. sv. války tam pak Němci zřídili vězení pro místní odbojáře. Našlo se dost místních, kteří bojovali proti okupaci nacistickým Německem. Pevnost nikdy nebyla dobyta, a tak se docela zachovala a dnes si ji lidé mohou prohlédnout zevnitř a pokochat si stavitelským a válečnickým uměním předků.</p>

<p>Do hranice se Švédskem to bylo, co by kamenem dohodil. Znovu jsem vjížděl do Evropské unie, tak jsem si myslel, že mě budou zas kontrolovat nějací celníci. Stačilo vjet do pruhu “Toll - nothing to declare” a cesta byla volná. No jo vlastně, Norsko je taky v Schöngenu. Takže pohoda.</p>

<p>Podobně to bylo s mýtným. Jelikož jsem si předem zaregistroval auto a kreditní kartu, jen se mi to za pár týdnů nebo měsíců automaticky odečte. Nemusel jsem stavit na manuální platební bráně, stačilo projet jen pruhem AutoPass. Docela by mě ale zajímalo, kolik mě mýtné bude stát.</p>

<p>Dned po celnici jsem přejel Svinesundský most přes fjord. Myslel jsem, že to bude nějaký dlouhý most přes rákosí, ale houby, byl celkem kratičký, zato vysoko. Co mě ale zarazilo, byl ten nádherný fjord okolo. Škoda, že jsem se přímo ve Svinesundu nachvíli nestavil porozhlédnout se.</p>

<p>Ručička na nádrži už byla skoro na červeném proužku, tak to chtělo najít první pumpu za čárou. Trochu jsem si s tím palivem připadal, jako když skoro celé Norsko držím chcaní, abych si pak mohl v klidu ulevit. Za pár kilometrů bylo další město Strömstad a hned na začátku jedna pumpa. Cenovka sice skoro stejná jako předtím v Norsku, ale tentokrát byla ve švédských korunách. Tankoval jsem za 14,47 SEK/l, tj. cca 43 Kč. Pořád lepší než nejlevnější nafta v Norsku, co jsem viděl.</p>

<p>Auto se teda nabumbalo a za dalších pár desítek kiláků se na mě u města Blomsholm smála další hnědá cedulka. Ani jsem netušil, co tam vlastně bude, ale i když je ta cedulka hnědá, to hnědé, co byste čekali tam asi nebude. Místo toho mi po pár zatáčkách mezi poli jen zůstala čelist dole. Oni tam ti Švédové mají taky takový malý Stonehenge, nebo kamenné řady jako v Carnacu.</p>

<p>Ty dvou- až čtyřmetrové postavené kameny ale nejsou uspořádány v kruhu, ale do tvaru lodě (nebo rugbyového míče), a stojí na vrchu takové mohyly. Prý tam je už od pravěku dávné pohřebiště. Super, to musím vyfotit, to se bude mámě určtitě líbit. Docela trefa, na to že jsem jen na blind odbočil na nějakou hnědou cedulku.</p>

<p>Ale to není všechno, z nedalekého přístavu prý někdy zhruba v 18. století král nechal po souši přepravit celou skupinu válečných lodí až do svinesundského fjordu, kde pak napadli Frederikovu pevnost - tu, na níž jsem se před chvílí procházel.</p>

<p>To se to začíná dnes památkami jen hemžit. U potůčku byl klid, tak jsem si mohl pěkně zchladit a umýt zpocené nohy a dopsat dva dny deníku. Ještě ale najít ty pravěké malby.</p>

<p>Opravdu někdy kolem páté večer se objevila další hnědá cedule směřující k městu Tanum, resp. kousek za něj do Vitlycke. Přijel jsem k muzeu a měl jsem trochu obavu, že ty jeskyně budou asi někde úplně jinde a muzeum bude zase mastně placené, jako ta všechna předchozí. Ale, co podívám se, jak to mají, za to nic nedám.</p>

<p>Muzeum ve Vitlycke mě překvapilo, bylo otevřené úplně zadarmo. Proč? No mají to trochu fikanější, než ta ostatní muzea, tady mají totiž fakt hafo pěkných suvenýrů. Hned bych si něco odvezl. Ale kvůli suvenýrům tu přeci nejsem, zajímalo mě, o co tady vlastně jde.</p>

<p>Za chvíli bylo vše jasné. Hned naproti muzeu jsou placaté žulové skály, nikoliv jeskyně, do kterých lidi někdy přes 2000 let vysekávali různé obrázky. Hodně obrázků. Prý je to památka srovnatelné úrovně jako třeba pyramidy v Gíze, nebo Taj mahal, nikde na světě nic podobného rozsáhlejšího není.</p>

<p>Celé muzeum bylo věnováno kromě těchto skalních obrazů hlavně životu místních lidí v době bronzové, tj. někdy začátkem letopočtu. Mají to udělané fakt krásně, člověk se dozví spoustu věcí a hlavně pro děti to musí být fantastická cesta do pravěku.</p>

<p>Po té, co jsem si prohlídl muzeum, než v šest zavírali, mohl jsem konečně jít k oněm skalním obrazům. Naproti přes silnici za potokem mě uvítala hezky upravená louka a nad ní taková velká zaoblená placatá skála, co se mírně zvedala do kopečka. Na ní mraky kresbiček, teda vlastně vysekaných postaviček lidí, zvířat a nejvíc lodí a nějakých saní. Prý to žere dost kyselý déšt a ty cestičky v kameni jsou jen pár milimetrů hluboké a nabarvené na červeno, aby byly vidět.</p>

<p>Moc pěkný kontakt s lidmi, kteří tu žili tolik generací před námi a nechali tohle. Až si tak uvědomuju, co vlastně zbyde po nás?</p>

<p>Den jsem tedy zasvětil nečekaným starobylým památkám a taky jsem po dálnici udělal zas kus cesty. Do Göteborgu zbývá tak 100 km, tak pojedu, co to dá, a když budu unavený, někde to nechám.</p>

<p>To někde se ukázalo jako ostrov Tjärn. Na mapě vypadal docela malebně. Tak ho zkusím projet, podívat se, jak to tu vypadá a třeba někde najdu plácek na spaní.</p>

<p>Na ostrov se jede přes takový docela vysoký a dlouhý most přes moře. Z něj byl nádherný výhled na mraky ostrůvků v okolí osvícených nízkým večerním sluncem. U každého ostrůvku, kromě těch nejmenších bylo vidět stěžně malých jachet. Prostě kouzelné.</p>

<p>Ostov se ukázal, že není tak malý, jak vypadá na mapě. Pořád jsem jel dál a dál, pravda docela pomalu, a stále okolo políčka, farmy a nad nimi skalky porostlé borovicemi. Cedule ukazovala, že bych mohl dojet k muzeu akvarelové malby. To bude sice večer zavřené, ale taky tam bude přístav.</p>

<p>Okolo mola zase spousta člunů a kolem přístavu rozeseté maličké domečky s ještě užšími uličkami. Malá lesní ulička ale nikde. Když jsem konečně našel nějaké parkoviště (omezené na 2 hodiny), zapíchl jsem špendlík do mapu a pustil navigaci. Prý tam bude nějaká turistická stezka, tak by u ní mohl být nějaký štěrkový plácek.</p>

<p>Navigace je občas užitečná, ale občas pěkná sviňa. Z asfaltky, byla štěrková cesta, pak úzká hliněná cesta, až z toho bylo něco jako pěšina, kde by se dva koně dost těžko vyhýbali. Ale pořád tam vedly stopy aut, tak jsem byl relativně klidný. Až pak vidím ve zpětném zrcátku ceduli zákaz vjezdu autům a motorkám. Z mojí strany nic takového nebylo. Divné. Asi nepředpokládají, že tu kdy pojede turista, a místní nejsou blbí, aby si tu ničili auta v těch dírách, a maximálně tu asi jezdí traktorem na pole nebo do lesa.</p>

<p>Nakonec se to napojilo zas na normální štěrkovku a konečně se přede mnou objevilo jedno místo vedle cesty. Hurá! Sice tu není výhled na moře, jak jsem si přál, za pár zatáčkami jsou asi nějaké domky a ohýnek bych tu pro suchý les kolem nedělal, ale jinak cajk. Spát se tu dá, co jiného zbývá.</p>

<p>Dneska 322 km, celkem 5054 km. Zítra bych rád našel nějaké jezero, kde by se dalo vykoupat (má být jasno a teplo), a udělal si na ohýnku teplý čaj se zázvorem a polívku. A když to pojede dobře, možná dojedu i do Dánska.</p>

<p><a href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-21/">Další den</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Scandinavia Road Trip - Den 19.]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-19/"/>
    <updated>2014-06-23T00:00:00+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-19</id>
    <content type="html"><![CDATA[<p>Norsko. Olympijský můstek v Lillehammeru, rychlá i pomalá dálnice, teplota a žlutý papírek v Oslu.</p>

<!--more-->

<p>Ráno před odjezdem z rozeklaných skal jsem ještě dopsal zas kus deníku, takže jsem vyjížděl skoro až před polednem. Cesta se pořád klikatí po státovce na jih, takže člověk se buď může “kochat” krajinou z auta, nebo občas udělat nějakou zajížďku na stranu a zpět.</p>

<p>Aspoň, že počasí se uklidnilo a tolik neprší, tedy spíš je polojasno. Taky dobré, že to jede víceméně z kopce a tolik to tedy nežere. Na rovných úsecích mě ale občas začíná být nepříjemná ta osmdesátka, táhne se to jako guma.</p>

<p>Dnešní významnou zastávkou je Lillehammer. Mnozí si jistě vzpomenete, co se tam před dvaceti lety událo. Tou dobou jsem chodil do první třídy. Cedule jasně naznačovaly, že tam byla v roce 1994 zimní olympiáda, a že bych si měl prohlídnout nějaké ty stadiony. Zamířil jsem tedy vzhůru až na skokanský můstek pro lety na lyžích. Je mohutný, ale nechtěl bych stát s namazanýma lyžema tam úplně nahoře, při pohledu z té výšky bych asi hned vyklopil oběd i se snídaní.</p>

<p>Ale pro nás, co nemají výšky tak úplně v lásce, ale za to mají rádi lesy, byla schovaná u potoka jedna hezká keška. Na přírodní koupaliště na tom samém potoce to dneska ještě nebylo. Kdyby tak svítilo pořádně sluníčko. To jsem netušil, že si ho ještě dnes užiju dosytosti.</p>

<p>Rozloučil jsem se s olympijskou vesnicí a pokračoval dál. Začala dálnice a konečně to pěkně fičelo. Jenže jsem se neradoval dlouho. Za chvíli zablikala první brzdová světla aut přede mnou a kolona už stála. Myslel jsem si, že to bude asi nějaká bouračka, jenže po nějaké době se to rozjelo a vjeli jsme do stavby. Na takovéhle projekty putují peníze z mýtného. Na kopci kolem jezera se klikatily tunely a vylámané kusy skály kudy povede nová dálnice. Kolona popojížděla krokem, že to brala tak možná jednička a sluníčko pražilo fest do kabiny. Takhle to trvalo asi hodinu, než se objevil spásný kruhák a značka 100.</p>

<p>Přemýšlel jsem, jestli dneska stihnu dojet do Osla, nebo si ho nechám na zítra. Po dálnici to ale svištělo docela dobře, takže jsem tam dojel někdy po osmé večer. První, čím mě Oslo mě uvítalo, byla velká mešita. Ale no tak. Dálnice se zavrtala do nekonečných tunelů pod městem, co se kroutily jako klubíčko zmijí, až mě tunel vyvrhl přímo v centru mezi davy lidí a hromadu semaforů. Hlavně někam zaparkovat a podívat se do mapy. Jedno místo jsem našel a zjistil jsem, že do centra s přístavem to je pěšku už jen kousek. Tady dobře, že už je večer a parkování je zadarmo.</p>

<p>Vydal jsem se tedy s foťákem dělat turistu. Prošel jsem skrz pár ulic, jeden park s palácem a byl jsem u vody. U břehu uvázané výletní loďky, vedle palác, kde se udělují Nobelovy ceny a na kopečku pevnost. Do toho z boku svítilo večerní sluníčko. Před radnicí skejťáci, nebo spíš skejťačky s černými dredami, džínovými minikraťasi a flanelovými košilemi u pasu. Ještě jim chyběl na rameni kazeťák s uchem a dvěma naleštěnými repráky. Skoro jsem si říkal, jestli nejsem v Bronxu v 80. letech.</p>

<p>Z dáli se linula hlasitá hudba, asi nějaký fesťák. Tak jsem to šel prozkoumat. O hudbě to nebylo, hrál se zrovna fotbal. Ale za fesťákovou ohradou šlo projít na hradby pevnosti, odkud byl krásný výhled do zátoky. Na obzoru vidím dým a nějaké plameny. Jeden ostrůvek hořel. Vlastně ne jeden, kouř se linul snad z pěti ostrůvků. Zvláštní.</p>

<p>Sluníčko pomalu zapadalo a já se zas po stejné trase vracel k autu. Jenže k mému překvapení vidím za stěračem žlutý papírek. Buď to je reklama, nebo pokuta. Bylo to to druhé. Stál jsem totiž jen 3 metry od přechodu, nikoliv minimálně pět. Tyhle dva metry mě budou stát 500 NOK, tj. nějakých 1800 CZK, plus možná poplatek za zahraniční převod. Ach jo, pěkně drahé dvě večerní hodiny parkování…</p>

<p>No nic, v Oslu spát nebudu, chtělo by to hodit dál. Tak jsem se zas těmi šílenými tunely vysoukal na dálnici a pár kiláků za městem odbočil hledat klidné místo v místních vesničkách. Jedno jsem opravdu našel, ale přesto, že bylo kryté stromy, zas tak klidné nebylo. Pořád tam něco jezdilo po silnici a mě to rušilo. Ale lepší, než aby na mě ráno bouchal nějaký policajt, nebo drsný týpek s kapucí, kterého zajímá jen moje autorádio (které stejně nehraje).</p>

<p>Dnes 345 km, celkem 4732 km. Do Švédska už je to jen asi 100 km. Tam bude konečně levnější palivo. A taky bych se měl poohlédnout, kde doplním vodu.</p>

<p>Teplota byla večer po pár dnech zas příjemná. Sice nejsem ani homosexuál, ani zoofil, ale přesto jsem si mohl dnes s klidným srdcem říct, “<a href="http://www.youtube.com/watch?v=wqEjr_V-OQQ">nejtepleji bylo v Oslu</a>” (alespoň za poslední týden). Slunce v duši.</p>

<p><a href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-20/">Další den</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Scandinavia Road Trip - Den 18.]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-18/"/>
    <updated>2014-06-22T00:00:00+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-18</id>
    <content type="html"><![CDATA[<p>Norsko. Střechy porostlé smrčky, laciná nafta, naleštěné káry, lišejníkové království, ovce na sněhu, ukryté peřeje.</p>

<!--more-->

<p>Na noc jsem se pro jistotu teple nabalil, ale od rána na mě pražilo sluníčko, lepší než klepat kosu. Na parkoviště se začaly sjíždět davy lidí, co se nejspíš těšili na pěknou nedělní procházku po parku. Rád bych ještě vidět taky nějaký fjord, když už jsem v tom Norsku. Místo hlavní cesty jsem tedy zvolil zajížďku přes Orkvanger.</p>

<p>To co, nejdřív vypadalo jako pár fabrik a překladišť na břehu moře se ukázalo mít pěkné odpočinkové místo na pobřeží pro místní i turisty. Prošel jsem se tedy po molu, svlažil ruce v severním moři, koukal, jak se kopce svažují do moře a zkoušel odlovit taky nějakou kešku.</p>

<p>Dál jsem pokračoval horskými údolími zase zpět na státovku, na kterou jsem se měl napojit ve městě Berkåk. Zase už pršelo a mraky se valily přes vrcholky hor. V jednom městečku mě zaujala krásná roubenka se střechou porostlou trávou. Ono takové bylo každé druhé starší stavení, ale tahle měla své parkoviště, záchody i ceduli. Dokonce i autobusovým zastávkám na střeše raší mladé smrčky. Fakt rozkošné.</p>

<p>V Berkåku jsem natankoval, zarazila mě cena 12,84 NOK/l. Nějak levné na Norsko. Ceně odpovídala i fronta u pumpy. Asi měli nějakou nedělní slevu. O město dál čepovli naftu dokonce za 12,19 NOK/l, tj. necelých 44 Kč, nejmíň, co jsem v Norsku viděl. Nejvíc bylo přes 53 Kč. Jelikož venku hustě pršelo, dal jsem si kafčo a na chvíli šel psát deník. A taky jsem zas vytáhl ukulele, do toho deště se ty písničky docela hodily.</p>

<p>V Oppdalu měli celý motel roubený a porostlý trávou. A před ním naleštěné hranaté ameriky a žihadla značky Pontiac. Holt někdo jde v neděli do lesa, někdo jede provětrat káru.</p>

<p>Řeka tekla údolím proti mě a cesta se zvedala. Jedeme do hor. Příroda kolem začala být taková nějaká hezčí a okolo žádné baráky. Aha, vlastně projíždíme národním parkem Kongsvoll. U jednoho odpočívadla jsem se už nevydržel kochat jen koutkem oka, zastavil jsem a nažhavil všechny fotoaparáty.</p>

<p>Ty skalky porostlé lišejníky a vřesy a mezitím bublající říčka stály za to si je prohlédnout pěkně zblízka. Naprosto úžasné. Vypadá to tu jako něco mezi Středozemí a Mordorem, ale přes samé keříčky lišejníku není kam šlápnout. Jestli někdy pojedu zase do Norska, do tohohle parku chci. Byl fakt rozlehlý a to jsem projel jen maličkou jeho část.</p>

<p>Cesta šla pořád nahoru a najednou kousek u silnice vidím na jedné straně stádo ovcí, na druhé sníh. A na obzoru dramatická oblaka. Kouknu na kompas a vidím nadmořskou výšku skoro 1000 m. Tak to už dává smysl, co tu dělá ten sníh.</p>

<p>Po chvíli šla už silnice jen dlouho celkem prudce dolů a já přistál v údolí ve městě Dombås. Ne, ukrajinský Donbas to opravdu není. Chvíli jsem odpočíval, koukal na kompas, o kolik stupňů severní šírky jsem zase pokročil a přemýšlel, kam to na noc uložit. Chtělo by to někde mimo město.</p>

<p>Pokračoval jsem tedy dál rozeklanými údolími až jsem našel jedno hezké odpočívadlo u města Nord-Sel oddělené od hlavní silnice skálou. Za pár skalkami na druhé straně a za nespočet hajlzpapíry se skrýval pohled dolů přímo do divokých peřejí řeky Lågen. Spát by se tu dalo celkem slušně, už jsem celý utahaný zas po kolika klikatých kilometrech.</p>

<p>Dnes 275 km a 4387 km celkem. Další plán je navštívit Oslo.</p>

<p><a href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-19/">Další den</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Scandinavia Road Trip - Den 17.]]></title>
    <link href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-17/"/>
    <updated>2014-06-21T00:00:00+02:00</updated>
    <id>http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-17</id>
    <content type="html"><![CDATA[<p>Norsko. Chčije a chčije, fujtajbl kafe, první fjord, ruiny nebo koncentrák, pozdemní peklo, sychravý, ale krásný Trondheim, noční jezdec.</p>

<!--more-->

<p>Jak by řekl starý děda ve filmu Na samotě u lesa, “Chčije a chčije.” Ranní probuzení dávalo tušit, že celý den bude ve znamení deště, prostě taková šedivá deka. Vypadá to, že si z toho Norska užiju nejvýš tak jen ty silnice. Ještě dát sbohem peřejím a vyrazit směr Trondheim. A tady by to chtělo nějak vyřešit ten internet.</p>

<p>Ráno bylo taky dost ospalé, ostatně jako celý den. Po cestě jsem se stavil v takovém menším bistru u jezera, kde měli suvenýry a mohli by mít taky nějaký kafe. Měla to tam pod palcem nějaká paní původem z Indonésie a za pultem si hrály její děti.</p>

<p>Myslel jsem, že za 25 NOK dostanu aspoň nějaký čerstvý espresso, ale nalila mi jen kafe z termosky a mlíko, že si můžu nasypat rozpustný z pytlíku. Usadil jsem se u okýnka a začal usrkávat to kafe. Fuj! No to byl takový blívajz, že i obyčejný turek z nádražky v ruské skleničce proti tomu chutná jako Lavazza. Ale co, aspoň tam bude nějaký kofein a nebudou se mi za volantem klížit oči. Abych tolik nevnímal ten humus, vytáhnul jsem si macbooka a šel psát blog.</p>

<p>Za pár kiláčků se objevil Steinkjer, trochu větší město, o kterém mi říkal kluk z elektra z Troforsu. Našel jsem nějaké obchodní centrum a šel hledat free wifi, nebo nějaký obchod z mobily, jestli by mi to pomohli aktivovat. Narazil jsem ale přímo na NetCom a nakonec jsem usoudil, že jednodušší bude si koupit ten balíček, který jsem původně zamýšlel, s tím, že mi to sami aktivují hned na kase. Kluci byli velmi milí a ochotní a za chviličku to fungovalo. Personal ID nebylo potřeba, stačilo jen jméno a adresa. Jen zas byl problém s APN, že si to iPhone nezapamatoval. Asi nějaký bug v iOSu, či co. Hurá, zase v civilizaci.</p>

<p>Trochu jsem si odpočinul, venku chcalo, takže na procházku to nebylo, a pokračoval jsem dál na jih. Po hafo jezerech, horách a řekách se přede mnou konečně objevilo moře, Severní moře, resp. jeden z jeho tisíců fjordů. Tenhle neměl kolem sebe úzké hory, ale zajímavá byla taková rozlehlá bažinatá zátoka, asi byl zrovna odliv. Vítala mě cedule do okresu Verdal.</p>

<p>Wikipedie říkala, že tu v okolí jsou tu k vidění ruiny starého kláštera a bývalý pasťák, poté nacistický koncentrační tábor Falstad, kde umučili nebo v lesích postříleli stovky lidí a kudy sváželi Židy do Osvětimi. Nechtěl jsem se zase na dovolené rozčilovat nacistickou genocidou, tak jsem zamířil k těm ruinám v Munkaby. Vedla tam přes kopečky cesta, kde se dalo jet maximálně dvojkou, lilo jak z konve, ale pár šutrových zdí porostlých trávou tam bylo. Docela pěkné.</p>

<p>Trondheim už nebyl daleko a po stovkách kilometrů Norskem se objevily první bomstasjon, tj. mýtné brány. Mnoho silnic v Norsku je totiž zpoplatněno, a to i pro osobáky. Naštěstí jsem si už ve Švédsku zaregistroval auto přes jejich webové stránky, takže jsem mohl bez obav projet a za pár týdnů až tři měsíce mi to odečtou z karty. Jestli se vám ta doba zdá tak dlouhá jako mě, prý to nemají ještě úplně zautomatizované. Sice nesedí paní na pokladně u silnice, ale za to u kompu datlují SPZky podle fotek. V lepším případě jen opravují chyby po rozpoznávacím programu, v horším to všechno dělají ručně.</p>

<p>Zanedlouho jsem se ani nedivil, proč mají ty silnice zpoplatněné. Vjel jsem totiž do pekla. Nebo aspoň tak nějak se ten tunel jmenoval - Helltunellen. A opravdu jako v pekle jsem si tam připadal. Osvětlení plynule přešlo ze sytě oranžové, přes slabě oranžovou, až to takovou lehoučkou šedou. Kolem se vlnily stěny tunelu vylámaného v obrovské skále a já si musel dávat majzla, abych neuhnul z úzkého pruhu a nějam to nenapálil. Takových tunelů jsem pak projel ještě dlouhé kilometry.</p>

<p>Po vyjetí z jednoho z tunelů se přede mnou rozprostíralo docela velké město - Trondheim. Tam bych se rád podíval, protože by mohlo být docela malebné, aspoň v centru, ale příšerně prší a fouká studený vítr. Na pumpě jsem tedy notnou chvíli rozmýšlel, kam to zaparkovat, na co se podívat a jestli vůbec riskovat, že mi nastydnou dutiny a budu dalších 14 dní chrchlat.</p>

<p>Déšť se trochu uklidnil a já se rozhodl, že když už jsem tady a jel jsem tolik kilometrů, byla by škoda se sem nepodívat. Projel jsem si tedy centrum a zaparkovat nedaleko ulice podél řeky, kde stojí maličké původní domečky. Zase jsem měl ale s parkováním docela kliku. Byla sobota, tj. víkend a to je parkování v téhle zóně od tří odpoledne zadarmo. Pěkný, tak aspoň ušetřím kilčo za hodinu.</p>

<p>Zabalil jsem se do bundy a čepice, vzal si deštník a foťák a vyrazil obejít si staré město. Sichravo teda bylo, zima lezla za nehty, ale vůbec jsem nelitoval, protože město je fakt krásné a na každém rohu je na co koukat. Maličké baráčky hrající pastelovými barvami, starobylá gotická katedrála (prý nejsevernější), rybářské čluny v přístavu, domy stojící na dřevěných kůlech, kotvy prožrané od slané vody, staré doky přeměněné na hospody dekorované ozubenými koly z přístavních jeřábů, atd. Trochu mě překvapilo, že ožralové se potáceli ulicemi a ochcávali zdi muzea už v devět večer. U nás se chodí z hospody trochu později, ale spíš se holduje pivu, než vodce.</p>

<p>I přes tu zimu jsem si starý Trondheim docela užil a nacvakal mraky fotek. Zbývalo ještě vyřešit spaní. V centru se mi spát nechtělo a tak jsem do navigace nacvakal jedno místo za městem. Než jsem tam dojel, sice tam byla cedule zákaz vjezdu autům, ale před tím obrovské parkoviště v obci Bekken. Asi to je nějaký oblíbený výletní les.</p>

<p>Už jsem se chystal usnout, ale v tom přijelo na parkoviště menší tmavé auto a začalo zběsile jezdit kolem dokola. Asi se tu někdo moc nachlastal, nebo zfetil. Občas jsem měl trochu obavu, aby do mě ještě nenabořil, protože to fikal dost blízko mého auta a dost rychle. Po asi pěti minutách, když už udělal dost koleček, ho to přestalo asi bavit a zas odjel. Prostě nějaký magor. Ale co, aspoň je tu klid.</p>

<p>Dneska 221 km, celkem 4112 km.</p>

<p><a href="http://bohumirzamecnik.cz/blog/2014/scandinavia-road-trip-day-18/">Další den</a>.</p>
]]></content>
  </entry>
  
</feed>
