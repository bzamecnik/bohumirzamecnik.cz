<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Image whitening - clean B&amp;W documents from nasty photos | Bohumír Zámečník</title>
<link href="../../../assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://bohumirzamecnik.cz/blog/2015/image-whitening/">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Bohumír Zámečník">
<link rel="prev" href="../how-to-run-sms-tools-on-python-3-on-mac/" title="How to run SMS-tools on Python 3 on Mac" type="text/html">
<link rel="next" href="../how-to-make-a-hive-udf-with-conflicting-guava/" title="How to make a Hive UDF with conflicting Guava" type="text/html">
<meta property="og:site_name" content="Bohumír Zámečník">
<meta property="og:title" content="Image whitening - clean B&amp;W documents from nasty photos">
<meta property="og:url" content="http://bohumirzamecnik.cz/blog/2015/image-whitening/">
<meta property="og:description" content='Turn a poor smartphone-camera photo of a document or whiteboard into a nice black &amp; white or color "scan" that can be printed or converted to PDF. It works for text / line drawings / sheet music. The '>
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-02-15T19:29:32+01:00">
<meta property="article:tag" content="image processing">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">

        <nav role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../../"><i class="fa fa-2x fa-fw fa-home"></i> Home</a>
          <a class="sidebar-nav-item" href="../../"><i class="fa fa-2x fa-fw fa-user-circle"></i> Blog</a>
        </nav><nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../../about/">About</a>
        <a class="sidebar-nav-item" href="../../../projects/">Projects</a>
        <a class="sidebar-nav-item" href="../../../archive.html">Archive</a>
        <a class="sidebar-nav-item" href="../../../categories/">Tags</a>
        <a class="sidebar-nav-item" href="../../../rss.xml">RSS feed</a>
        <a class="sidebar-nav-item" href="https://github.com/bzamecnik/">GitHub</a>
        <a class="sidebar-nav-item" href="https://twitter.com/bzamecnik">Twitter</a>
        <a class="sidebar-nav-item" href="https://www.linkedin.com/in/bohumirzamecnik">LinkedIn</a>
        <a class="sidebar-nav-item" href="https://www.flickr.com/photos/elgriton/">Flickr</a>
        <a class="sidebar-nav-item" href="mailto:bohumir.zamecnik@gmail.com">E-mail</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h2 id="brand" class="masthead-title">
      <a href="../../../" title="Bohumír Zámečník" rel="home">Bohumír Zámečník</a>
    </h2>

        </div>
      </div>

      <div class="container content" id="content">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/BlogPosting"><header><h1 class="post-title p-name entry-title" itemprop="headline">
      <a href="http://bohumirzamecnik.cz/blog/2015/image-whitening/" class="u-url">Image whitening - clean B&amp;W documents from nasty photos</a>
</h1>
        <div class="metadata">
        <meta itemprop="inLanguage" content="en">
<p class="dateline">
            <time class="post-date published dt-published" datetime="2015-02-15T19:29:32+01:00" itemprop="datePublished" title="2015-02-15">2015-02-15</time></p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/2015/image-whitening.html">Comments</a>


        </p>
</div>
        

    </header><section class="e-content entry-content" itemprop="articleBody text"><div>
<p><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_orig_and_whitened_row_t.jpg"></p>
<p>Turn a poor smartphone-camera photo of a document or whiteboard into a nice black &amp; white or color "scan" that can be printed or converted to PDF. It works for text / line drawings / sheet music. The method is described here along with a Photoshop tutorial (and a Photoshop action for download) and a handful of examples.</p>
<!-- TEASER_END -->

<h3>The problem</h3>
<p>As you can see in the image above, we have taken a photo of a whiteboard at some irregular ambient day light. In order to print it or embed it into web page we want pure white background and nice black text or lines. The image should not be binarized (ie. only black and white pixel), the anti-aliasing of the lines should be preserved.</p>
<h4>Thresholding - bad</h4>
<p>The trivial method is <a href="http://en.wikipedia.org/wiki/Thresholding_%28image_processing%29">thresholding</a> - all pixels darker than some value will be black, and the rest white. It works kind of ok for scans with regular lighting but fails miserably for our photos. The problem is the threshold is global for the whole image and cannot cope with gradients in background. Also scanners are usually not available at hand and certainly cannot scan whiteboards. The other problem with thresholding is that we lose color information and anti-aliasing.</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_threshold_150.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_threshold_150_t.jpg" width="400"></a></p>
<p>Well, yes, there are some adaptive thresholding methods out there which try to find optimal threshold value for small image block. Yet, they still produce binarized image and lose colors. We need something better.</p>
<h3>The solution</h3>
<p>I've came across this problem many time through the years, tried to solve it many ways, including spectral filtering, without much success. Yesterday I needed to prepare some illustration images for my one of my <a href="http://www.visualmusictheory.com/tone-circle.html">blog articles</a> and make an animated GIF. I only had my new whiteboard and iphone.</p>
<p>Suddenly, the light bulb in my head lit up:</p>
<blockquote>
<p>Use the median filter!</p>
</blockquote>
<p>What does the <a href="http://en.wikipedia.org/wiki/Median_filter">median filter</a> do. Simply said, for each pixel it finds the most common value from its neighborhood, a <a href="http://en.wikipedia.org/wiki/Median">median</a>. From the image processing lecture I can remember it is good for removing salt and pepper noise, ie. lone black or white pixels. And what are the lines and text? A kind of salt and pepper!</p>
<p>The median filter with wide enough radius of neighborhood just keeps the background and removes the text. Then we can just remove this background, eg. divide the original image by the median-filtered one. A similar (yet not really the same) procedure is called <em>whitening</em> in the image-processing field.</p>
<pre class="code literal-block"><span></span>I_whitened = I / median2d(I, radius)
</pre>


<h4>How to do it in Photoshop</h4>
<p>The easiest tool to experiment with this idea is probably Photoshop (although it might not be the best for batch processing and certainly it is not free).</p>
<p>So here the procedure:</p>
<ul>
<li>open the image</li>
<li>duplicate the layer twice<ul>
<li>name the top layer "median" (not necessary, just for clarity)</li>
<li>name the second layer from top "background"</li>
</ul>
</li>
<li>apply the median filter to the "median" layer: Filter -&gt; Noise -&gt; Median<ul>
<li>fiddle with the radius so that the background is quite smooth</li>
<li>start eg. with 100px for a 6Mpx photo</li>
</ul>
</li>
<li>set the "median" layer blending mode to "divide"</li>
<li>merge down the "median" and "background" layers</li>
<li>voilà!</li>
</ul>
<h5>Tips</h5>
<p>Try to fiddle with the radius. Use the least radius that doesn't leave too much dark blobs.</p>
<p>In case there are larger areas filled with black or color the whitening doesn't work well. See the "Document with color diagrams" example below. But there's a work around. We need to remove the big spots from the median layer. The <em>Content-aware fill</em> feature is our savior:</p>
<ul>
<li>just select the remaining blobs</li>
<li>Edit -&gt; Fill (SHIFT+F5) -&gt; Content Aware</li>
<li>and select the "divide" blending mode again</li>
</ul>
<p>Denoise before whitening. A great denoising tool is in Lightroom. Something is probably in Photoshop as well.</p>
<p>Adjust Levels after whitening - do white and black clipping. This leaves the background perfectly white and makes the lines/text more contrasty.</p>
<p><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/photoshop/levels.png" width="268"></p>
<h5>Photoshop Action</h5>
<p>It is too much hand work. As a bonus I have made a Photoshop action and exported it so that you can just plug it in your installation!</p>
<ul>
<li><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/photoshop_actions/median_whitening.atn">median_whitening.atn</a></li>
</ul>
<h3>Examples</h3>
<h4>Document with color diagrams</h4>
<p>Original (bad gradients from a table lamp):</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_orig.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_orig_t.jpg" width="400"></a></p>
<p>Thresholded at 100 (bad):</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_threshold_100.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_threshold_100_t.jpg" width="400"></a></p>
<p>Median with 100 px radius (notice the color blobs):</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_median_100px.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_median_100px_t.jpg" width="400"></a></p>
<p>Whitened (artifacts from color blobs):</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_whitented.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_whitented_t.jpg" width="400"></a></p>
<p>Median with 100 px radius + content-aware fill:</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_median_100px_content_aware_fill.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_median_100px_content_aware_fill_t.jpg" width="400"></a></p>
<p>Whitened (artifacts are gone):</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_whitented_content_aware_fill.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_whitented_content_aware_fill_t.jpg" width="400"></a></p>
<h4>Sheet music</h4>
<p>Original (shadow from my hand):</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_original_photo.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_original_photo_t.jpg" width="400"></a></p>
<p>Thresholded at 128 (bad):</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_threshold_128.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_threshold_128_t.jpg" width="400"></a></p>
<p>Median with 100 px radius:</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_median_50px.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_median_50px_t.jpg" width="400"></a></p>
<p>Original divided by the median:</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_whitened_divide.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_whitened_divide_t.jpg" width="400"></a></p>
<h4>Simple whiteboard</h4>
<p>Original, denoised (in Lightroom):</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_denoised.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_denoised_t.jpg" width="400"></a></p>
<p>Thresholded at 80 (the light blue is gone - bad):</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262-threshold_80.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262-threshold_80_t.jpg" width="400"></a></p>
<p>Median with 100 px radius:</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_median_100px.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_median_100px_t.jpg" width="400"></a></p>
<p>Whitened:</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_whitened.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_whitened_t.jpg" width="400"></a></p>
<p>Whitened + levels:</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_whitened_levels.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_whitened_levels_t.jpg" width="400"></a></p>
<h4>Whiteboard</h4>
<p>Original (day light + some reflections):</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_orig.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_orig_t.jpg" width="400"></a></p>
<p>Denoised in Lightroom (click for detail view):</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_t.jpg" width="400"></a></p>
<p>Denoised + thresholded at 150 (bad):</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_threshold_150.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_threshold_150_t.jpg" width="400"></a></p>
<p>Median with 100 px radius:</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_median_100px.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_median_100px_t.jpg" width="400"></a></p>
<p>Whitened:</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_whitened_color.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_whitened_color_t.jpg" width="400"></a></p>
<p>Whitened + desaturated + levels:</p>
<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_whitened_bw_levels.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_whitened_bw_levels_t.jpg" width="400"></a></p>
<h3>Conclusion / TL;DR</h3>
<p>In this article I've presented a very simple, yet effective method for converting photographed or scanned documents or whiteboards to a nice printable form with pure white backround and crispy dark text / lines.</p>
<p>The principle is using median filter with a wide radius to remove the text and then divide the original image by the filtered one.</p>
<p>We have seen a procedure in Photoshop and the action available for download.</p>
<p>This method is most suitable for smaller text and lines. It has problems with larger dark or colored blobs. In such case we can manually apply content-aware fill to the remaing blobs in median layer to overcome the problem.</p>
<p>It is good to use denoising before and adjust level after the filter.</p>
<h4>Further directions</h4>
<p>Since Photoshop is not free and most importantly is it not that great for true batch processing I'd like to implement this method in Python. Hope the code will be available soon.</p>
<p>I also hope you found this article useful. If so feel free to share it and let me know. Also you can follow me at twitter: <a href="https://twitter.com/bzamecnik">@bzamecnik</a>.</p>
<p>Enjoy!</p>
</div>
    </section><aside class="sharing no-print"><a href="#content" aria-label="Post beginning">
       <i class="fa fa-2x fa-fw fa-arrow-circle-up" aria-hidden="true" title="Post beginning"></i>
    </a>
    <a href="http://bohumirzamecnik.cz/blog/2015/how-to-run-sms-tools-on-python-3-on-mac/" rel="prev" title="How to run SMS-tools on Python 3 on Mac">
       <i class="fa fa-2x fa-fw fa-arrow-circle-left" aria-hidden="true" title="Previous post: How to run SMS-tools on Python 3 on Mac"></i>
    </a>
    <a href="http://bohumirzamecnik.cz/blog/2015/how-to-make-a-hive-udf-with-conflicting-guava/" rel="next" title="Next post: How to make a Hive UDF with conflicting Guava" aria-label="Next post: How to make a Hive UDF with conflicting Guava">
       <i class="fa fa-2x fa-fw fa-arrow-circle-right" aria-hidden="true"></i>
    </a>
    <span class="post-sharing">
     <a href="http://twitter.com/share?text=Image+whitening+-+clean+B%26W+documents+from+nasty+photos&amp;url=http%3A%2F%2Fbohumirzamecnik.cz%2Fblog%2F2015%2Fimage-whitening%2F" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" aria-label="Share on Twitter">
       <i class="fa fa-2x fa-fw fa-twitter-square" aria-hidden="true" title="Share on Twitter">
     </i></a>
     <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fbohumirzamecnik.cz%2Fblog%2F2015%2Fimage-whitening%2F" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" aria-label="Share on Facebook">
       <i class="fa fa-2x fa-fw fa-facebook-square" style="margin-left: -8px" aria-hidden="true" title="Share of Facebook">
     </i></a>
     <a href="https://plus.google.com/share?url=http%3A%2F%2Fbohumirzamecnik.cz%2Fblog%2F2015%2Fimage-whitening%2F" aria-label="Share on Google+" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
       <i class="fa fa-2x fa-fw fa-google-plus-square" style="margin-left: -8px" aria-hidden="true" title="Share on Google+">
     </i></a>
     </span>
</aside><div itemprop="author" itemscope itemtype="http://schema.org/Person">


        <section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="bzamecnik",
            disqus_url="http://bohumirzamecnik.cz/blog/2015/image-whitening/",
        disqus_title="Image whitening - clean B&W documents from nasty photos",
        disqus_identifier="cache/posts/2015/image-whitening.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script>var disqus_shortname="bzamecnik";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>
© 2018 <a href="mailto:bohumir.zamecnik@gmail.com">Bohumír Zámečník</a>
- Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>,
theme based on: <a href="https://themes.getnikola.com/v7/jidn/">jidn</a>
/ <a href="https://github.com/poole/lanyon">lanyon</a>

</p>
            
        </footer>
</div>
    </article>
</div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-44857522-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script><script src="../../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</div>
</body>
</html>
