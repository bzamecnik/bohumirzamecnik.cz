
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>
    Image Whitening - Clean B&W Documents From Nasty Photos - 
    
    Bohumír Zámečník</title>
  <meta name="author" content="Bohumír Zámečník">

  
  <meta name="description" content="Turn a poor smartphone-camera photo of a document or whiteboard into a nice black &amp; white or color &ldquo;scan&rdquo; that can be printed or &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://bohumirzamecnik.cz/blog/2015/image-whitening">
  <link href="https://s.gravatar.com/avatar/f90538dcd2df4a510c8f0b057154dea1?s=32" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Bohumír Zámečník" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44857522-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Bohumír Zámečník</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="http://eepurl.com/xX1M1" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:bohumirzamecnik.cz" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="/projects/">Projects</a></li>
  <li><a href="/about/">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Image Whitening - Clean B&W Documents From Nasty Photos</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-02-15T19:29:32+01:00" pubdate data-updated="true">Feb 15<span>th</span>, 2015</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_orig_and_whitened_row_t.jpg"></p>

<p>Turn a poor smartphone-camera photo of a document or whiteboard into a nice black &amp; white or color &ldquo;scan&rdquo; that can be printed or converted to PDF. It works for text / line drawings / sheet music. The method is described here along with a Photoshop tutorial (and a Photoshop action for download) and a handful of examples.</p>

<!--more-->


<h2>The problem</h2>

<p>As you can see in the image above, we have taken a photo of a whiteboard at some irregular ambient day light. In order to print it or embed it into web page we want pure white background and nice black text or lines. The image should not be binarized (ie. only black and white pixel), the anti-aliasing of the lines should be preserved.</p>

<h3>Thresholding &ndash; bad</h3>

<p>The trivial method is <a href="http://en.wikipedia.org/wiki/Thresholding_%28image_processing%29">thresholding</a> &ndash; all pixels darker than some value will be black, and the rest white. It works kind of ok for scans with regular lighting but fails miserably for our photos. The problem is the threshold is global for the whole image and cannot cope with gradients in background. Also scanners are usually not available at hand and certainly cannot scan whiteboards. The other problem with thresholding is that we lose color information and anti-aliasing.</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_threshold_150.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_threshold_150_t.jpg" alt="" /></a></p>

<p>Well, yes, there are some adaptive thresholding methods out there which try to find optimal threshold value for small image block. Yet, they still produce binarized image and lose colors. We need something better.</p>

<h2>The solution</h2>

<p>I&rsquo;ve came across this problem many time through the years, tried to solve it many ways, including spectral filtering, without much success. Yesterday I needed to prepare some illustration images for my one of my <a href="http://www.visualmusictheory.com/tone-circle.html">blog articles</a> and make an animated GIF. I only had my new whiteboard and iphone.</p>

<p>Suddenly, the light bulb in my head lit up:</p>

<blockquote><p>Use the median filter!</p></blockquote>

<p>What does the <a href="http://en.wikipedia.org/wiki/Median_filter">median filter</a> do. Simply said, for each pixel it finds the most common value from its neighborhood, a <a href="http://en.wikipedia.org/wiki/Median">median</a>. From the image processing lecture I can remember it is good for removing salt and pepper noise, ie. lone black or white pixels. And what are the lines and text? A kind of salt and pepper!</p>

<p>The median filter with wide enough radius of neighborhood just keeps the background and removes the text. Then we can just remove this background, eg. divide the original image by the median-filtered one. A similar (yet not really the same) procedure is called <em>whitening</em> in the image-processing field.</p>

<pre><code>I_whitened = I / median2d(I, radius)
</code></pre>

<h3>How to do it in Photoshop</h3>

<p>The easiest tool to experiment with this idea is probably Photoshop (although it might not be the best for batch processing and certainly it is not free).</p>

<p>So here the procedure:</p>

<ul>
<li>open the image</li>
<li>duplicate the layer twice

<ul>
<li>name the top layer &ldquo;median&rdquo; (not necessary, just for clarity)</li>
<li>name the second layer from top &ldquo;background&rdquo;</li>
</ul>
</li>
<li>apply the median filter to the &ldquo;median&rdquo; layer: Filter &ndash;> Noise &ndash;> Median

<ul>
<li>fiddle with the radius so that the background is quite smooth</li>
<li>start eg. with 100px for a 6Mpx photo</li>
</ul>
</li>
<li>set the &ldquo;median&rdquo; layer blending mode to &ldquo;divide&rdquo;</li>
<li>merge down the &ldquo;median&rdquo; and &ldquo;background&rdquo; layers</li>
<li>voilà!</li>
</ul>


<h4>Tips</h4>

<p>Try to fiddle with the radius. Use the least radius that doesn&rsquo;t leave too much dark blobs.</p>

<p>In case there are larger areas filled with black or color the whitening doesn&rsquo;t work well. See the &ldquo;Document with color diagrams&rdquo; example below. But there&rsquo;s a work around. We need to remove the big spots from the median layer. The <em>Content-aware fill</em> feature is our savior:</p>

<ul>
<li>just select the remaining blobs</li>
<li>Edit &ndash;> Fill (SHIFT+F5) &ndash;> Content Aware</li>
<li>and select the &ldquo;divide&rdquo; blending mode again</li>
</ul>


<p>Denoise before whitening. A great denoising tool is in Lightroom. Something is probably in Photoshop as well.</p>

<p>Adjust Levels after whitening &ndash; do white and black clipping. This leaves the background perfectly white and makes the lines/text more contrasty.</p>

<p><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/photoshop/levels.png" width="268"></p>

<h4>Photoshop Action</h4>

<p>It is too much hand work. As a bonus I have made a Photoshop action and exported it so that you can just plug it in your installation!</p>

<ul>
<li><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/photoshop_actions/median_whitening.atn">median_whitening.atn</a></li>
</ul>


<h2>Examples</h2>

<h3>Document with color diagrams</h3>

<p>Original (bad gradients from a table lamp):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_orig.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_orig_t.jpg" width="400"></a></p>

<p>Thresholded at 100 (bad):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_threshold_100.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_threshold_100_t.jpg" width="400"></a></p>

<p>Median with 100 px radius (notice the color blobs):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_median_100px.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_median_100px_t.jpg" width="400"></a></p>

<p>Whitened (artifacts from color blobs):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_whitented.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_whitented_t.jpg" width="400"></a></p>

<p>Median with 100 px radius + content-aware fill:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_median_100px_content_aware_fill.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_median_100px_content_aware_fill_t.jpg" width="400"></a></p>

<p>Whitened (artifacts are gone):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_whitented_content_aware_fill.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/text_with_color_diagrams/IMG_3274_whitented_content_aware_fill_t.jpg" width="400"></a></p>

<h3>Sheet music</h3>

<p>Original (shadow from my hand):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_original_photo.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_original_photo_t.jpg" width="400"></a></p>

<p>Thresholded at 128 (bad):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_threshold_128.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_threshold_128_t.jpg" width="400"></a></p>

<p>Median with 100 px radius:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_median_50px.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_median_50px_t.jpg" width="400"></a></p>

<p>Original divided by the median:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_whitened_divide.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/sheet_music/something_latin_whitened_divide_t.jpg" width="400"></a></p>

<h3>Simple whiteboard</h3>

<p>Original, denoised (in Lightroom):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_denoised.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_denoised_t.jpg" width="400"></a></p>

<p>Thresholded at 80 (the light blue is gone &ndash; bad):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262-threshold_80.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262-threshold_80_t.jpg" width="400"></a></p>

<p>Median with 100 px radius:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_median_100px.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_median_100px_t.jpg" width="400"></a></p>

<p>Whitened:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_whitened.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_whitened_t.jpg" width="400"></a></p>

<p>Whitened + levels:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_whitened_levels.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard_simple/IMG_3262_whitened_levels_t.jpg" width="400"></a></p>

<h3>Whiteboard</h3>

<p>Original (day light + some reflections):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_orig.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_orig_t.jpg" width="400"></a></p>

<p>Denoised in Lightroom (click for detail view):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_t.jpg" width="400"></a></p>

<p>Denoised + thresholded at 150 (bad):</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_threshold_150.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_denoised_threshold_150_t.jpg" width="400"></a></p>

<p>Median with 100 px radius:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_median_100px.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_median_100px_t.jpg" width="400"></a></p>

<p>Whitened:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_whitened_color.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_whitened_color_t.jpg" width="400"></a></p>

<p>Whitened + desaturated + levels:</p>

<p><a href="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_whitened_bw_levels.jpg"><img src="http://i.bohumirzamecnik.cz/2015-02-15-image-whitening/whiteboard/IMG_3129_whitened_bw_levels_t.jpg" width="400"></a></p>

<h2>Conclusion / TL;DR</h2>

<p>In this article I&rsquo;ve presented a very simple, yet effective method for converting photographed or scanned documents or whiteboards to a nice printable form with pure white backround and crispy dark text / lines.</p>

<p>The principle is using median filter with a wide radius to remove the text and then divide the original image by the filtered one.</p>

<p>We have seen a procedure in Photoshop and the action available for download.</p>

<p>This method is most suitable for smaller text and lines. It has problems with larger dark or colored blobs. In such case we can manually apply content-aware fill to the remaing blobs in median layer to overcome the problem.</p>

<p>It is good to use denoising before and adjust level after the filter.</p>

<h3>Further directions</h3>

<p>Since Photoshop is not free and most importantly is it not that great for true batch processing I&rsquo;d like to implement this method in Python. Hope the code will be available soon.</p>

<p>I also hope you found this article useful. If so feel free to share it and let me know. Also you can follow me at twitter: <a href="https://twitter.com/bzamecnik">@bzamecnik</a>.</p>

<p>Enjoy!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Bohumír Zámečník</span></span>

      








  


<time datetime="2015-02-15T19:29:32+01:00" pubdate data-updated="true">Feb 15<span>th</span>, 2015</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/image-processing/'>image-processing</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://bohumirzamecnik.cz/blog/2015/image-whitening/" data-via="bzamecnik" data-counturl="http://bohumirzamecnik.cz/blog/2015/image-whitening/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/how-to-run-sms-tools-on-python-3-on-mac/" title="Previous Post: How to run SMS-tools on Python 3 on Mac">&laquo; How to run SMS-tools on Python 3 on Mac</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/how-to-make-a-hive-udf-with-conflicting-guava/" title="Next Post: How to make a Hive UDF with conflicting Guava">How to make a Hive UDF with conflicting Guava &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
	<h1>About Me</h1>
	<p>How do things work? Ever since 1987 I’ve fallen in love with thinking about it. That’s how I became a <a href="/about/">digital craftsman</a>.</p>
	<p>#machinelearning #musictheory #dsp #bigdata #software #science</p>
	<ul>
		<li>
			<a href="https://twitter.com/bzamecnik" class="twitter-follow-button" data-show-count="false">@bzamecnik on Twitter</a>
			<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
		</li>
		<li>
			<a href="https://www.linkedin.com/in/bohumirzamecnik">LinkedIn profile</a>
		</li>
	</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/ads-b-flight-tracking/">ADS-B Flight Tracking for the Curious</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/my-digital-nomad-story/">My Digital Nomad Story</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/how-to-make-stl-with-svg-logo-and-text-in-openscad/">How to Make STL With SVG Logo and Text in OpenSCAD</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/harmoneye-hard-won-experience/">HarmonEye: Hard-won Experience After Three Years of My Life</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/how-to-make-a-hive-udf-with-conflicting-guava/">How to Make a Hive UDF With Conflicting Guava</a>
      </li>
    
  </ul>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/112168593075061741028?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - <a href="/about/">Bohumír Zámečník</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bzamecnik';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://bohumirzamecnik.cz/blog/2015/image-whitening/';
        var disqus_url = 'http://bohumirzamecnik.cz/blog/2015/image-whitening/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<a href="https://github.com/bzamecnik/bohumirzamecnik.cz/" class="github-ribbon"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"></a>


</body>
</html>
